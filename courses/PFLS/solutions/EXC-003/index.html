<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Solution for EXC-003</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #217573;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #FFFFFF;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Solution for EXC-003</p>
                        <p>You shall not pass! Well, unless you have the password. Then you pass .. or <a href="/courses/PFLS/#exc-003">go back to where you came from</a>.</p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="SHOW ME" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"f268ee9831e1a4f9e7d8934e6eeb573fd992badb2b34d78358c942d5c7942d151c14fa5f4370bfb5da856f93774d34af6f6198ccb5cd98e34e03175757108d7aaba2d158f5b2c82b3085d373725f76361f0e29661de6f0d22d11eb904ca9bb1b1cd298604a3c09c64951b852b51fab214d91218a694fbeccd19e5a3055a20d8a3cb4b777aaf8ba8875a362f6ecbafeb69582a8c6adc173dab83d7bee04036f8e7358c299fbf1d0ffb6bc7abee25752d98ccba9e60ea90186e30115f1b515ecd041544b63681097bc59fd4d8c756fb510a3674201d618de5bb68c84e40ac2547625002df87435b91f30afbbb60739e2c1c78e2b7dbaa6da209045d9b851b8736fed5c2e9f9c5d76b973ec01c3276f83f1ff50696c4b4ab97469eeee477f78b02ac04e625801fae43b8c68f218d8b651a070d819c227213294892f24d6262427f2180fd6ed213d60d7dce9bd0996cd019f5521dfa263cd8e166b97d64da9e86ea54cfb738f3d28ae835bd37cda5f3cfa1c5ec8da99369a2c0045f0d0e7a10232a18e131940c277c605557a2212f4d7b9019be379df77921a3852c9ff5cf32af12b57aafc9d76ea544548adfb2316014537fbf7a4e1e393b736fa328db201650d609d656cace3593760ea82b10ad91fd42aeea0ad51ec4ead4366c38fc2f849ba911f4b87ad44a7d9e1a6f93f61b3c253483874dbc6bd60828005e7ade6e672fdbaa9285a0403a795d7952841ce219a6feedb033ddb2d9c7f5673a77bfe70fb77562611767550f00eda271e4e8aa41e917816c9aa64994f68b3d52b7917b45daa3374f0398e674306cbc8156cc02953b127ab0dbe7668c5df7770998a05f31f54828fe5df71da5c80746c92a014247fdae5b59b0ed2cacf2b8481bf455af82dfec87e670ef88231845921363284bc120436e31b6b64d981f9a33a88cccbc2bab24db4673e45cbd9a2b2ba4fea5c838c30866645a8e8a2256748ea7b327554091794bf733086f1c167df51aadc3811d607fb09bcb2804a58b241907db0e641aa0046d9af2012b87fbc6bf1346e17ae732b93b922a00aa00a222519b1c818823c44b5d4cad0c3b1b60ff5ae80342c98bede9cef945e6d0f89efeb24153c1dd507f26ce38223144392f4ba51c8a850303ae392036ca7d5f35597cdefdca71d4b57c59290661c6f954df00e3209535a2d0185525ceebed0f8a233ecaf3ac78fe91d0683a512ab8f044fd000daa139833f3635516e0ab95baf05050ec993f41843daaa31697c1ed8da71464e410a4b0f2b2ed43310a0ae35a08f1618d38d619ca18c782a531e5dfbc840880a563df202dad296c3d5de1eb7c5b93eaaa00a93c913efcfb4ae014eb941c26223314c1438a9468a0642930a7d2614eb3c112adb31c6b691a5de90271a91894408c1a4bdeff611814abe3b850f6180c9898ad81b8f1477bb28ca6d5e1454b94ed71ce563bec4b35df598a068ffef5179fdffbee710dab2020785b66f1790b7a4be78cd8cc3becb9722df7fd60578471b82802ef662c1b7382f9855ba16a42e20df6cd8d38cac75da8be55aeb6bd41f0bd86f2dfb103909af746e62ac1f50ce711b256f4db4a8ca1d84c9881cb3f7cd99f1209021f1a893732bf660533f149621e0b7a720faf0c9a20b01c98711b7a2c9fa962a67fb00cd93e3a76da7ddd3adbe27a4347797adcaea8790014aa14debe32dc4d93697da3ba70868058205855eab9a5b684bac9338ce1a03195728801e10a7a24232af7b0878d29c9bda8aaffa972ad4f8417eb8e7ab429769ffadcd66a0cf3334db5c5bbe020df48304c4082792f3e43a80d26b9ef983d3af08e5ee63ef45e4b97d48906f92dc9c69769271501155400950c8bc8802d97cb3c836a89ce7c90b797c99a74b0ade785f6b8d964060ad38bef5ca3594284261ccfed12cef68e22b7123aa54ea2519cc2efcd16d1759d6a2332fbc79979d98cd32dab148c64a0ac7c042f84d6674e93a165234da1067744414cd686f3963379749b87e3d4be73c25f4887f2dec468df0e7bdb32ca934a1b5efef40e569f96da578cd169ad3fd33610b8725ea05dfe6447a242967c69871f4dbae287094dd03974d025f32671e22dec9f5d9fbd6870999e00d85ac7e11db8aa1cc60eea10207d1867f4866fef5cb70a3247c2cc66a246c3ea7754efb672aeb00499da66acb1025c3d08052cab8d32f432e8c5ec4ceb8730cd09d11aa30e8a500a32b158bf17f1ba394da83b41d8e275fbeef042c2c9f3b2bef69f77a94275f147a1cc50e1ef23bd802299bb24952d5c2d4a629ed326f9da9329dbfbfbd670111a807d5cd01bb141c6f9409d9235e5d5f264431d7a2363e2b83bae45d1e4dafca9d7229168111705a629251d6c0bdccc56b24f7b9265a5199fce49e5c26fb5d02b8c84ed5b4278c64611bdde1ffb31b4d010dcd40112f30f351a51ace0c73610bf8592b5a5240b48d90ed4b3978e5bd9d248af0208e4b460bb70bcfaf03d917ef7ad63131ae1c17381d9494745569d0235e27d297ef8ea1d0a9bd14640e3619768ee2b6ead2c1b683a2dd18f1451b57ead93fae0498cd9a01f96272d32ff4e305a0515e159d8c41e0781055c7be141c3ae4af8392dc126ebef8825338cfe23553153d2c1a1fd87b55ada33861fb31307076b90e99dbfd994fdc5c6ec0fe97efd897dcda679e3edf2361f7d144bbbf084b781718cddcafd77acd82351bf1051dcc99eb881f6f594323e2cc4c6abdd96f0dab3f51ab1bd62ee59fd72dc525adc284cc2f786e54ac0941472379dbb1e3ac560edeba79dbb1482162795265777c6ecdee8eaf71ae906afa733ef8b01878a473898e73ff7f70b82265cb5337782f51351571998662daed7b9f55e93b613528be66b271bb0c8517a33d0f2d42eb11fbc277697d52fc025ab1d77c5d17fb84dc8fcea9e3d85927fb1b614625ff0e7f326c3cde18f46eb9bcb656de60c47589261129753617e758d99cb7feabf11134a51e7b95e88de8581ecbfe130f570f47e5693d185e68955e89b0457f212f5722ccb4783fece84bd906f7619c878100e9794ae5b0b612c3bc4bfbd9300bb8bf05cf50810e1f5cad95f5ad280ff40b4f6f8b2ea69b12cbf1f7d187577edb7014d7f054885f43dee480f62f8624b711c71b1e63ce39bc123f884a8cd180beb8ffcc77595bde4feed8cfe3382fd65c72e05bd46f2a01344c3f916d044153cf0c381f039c320fe20f8436b555e63b77f8a1a44dcc1d6346d4591b6dfaf6eb4f91d721964d93963096ac1c9bfbe5c556140788c62219d11bc21a0f10ed2cf030602aed2f63028d1b6ce27f2c4388b291a28cd88149137cbae4b41ac58de64e0771d36e45ec90fa1f7c36205cf44c92b9c0ec7fbb27e1327c496bc30017656d15de642c515224fa05407fe59132d08be936d7f3311bc14f3195a3092fdd98bc92115c50dfea941ba95bdc67a4f57a43e18c2bd3dc9a64bc4baf041f0507941f5e06cdb4c90a43e62c633601d620a0c83be68926b721092b30b917ec12c03f0a35bed943ec2f6ac97801319fd13f253f1e79e4bd140ae05e7e6c8150fc5ae733729b57c4a671da58d4a4c584d8a85ec45fd6eb0ccb6586411b552fc918456b5bcdc5ac8f92a455d0dae8fca7982033c171d9ffa4cfdd9d5d86a31037eec12e522827154eb9046bf549d0c119f26ba3eec4d638a1f5a7fab55857a44a535abf21682d720cfccb3aa37a3515106e90fc4c71ead0256789ab7751f1f42a0c771aba5a453ec35eb5db194ce29292457c145d871636968b865a38264534c7ab4437a061705456bf7dc73282bd8946d5d59ed5e61bb28dc5e0886e9deb2c99f9d3013b973a8a6b6457ce40b65ef9f7f80ff49a7933f503114957ee9d7327a648d4af993da37af84d6b985ab4a4f4bdc9a42fcc169955a829264f6ce75b0b62b6383f525ebe1bae83d647124abb198aaf4a3527a3911c2918145e5c56c480ac9476bc693834a0e4c0920ce5c6fe86ed0c8800902a9e77dd0d46756284abf277addc579bc0af0b4bb280459bc76d9f8b7a08f50b0bf20e11f9c89be01c718df1d69daabafe5746cdb851ae5fdbcca99eeea5b3905e37e092b3479f68b331851c0b0e11027db1d28405251f2d04ceb0efe8c8b491eefc81cb7cada6f94809c44ce02c0c5172f53acf061c79d1ffdf1cae25bbb980c1da7bd8275c2149e7a2c85338b7542a7915141b13ce8fe9ba99f4fa3dfe6721bffeda959aa8c4489463428c3f5eeca8951548db600129f21da6da0fbcda993ef0464e3177e1e50b8fc748b0532d2aafa842ceb278f4b9925d64b838b909b26b0426408aa170e3b51780d6c9219bd5c915063c955849187ea544ed0ecc9654654ec186e52884988bdbbd825375ca646d6548609a4223268affced5328eec8bb8ca38973042038270a7b9970f434576a277078b3a5cba05cab0826369ef450a11ca599c21f9767e1118c6971b15e1a0d5f3446cb44771b4bb9871f797104fef38c353f2526fd35c0e105953ebc7862c16db9ff6f2a6053a4a2147c07a29347a50bfbaeecf714b3e8226fdb124ba18f4cf75b6c63d3f17a6eba911c9ab336769eb0c30165c8b9dd43ab896bb3a345fde667732eea8f55430bb397f8efb3eadf3f46bbc071b1b1f00b91d1594d064642f462556b8110e97387e42afeac1def79376f0e0739cb35abd3b71fda788218190ed1f514dbcf67920d0ffd3c51e86acbf036617bd501305b1dcd7aab740c19c2869fb586203a8a6b75acac692a060cd1dc6119bb6935aa67227e1e5d2d7ce7ce57779eb7e0652ca02f4fba521eb4235ec50841d72002ebcdfb95164c62672f26787c05ab9911f105b43e3eba32de5ed67f2b2e257770d5323e92d0d5b3daf696f583a1cf3344dd5a42410a6960d864dce5d0799f271451c199820ea4c12171b498520fe464374ddb3468fa1c167dedd90fd1346e19e08ee54c71bf5b8c3867dbdc24fbf658814c2963ecdeffa8e7ba760480cf35fb705b15fa07c5f5558769c0aae05102c666a7fe1ca23751883f90fe17b0c1160f7059dfbea94166c8270a588483a58d1454a5f5b246490c30dbe37a9a1dd50d89b24dc82dbff2546c619cc367706559936d501af287c4233c100991a706ee87dcef227c9c548c635f0a912151209b10670a43433e963873467fad39eca3bdb1add4fcda6d88d8976a7c41a87f05060668840589ecb731437ff9c89a0a63efde65d8683eef37808979f8873acd95c73f35eaed0b7cd93271dad0eea70c0d1112b5003d963c2d7712c2ab549f8faa1165f50339e17d298f580f02203140a6df7194239ca7ae85bf51bf131d8d02dbade275149689ce74bc56be92db8a3a70baa9dcc127e98e348820298b1f93e306f2c6b07d2af1fe89b87b50e9ced736df1ac9f22d39c03937c828df6a7be2c33662e681b48da2f29516bbfcf11d6534a8f85f9c8962fcfabc837b13c38a66dd26161f329e6472b7c0388c52ef3ab84560b3d522c32e6cd3f6f7ee5c87d1f768f071a80f7d0e92d19fc5f1616f1f0a35b54ac92b6107e950eec72d6a17928864e07c897eebca57fae271a91a21161db4ad4be0c0a28f0ef3ba460424c7fd8dac8d0bdfd9014da1cc8a267c1760160ca4884c3b91c32feb630db4dce1fe68a840a4ef2fae0d7e3a9790a2be8bb713ed2775d3cf6f25d057907d172c0fe3185b44057f77a63e768c15e924c151d16463c32eaf5e0a35df0f873474e34406c3d7dc8734c9d1b3a85dd78c5689f365c4e3d79aa3f86c2e1a86189a9d34fec532a4a2dd76b4c5ecf0ecda0efc8fdfdc9818a40f54084603ce734844411b5b16e9f0ed0aec86f4a8c82d4eb0061ed14c31521069b30cec91cec1e338c594ab99bcee87f34da72370b89da4eaebc8677b5310faf185a474f3e1b206b8717a36daa0ad7eb1c44c713caefda90fb75e5dc89222593f1c4c6593f0ce843c63eada9d9b6169333409ccc124b3e27519000fcd8317c42c3fae2b6e43037f1d7325a6927b80ceb613b275b54cc0bb6257955835d138f07c90bc361171aed58549ec90876b84ca746af7a26b9997b340ff4fa8e0d56562d5f96a995982b1288fcb2d129cf4e9cdbf5911bc23d7eb073a191a656d78e2dcc6e034c81487ce0242707c1ecdafe189ecb0e34d71f2b3b9e231f53133e3a5fe4e19b6237283e5b07457ef8ab3a3c45eab06c2cacf763b38eaf22f6a8ccea37253f3830ea68bc17dbb14790802b236f0abfd650d4db75a70e2aff71fbdde739ea4cc412dd55bd3d33e47f71c78b125853b1b6e416ba5e15a22cfe98c578035eed4390cb1d7a7f1fc0aa3375f2fb3da72d6e15150a00953d3f37147f7e9b5ead6fa0319f44c6b22c7028e02302ca87001822b51ffba249927750a73a63432aa88a7117fa200e39d84a9877dfb4cb75606002f1602c7dbed151b92d0815fdad99cc32a5fc6af9476db4c5ae9bd2f79d9068e9fb52c058480df5ab6378439d45caf00c2ff8858fa5c4409dc3d58bdc9079c7dc3e7ec4ed0758a880a6490728fa11b9d1700da1518ee58275b90898c3a53412218366b43509bddd6c2737f9b87228430e770110a15199c663849bd75829a8760761a168bb573a26a0dfb3d479867e2cc1b754aef539fae0a9eea822c5c2d90dd0cac0effb37d49398b2ffae2b78c7eafa8355a3ca5e4d3cd485f8fbbc029a52bca7ac38c3a654b1d04ef4caee34afc3a42093798a03de663f1e390cd87e2e3a51dc9bc9d4a0bcab71cbeb441576d23b5f19f233ff44b2096addee4057d0166bf4c2bcc8645c4419b7460517ba9adbce9a36bd39e057d2bf023b90d60bcd7871addea01183e9324f3f0d93a912606539245cf5ca4020628305ef23241fe9dc68fe4dc16b9d87e284cfe3e528afa188a5b26fc66986ed3ecca4ac187d15ec9041c159b913a50d1164366c713e4d76e63458d99f6d6c1c387cfaea528284c1c8af6a1ecaa01416c53b00c12f852b05f6bc4ff47460511ef85e8281884af928620d42cd956aca9c4fd04673e6139f4e7b38977f80bc73e41a6b494b0512306a7dcc59f9274484f51c5fc761cd599ece2330bcd391f87bb38315c3d67ed7f9f2a39ad411ec6670e457658fdc27f33cbb405df718262b79783fab363888d7dddc6022d4dfb1af41082fc91ac22f61fecd225e487eda0bccf51729b7ce0c8f41e6cc331378152cf781d04d9d6228015f82d09ca6b969ef5193f46d6a655fda3e70ffc04789e639621314a93f7accacce7bd34e59592a740337674051b155481c08af3f9740e621026019aea29078d262e94af7a576b931a66b05948ebefd6e1b018c73ccb084cf4041c0d089bd23b74384cf42788f4c2683c1b6fc169bc6f26633e85f3a33187a863d005c3a458ae9b7958b557b96ba3866ef11f6b5935eb6e3f6c540e2514f63c004a37ba37439f9f0245681dbda5b5ee8df4458bd333aa54e3a144a11f96ddee8ccbae1c1100648cdc1b4af4b0dfb5739c5b4891522835ec329f255fbe68a2d3b7c87422a05cdef51cfe0ccc94497052ee89d081cb945bbcd8f01b64cfe1b9e0ff9d5bb965f8703880a42c000ee7ebf1527f3ed53d23619b460b39b76e3693be6fe0ab29f5ee76b92f30ce2a86cb4145ae36f5fd5a7dc12094d061fddb2d38c3cc72557d1af85c1df8a984f4dec860006b5ebf7755932a46b1c82e51c4d7e0ecd8f54c2483a274d9a5a6376a40631ae287f7bafe54e84d2e047aa2a7ec765423a8d6488ab8c6d3d9706b6a8965aeb188174dd33a78f06c36d82c7e58e7df10145cba4f285d810ef518166f476b783ea82352f12c0b405fc162b51cc4f0d20363b81fac2782ec5282be696ee4501d8ced7e214ee45b793781855a4ec631db139e9a127ba39f0d1158a53278cd6d7168c690ec55877163dffc8d0b5698ceaa67eda84a3438979596d709483aa05f36068528a6ddf83645f7a2fbae592707064ca11d70b218d07c5568236c604fbdcfa29c232541bcb2a40e8c7b8cfffeb34b6a7fbf5c5c3eb98a315b5ca834e9418c994af303fc4d029d3e360a000d848450744855791a96545a62faaf8f00c93506b81063f2813d608ad4d06b200be8c3301fa99f299126c38a534a10b573b0cc8840cd709b73746d6aa46fe8cec91526d2cd3ac6e1783db6d7e6680bc022fa20856aafa951e1759cc8df4ddf368e86ace9f824e78ec5d300a9dd1b01ef99600fce9bebc5a7cd290c662f65d0d3bd52cbe912883b92cc6fbe3a5dc675a5b67fe9b1d87c427b942cbee803c8966c4a93e4bfe4329cd0be4e5bb235bc57c4768542955fff185e7d1144bfbe5ef97c627da4763cb7e71f9ed9fd9fca3bcd7a7e34e5fd92c01e3ab5bdb8a669c386f7b9ab0b53a4563048b5d07baedba44b7b4bafb90d1e9079c1cb0b87ec9591fd034b23cbbbeb95e763734e934734ecb398d53601a15673f06c4e7e2cba31cc307d5aae152216a1665b236b4f308c1371c3c265ea6971c563574fefb3caac33046ca84ce65a1aa8b191bcebd5664966e83f27533f4b8c8c29e1baeea61e0054da426ac090cd1f5a48f849d4c3faf8a983b55e026a3726668093e5df6379d6e8759334c4c2c8c222e048decfdcbb81687026b4f603b25d04951453a2d7330aa1e618b307eeb467d9f83ef0da9d878ccdd644280ec8f87f61e4adb00cfa4b41b9e763bcebcc5955342df7b9c6ccb0b8e4ad98c402c6898502c7c9abb327af2914209702a8ef7e3ae47b16f3c7cb3307be5b044a456cb0434a9ddc219c999d1b82b3a06498f6e18f3f5493a2ba173498fa99a5c366a795213d6c97fddc064ef459744718da8b9471c78d487b3b6b18de26d90b28054b3d587700aaf9f13ff762c323d067caa694128a934f028b5797d94a4af8314f16b66a4ffa95ae1341660da100c419a6197108b58a5b974f2306eb38a48937dcb8ecf8de21a0d675ae0e380077684cd135ce94ae970975c075b6abb9d4cadf2e02f29decf87b525c09547eac7f1f6a076466a10fa236bc33115ab74a42a19bab48fcffd48bc6269eea13421f4b28137f3422e46dacb4aa49725ff552442f120d60b36556ab234f0d94059e3f7efec2433b743c1f1b4161ccc0a3246b13db98a25f88a0445d6992747804f5164b200e1fbf7b6d976e4754177cd723ebd214dfa29ed71cefeef23dc5bc14aa0b46e82b16294fff9d3bfff499e8500d27c3afd47b580ec7f2687efa99bb4a78efb01c76e715fdd1f9c0ac925a942033c5f3611fdc0dae180d94ffb506ae6bb51f29d3f63a970e720ba14ea1efb7ada32e0456ee98cfa8f195e5be13a1f22f870a885be0b16fcb9229a45ee0a3baff3aa9d9aaf097b52127d3110eb4fac757bed342ee909cf54fa6307528f5125af45c62bf982499429ca0e51490154d7e974851019e3d1ccbfb766e3d54d40ebaed2862aaa8e3ac33c90532e124e92bf5277a9217ab805003fd0f242b48839e1d84c4e1230fd0db36772b92a5a2a8831582c9158a6ac7d81c528550d5bcec2188cb170a501c0823ca8a1892e029866e9e5ddd3492d54bebba3ed74d9e7e1c75cf6d653e8910f9f618db1041f07e1b08ee92479bf8f41025982992a12156d423d65ae429a038bac7f9a132e8fbbef2ff563ed36843ff5e11ddef571a3f07fd103666a9b439cf4e51dea36a15ecfe49efcae0f11f0f26b4ac18e55ffb2bf2ac356d2d1ad43affae87afcc175fce5316b89616b42d8868f5b2dfff88af183d7f41a196376be9e727b5952cf499e049eb5ddcfb309d504e3f0aca0264c110ce1c22d50118f4052b0aac9c55e2d105b9032d91144721009e675b8861a06c7a2170a5afd86db4239cd0f9ae505f56127629bd821033dd3854c60756041ed5895b6b39c11b8cbc32ca29402e65c83141752f0d45decbe88ceae3b730624122749472516ad81012abc38b73534b7ca59ac3f258157c59f7673cd569405a5062ed7a14c624d74d06462843b5ba82d2516b243ab69ed87b59f246819dd2e38d3eabf626eae2b48072eee0320192edccf48e36414f2a04c9bac0b0f32367f5cb4be0729b9619e816f24488d7a75c274b446889030a4fdc33937e1ef426e259d128e872f8debfab06cff748967701d8fdbdfb16394d6f41f387e28e779b2c9949d1de503ecaad32ad3f7ae433a557904760eaf438190c5a18a62f10adf117321c919e7857e9345552b030a595bb6fe3ec08d4ad1582ae4c278b034c21c60c9d931b22c8b7f51ad68f22c4a76f16b7e49b5113fd93e4e7fc3e39ba5b8548b5c19ec364dd71608510ca3a953603b804cb53291ae39a403067d8f9ec3ed5ffe55a3d6d03bc67e4b0d559d87c16fd6c719873b939b8ab8228a3f539514ec5bb07533f32f7195884d68e09d76c68fc8620c23c977c3a790f19bb8ab33862883c3696cb4085829a76c71f88f7bf9829270271e60c2fc48872be3252299fbb04c4bd2027f320a096497a0faa4b8a21f2d0aca60be68ab473eb0035454c59eed90738828549f958a4120c04decb453595e86db11c561879a66c540d4398b76ef011d27c801019366e353e1ef9c0f0f3bb87703456ce7bffc91496299633c1caf1dc936d47bb67628a651fb7f65e5cb7eaa780be3bfebbf7e205decc21197611bff8ab50e60dc262fa50ed220eeacdc612ec952642fc037fa05973116aefaabd9dae55b08390840e865cc5ddd63c8fe3aba836399934470775cd75cfff65be6ed8d95640657308f9da94986dd83399b719bd95dd34cce0ee6b728c4730aeb8ebd5927e0ef7edfbbe5bac0ddc1f3c250dae03c77e6b455fd825746bc9429fade64ca955e467c32b1fbf2415e5ef12a69dd0368cdc09271a0e7470a5746455c2e5a7960cc20fbd64f962510f21ff5a6a0ef7074c6a91ad6ab35c21826c5b47d8c608061451acbb9c216d0063e6205bdeeb00b0a80f49616f79fd4545a738da97285c18cc2dcf6fdaadb4c79874bc60ba2bdbed0c5d670d4400420bb6637e26405f31c9fac00a5043a449846305663c8ac40f621c0c7993f693d7beb9a606fac9e02af48c558d566089bf922a5017ac4796c28cc5f718a4c18a3032f4d116427bf405a2f3d74a32b8af647cf9529520f9f66aed97c6cd1835ee3bd18315a5c1ca488f14a2de0934fbbd719495d0990ee797cda0c652172277a4c751120767a15d21a2bcf699a2aabf0369feb1aad5f71a6b72683108e298faea13bff0e58bc59302683acf19765d136801f10103b0805cfb10364ae88a86b2e9d30eb6e05cf3257b27d207d2d7d42ee28ac3bc73e4e7e4401e48a538937fbe7bc337b497e9eb0a6d8b7c8d36939a7b3b5f54f09854f7be41609b3417d8dcca88cbba3589e1427f284e997796a0b88b3366d05f02422a9fc518bdf18ba69e6be0afbcdcbcee5d5ed3c52f66cda3887b25501601d7bb9b3d00e595f4a3ca124141f37658a2d9d88aee575bd04bcc4cbaba3007d14624717b6fdb3ecd32a9dfd61fd110f0fd03a43780cd50c144fe0973b9da9944a3d342d6204c103b41ba817c36a989222d0c1ed7b28055aa5d213c03ba7306a3598917aa531e2ddc125ac4c7ef7efa419c5821568dae0bc677db5ccbb462227276b4596cd5ca146e5e615cd1a54a6a2a8b5990f747cf61277fe2bd15738659f2e5de1bf839a8c57e17ada0e377d1d8d0b40d7b2b851887613e1e0f03ce3940a887cdd686f58b586e587c8e9a3d7bb6d501169b0ca958d84192605a1f8e4bb558ade3236b9413780ae03e1f2205dc580d37dbd7eaee579bd01e3f4029410ed526b11407c5ed2eb9fb97cc6ee48202e2a6f59242cb6633283379eeff2e67dc9e0c10852ea37e2a34d3d93eea89368ef31295bfd48655515f5a6322a94818de335dc773c016644066c2f4682a4b00de937a7e425e9416b257850955dab27147dbe6581d81a90bbfb9899bbe79e09a9bbdb1957226fe759931056bc8ea7ea0d526f3da61501a9cec0b99d2c6b6734bba81449df43761506dc93d746c1340d4cc51ee9d8834851c76efa79dc86d2d72e1ec8f25d8123efe7b1bc7cd7e807bc18cd8f6a09ab1a1082cae39d18151b6b108f762fa4cf9eded4689a4d4d3842bb764576b10da509182102d7e9dac9c01199f12ca9aa5ddaa6fa91ea8428fa51f228ad7b7e3618ec2bcb1a211b56aabc8c0291cec8361fd3a5950bcb86a34efbd975e0216422475b2e4bfbfc60e132d9df4b0809f8a2126206072f17be9026cc9ad293848fa6594d1cf6491d2dbb49fa2f069e041fd519291a26600f093625d5f02839565f9c607c7cc52287853878bdd309d4d004fc74dc2f112a193268d06c36fa7ccc77446eac378efab8148bfc302d62329adeb2aa835a4edf49e7901701c8d370e1c8a66c7ff6021f64653756e43c1c0ec2658c5d76a2bfdcd78175f6dfb0903d6edfc7b80dfd5d0d0b1ecab4de4243e60ca19d0669401004316dc8b47528cd1f46a2b494db9698fa79aaef0250545d73f374aa938c19a328c132fcf437143dff716b89d103a5d0abf6688d56513af8a52cea3e5f2a11d495c2f5ab77b1d5662b1cbae8491e4bd3dfa014b5c5e41bcb96aecfa2964578caefe69a6e559ce17c78f589a09d8546f5596afded735118d010b2a044510107569a426b7363e56b8dc9c5893062810db45ca2778ac9693194fe3b0cc164b702fec51e6987376cc22aaf3e2c68bcb2b895c1691cc3f682a2d0baa089e7398f98ea42c47161bc83143611336655ee43156dd543645b5aa552623e6964072ae8354cf3e9496a887ba2e556848ec9b462e5e831216c7a33373ea71a9aa6701ceab8910ed8fd22b1096f2a96918454fb01f912f8001d4ddf98d39aaaf4b05ccbece4a84629c9875a03c3754e0601fa320dc4fc291b563f3550966bac47d5dcb866670526472c7029e68d76b3274f60a620b95fbc3c140bb1f7bcd5d895d41bb59fcc95068e8b00bcf084e18cd2aa6004a844c06822b9433c4c6f2b7dc4dd99c5167261186345f035bfea4eaa82cf73b900784b958a8258562ffc4ca96802fbcd389c2d0a53e637340a75aa0ac28a91250a3ca95de46a353de42abf1eef67f0c390dea9b7d1631b9fa63cc062038fd71fd27148cc3db9aa4ee1b2395b6c727bb5122be3524eddfb4454c44f7abb98ef6b8975f236d209e3fc8f130d60f5ea58c72b7aa7a443cee8b3106888a4451baa29c267cf7ba3bf58837435145ad3146a6e0bbd76184faaab3579fc5a77b09004794c4d4f1350d470c9d3910b8a5d8d9a1e22ebd719ef9c3f411f57993bbf3d8c725b977f7cb8210236d61e86e9425f3c08b0abd62944176f5deebd987d770d25825265e9fd4752a6a81078dde648e445c6a58e895b87169df9c9fd3e00732b9aca6ebf1d2d5f89408a2273a8ef5bd76120b466e4b863e8f7fb8878b155bedb02970b90822300d33cc8327905d88c704909ea2a8dab447cde34fb08623e7a0fab3cdfe971f8e2d8bf1d208b16009e00c35f7aa2acf01cc6bb7f0f3ee5e0feb2e607486c90e1641340d18226ab7d92ec25743a6bbaf86d443e347b912a07eeabbbd55e8d94fdf110411c0599315b9e69050f6b870f3e4828f0ca779157235ad63690e39c3c89ed95cdae20b22d8787a8cbf7a6a577ba702cfbc5b6ddf61ea5b30b92df8b73161244563f280844fee7cb3f2583991272bf518ac54598e193521ba34d38b5fbd2f7edfd1e7963799036607fabebd12d9187579bbbd8b5a184e4ff95ced6edf67da2cc97595bdece0df3a4245f0320db5dc2570ed29db11f10eae7bc3c5879ee2928a4f14031ef2d3cebe1c23aec0564acbf32ff0a23bcd8303010fdf18a1c2f1fc61b4fbe4a60e2df56ecff90c0e5930c672004526ffa1a5f7d47b3209eeadfaa2861e71cd60dd3ec65f62bb8deb442bb5d2df415ac795f35437312796b7f3ff4c230f4ec87bbb8324e46a8259fa06ecd2d78bc3020693527446fc45be4b4aed2e5f00c2bfc369b622a7c8a251e704cb9e91eedaf93982b04f615394629d3b7c6106d3228201890b08af34afefb15d5ab99398c9a0cd88a93948b09688bc796e31db489d95f86cf403e297834fcdccc6b7c40a6a460d05dfcf53df6f134a5340c97d6c44e970cebce615c6495d44795dbd5507719d360f8585f20f438374db69cfe4906b853762ba0722127409e9c7e3c9376d50a863dbef37ecc8a214a614ebfaea6df76f020e7e36b0759a7438cae23a131d48c075cc8e1c2f240e5196943a4c61dec2f9c44d1f9c9c410e20c2f543ae9621e0c46f22437ba7a738732571e5882305d90226bb621d42efabe94b222703e9817dd2f192240a5b74ffad06bdf92e297ce5b1702140c47823b1a201b8ffbeceabb199a1a3271a822fde95891fa265a4078be7c3f3b59a3df416b9c69f73886f3583a1e716996198a5ca48533a58b0fe8bb849abc3877fa2294437bc973cfe984737e1e95ccbd1da13c7deb48c54b7bd37d2430f6571914d163a08833da92a2755d731fe0f6de094d9aad5e6b78d7b8f049fe6f813dfc9aa4433161db20def6d04901d0c4766881786fa4c52b03f93db4179a87f15a763f1dc8f7b58809ce655ec9f452c6abe3cf4619bfc37d861d4554ca31ec73cc73bbf9933d26c29ce0a5def083e6efdb8b8fab6b2d01e49e08f0ce04e7f63fc3e5d115979c962ee4bd5909d55452997a541d5c14b070c0c66301e00db847f71fff68307310e0db718170e2191a181c01fc311ba6d595718ddca838cb9aab1cf1003455701e10d58f9373d067ffd3df3bc7cd9db2d2f94f828b6964f3ac529b324fa4faf1083d42e98a6674e8b4b8611bac29e9e4fb0c4fcbf2acf27f890eafec12ee595f6e35e7210fc0818eb37b39ac4e7c839c096fd9471119de0ea5ad7ae4477229e75972af740773ecace941c1ca58359f1c6c4d51dd5667424ee493e92bef4b65ddeb2f4417afacd8b7ad9517419671a5c0264104d0cb2075511093654d6b60cb1d59c674f99162ab55d4df875cca1e82082edccc3703798cb95f0a5cb8ef385b7459be615cc324f2531775bbf08024fba16adac2e0bac08239ead1d0a25404cfff42ce906456ad13e01fed1c8051306de0c8daae2b942d65263e8b4cf0491865985e7b6c715a524e8652586ebaa82cf2d3ef42af2c5063a21ab916bc1f91e78080b6a2a849546003a02d72ae9007865e93cc66544375f1b4e00a9552988fb98f3ccea3f2ced9b14b5982447d4415d3d0f41ee7a56242e23fd03706dd7a7d523f03cc3d65335d62c2202f0e09ad0b80c18c5a7f4446d57ca36fb9634afa92057a909b9a3ab940bb6bfdcf393d5f59b9e2ab92376c18cbf67ed0275089e9202db58419852076ae3d4dc62f284864ffecd5f342","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"c2c5ccfa1db0e41e770d34bd06a4fead"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
