<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Solution for EXC-003</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #217573;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #FFFFFF;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Solution for EXC-003</p>
                        <p>You shall not pass! Well, unless you have the password. Then you pass .. or <a href="/courses/PFLS/#exc-003">go back to where you came from</a>.</p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="SHOW ME" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"28d3d2f3ea0858f4418d2da071631970342fdf86236f309c7df2899b7ad333afb3e3d41574c94d4130bdf6aa50d08335d6a98f410a5f3f99e55dfd2733bbb522b4bd07269e41ad45790af05749488497e0d4eb10cd0f83d604e414975781009ff4e191336cd9918708f4e57819bc03ba508a1b06324d8e9575d97bfad2c81e5942a4fe00be12588d6850965ae5fa65620ef5678b4bca20faa58c536ac5caf6210a4d50cce13dfdf4bab13f19b20bb1829fef11eaff82b71aaad6db3e79e96f95003697476b42007909ab8d29631db7efd50800b3cac720f59a1dfe8d1682754649909b3c7aac955f5b99874a92e4fced25754e5a9079c81ffd05eb6c944c9f332cc84ff28a1407d15da969034603a57b6b4d9e5855b6da693b5c8dcc27510f4d7764428641e8beb011eb1159dcc868bd279f820a403aa1200cb926ff987517083701a5e3e391664bd98a08579f3e30010208b3af74589ef85dd4fcbe6711ce5ee518122462cfd5af1153ac6b2ed178c804fa5356d112968e18fc4b91dee36727b9a22b1345d3545d6f6475925e846a53dc6569a612a97407174e02eb1e8b4f96974fbb7afe3f37bb39cd534fb2e34d46c4a23e452b7f295fc2983b9d398155c17e599d89c5ef2dafee36c7be499999092befe9f09d2470b351eb3834e6433a3ff0d877f9f45475ea48b69f8f60ced050d51ac39f42b6f7293fa49fcab81091a5de386052cac9fe8281a38166e02f75df94db12d96702783cf4b1a59d15ee302c2db2d998741d424e52945720b031627bfcfc185c5ade8a43a5a5f52239acc28fb3f72042b9f441a94c3437e2d3e9d16fc0c9165efff3398ac38c6aea2d3e7932ada6442e03ccc1100709e63a69aba4f8cdb5908ed4a5ec69997a2be68450e5af517efdadd226427f2a5ea04dc0329a826f529cfc48bfa4156bb578d2f9c0aca6bface2dc2d49104e31aaa40a8634782cd63e5841afed115d274230799f82ebf4bd3f81c3e27be46a08e9674336653dce74cffde2f4545e61dd690417677ba0e33c0d752dad80bbd789808eef304e247234c794530c9f4c0fcf76930a26850c574dd62a1c8cab2e54863e29caae9e52e37765da63818b5ffdc9423a7b2cf4735ff89037e61c8040afe704ffcf65fb12b39e20093147ec5ac086e081c5dfdeec72e10ca83566d747dc38219c5920a8ae9c3c063e112ff6a846beebf32ad1baf5d1b50427c753d2041d49c8667b3a871ae0851e05a3fabe2a00fb7635611955c70c1dc6bb0fff923c9bffa62bd801a5e6ba003d84c1218073c559b1acf038942cd565f5e359c3b13b3710dcf3e79d80093f1eb45f9fde48fe708600e53619e433967624cd17af2424967885ba8727b5c2dcffb95f44340a0ddfeb463e3de63152e6310a8a37a4f2000a7bc941b5451084bd2f1e49593b6a77bc36e470a88c8f3f66b580142e56e7123241125659a30faba4c016f9730629d0e017d61f9e7d446f32672480157cf9e68f434ed76bc13986cf52cf2f391c1368fb0d27378069bf368c302387ae50747290d7c499ce4cae151f4ca2c3bfba654a0d26eac6078dffc9e4336466de14b9d153b7e5786d6d0c43c8144dfd5e8e10e1e2d493a24c5b4c46c9c47c70684deaa14f898b9ec5b28b5a2db47a7f4943cb686868a2dfe41dbc9c711cd24ffc34b18fd5437408600af9f542e56c18bd8e09903a492aa3ecf6874b2da163964c7aef80cda4c86754d58fbf24a67db939d0571fb78265b70c89e197193e7ef4c838852e0aa12225b9053c5e60f767b00239cbccc5ad5b924e7c1f7862b4b6f0b8ac4e21c9425e20142e4b23fa68c08d9f44a6156dd1d5ffd0bd37a20a9fcd3d1498a1c163d6b793eb943b5ac1684316f60142aa81ed5ed81eec34e9d7c06653966e4545c75dc18408d48a5cadc6fa755a155d2e95f895723a68d47e6e9b79ce770f4d233fd36143b20952aa645b98d7893075dd4c2a28297856b46323e0f9dfb3f3a8047247b820ef1dcc8b6d13cd0d0293389b40734a7cbc20788f4c5d2ce933b36fca3bc764eac01609f5e11d622ed61918c276cd2e7be3934e1401e5210a86bbe90d30b5ce36ae60566fd74b4d3dfdbf4916f80c3ecab9e2f434f11cd7e077b5f9608a6ebd7c2d5d90f21c88d2aa38607a995c6a36c07af14adcf5dd5a0af2bef0cc447ce2ec5dae0210182c87b71156f79b21cf44beabb8f573280957f8eb073ede271c5b75f79b085d72de6090d3a38dc1ec68be971cd49d355ec919ec07ea9ad5c694cd01223a97a2f92d2112723917c3c81f3ce77bd0e988e51c75ac75806a0f3d430f85b3c093d24677e43cadb51e923095f11daaf3f30ef52d25a4f598322c660bf955a6505b20af50e5220b2636d56d455b5ae493547568bfe7d4fb9ac37970fde72ace01f97e70d5e6abfc69d05cfaf20824ee102c69fb2cc9ea24a90f8d53a183d514df3e6e434443d67f5c30c82efdc97cde4d03833d6a6beeb84f722d07e4cbfb69b927ee98ddeb08a301b4666e705752c82a6e42b0c406ec5d85fd2838857fd62fb52f9d0bd0b0c7eb4cd400e1905a75488050d5b262b84a07a601c05c4f15091e84500ec8431b432b5afe31936095f556fb108cd44ac7a7f17f57a65d4b4457795cfdf79fcd2c41e1b741a96684c579ef27f027825572cd77493553acae6cc00815ae82b3e2c7d8fabd3fca79991e0cd42751dddcb397778ef73b42432e9b0f917a6de598276a5e6a66ad54202bbe4b9ce4b631f5f87e84d01e9792d3981897f2ab67674094c5a254753a5f1ac8f2ba44f4e876a03d63821589a046c46fe9bce06067820d4f7b873ffe922b8003518abface04723694f72f3ef11608149fd9551624c3fd9276a94a6a2ac86aec15d44d2579d838399c8c731a0753ae0d53647b104908045ac851de8e153d7751302477b9bbb900d0b0fd3a5d847c86c84929cca35219445f9d702f91f710361eed25931a0c2f0d93636129d9b3b023a7193a8d2a471d5f69460202431beb0e63a1441b0cce7640a865566b00bc7deab82e83b2b610bb80382f1a2268934f5af4ee40cabf8ef38454d0a7b769912e8a7d6f0fc17f1c08739a6f2199baae009eb9904b161e346496dc0066eafee626663f6860a5815ba61fb7b3c590b30850fc76ef38b5b9d5e299f7229c7b8742b9760cb61a096344ae9cff5512c8b0652053fbb92b45612485922ad8be1eb6eb2f6746bf015328bb505424e8b5e605cfbd454b18d30bf5dbc0c0372e295ca78c4c10c75c9e6a07f306a3ce99642e54e713f92490ac7870d0f4d22d50881cb2641eae91a67bebd062b9afc5b6a9d409ac78245342128e834e854f0ff369225d27c7b0dd7a066a62b4983a0709ef5a8705e2bf4db5fce8d2c29568a0d00c7f653f203a31dada69c8dec037c5fc650fefaa743e1edbdbe4676ab081635fec2c5c8f2c6753a88bbea56049207c37524a10d21cc1f0a87379e2141217033e276e813a0e7a43a69acdc6f9b8926cae40e62ba80357c70bbe50a394e83f6e07a6e73f6f32cc15e28664c40010536a2d47f06dc9e3e060526c7162094eb5b1077fd842d018defac5769b9cb2806fb8c61f2c3deb05b7289d96760a0efeb82d803017d8b3f0cbdd8d407820f2f5f789764c702adf1860782392f49316b7a11e6496257bc9e4e1df714dd6c42b365e1d9174cf3cdf1ec98eeb8fafdf55aef0a1f3a3b6e923d805f874d52c2573f460f4c682da29ee642b5c85d5353d5353838fc687750f13da743c627a28dc1e7507a3873ccd7ce40134afd2bb5424a08bcd6b8390eb0185217824a58bac8dacc3df003c5fb42e34f65db3bc21833cad1c73fa249dd480c60e8eb5e4320a8d93f9b62a0fa60778c760e88810f1a3351ec275b02946af77c6d6bdda853334f8f6aee8e0b405d40b01629a6f767cdc63746abc3aaf3111cb2c58bf8fea499c11e14de7818f045586087cfef58039766eefb4a69a280cf28ff48405de011a27ffd136e8e8aebe4923ec113ccb31a5218a3f41f38f6beadeb1f5dea321a96a600c254a306ce6f70690e1836244c313a967d381703b18ca9380b0293a79eb6c0bbce0add47964e34ede606be2ea9c614c11fb5b87d06cc806998b30cd328c74ee1c294b95e6d1c7bc892c5f9f6a20c76fc34c52426dd49581413f4b4888a489799f6758e6d1611813021f8c8092851e70d27411ff42acab360babcdbe8de151cb44d570acea90cb2848a2de34971e364cc7bf0c1ba5e64ef5cf52aaa2714df15a415873221f44637518a081a58f4cbd22b80092130736f1a4eeb15df018057dc8a39267fdab1ddcbedf9cdf8faa278f2566079edc49dd4b61ae85c191e52454739323d8a3b1f652669d211bb4d2de3409aa711d3ad716cc519a4f905bdb91f89b0a206e32ad251e4a7d2b741c656e5444fe2c43c403dd34bd3658fe45dc8196c9d68d6bc430850dfc105a764a807f24459286ab49935a913b4cc66b64394f3d80c35318cb8a0a028cf48b4abaf34cf504b43dac0056ca7e71c546b5cc9ecdd8ecf2c495db33a7ec19a3bf36500c518baf1fdca6c0a20253b71f7fa275084e7280e820d59049872d7917a4d50f4691a1d67f68a3a26cbff171976afb183466d84df5a1513fdcc5452cc1940ff78d6eae308404f69bd64b2408cb881ced2691326ecf02def7a8bd7217886f5a5307ac8df19ebdb30b63002e50ed64320ed81a652ceef364a260353b2eafd5330783f695bc38d7cadee6e21a5053bc726037e7db89e90ebec6ddea2e0fb0705934ea0d8040fde1f8caccf745ef212f0ed96d017948a921aad4a9f0635e74abc30b5b08cbb9e76c61b43ba0ac307a2c04de22c5924ebaa52c84a15aa8f6a49dcdb04f273a1196a379cec2ccd58da871c7ec13ec4eb9f64ac35424d07f986572d05f29cc39c1a2972826d6d45a0cb422733f934dee1a5dce597ad87ddbd615e227736b9c396cdf089d8c6cb69c965f757e324aea7c6840cf0992dd7a395002591dff2f552469718eefb910cd1de1f55bce96b93991fe43b2201b836d7e83cadbee1b3927d4985d4e2fa1293b18ae039536e6461458a885d15a00fb6d31ebc0ea38ad6c8306b3753f91c46816d1af37e3b352009846604e70d25f8b68786a46f44cfa73dba726db36e4d5025a63e95b2daf0c193159091f796a33483712ea4d0f8945e27798cbbcd8ee5a221ab0b897f7a129ebf69b64d28da75ed60fab0f57463b3368b465f612ba5b367969a3690f234652c57a92e7d28c1faf6357f0ebd139dfa36802d804a69cae31b62aea0962e0af1a0f8f6a91bae7e6bfc3a5003e9576513936ecfe217e80b22935be921e8da7c55d271da210ca8813a2bc09fb49547d67eb285295d6fee3b1ffd2f76f90d986b10bae7e9d66d84393168e10aa6273da98136ba64a8f5206f208238093159d173d84d3894a117f9543f859935ba15b532ec44645f333b077db228a5b78e2e119e809889f810965e7fc4c7b160830696f99075d0c8410b8eca92e0f8003071710068c53ccdaf4df3ca264ee39def03c53fb55b11e60a72344e4ec168cd9d6dedadefcb9c781a64f68cb9b469733c3f8bdd4bfc8c67a7e0d03dae7e08d0f70880d52d64ec05e8f2b471aa8c1ff06cef45de008355e38323ed86e6d112c8192e208a7bf926dc4055b1244f0f4333e59c384500193144774bfced76ce92c5e2676d7331c073299aaf7dced0425b46a485478fd612e198c96004a688b1648274b484feefb167767ad04f00fa7b14b685bc9178bc5fcc60f5792e9c46b590dc7d8ae5b554ec3fd350e5c90a4864b033d4c856464be209494768d5c38a43be3a5e6c3c950cd38b1954cf89a87f2772759d63d580d64a23d6eabad9c0a4422423673208b5a534b6a40555444958d2f468de777aef1dc091631b2b0a223790e276e516210d8fe0c26124a13412c5374640c1a0a4fa243e5680b1bb65591443404dcf3090137b8de5424fc8109a16b3374b4f6b88b2f4c5d4585a06ee4ce90fc98725f7197c94be69a87acaa960a19aa6dbcf3e1cdc28d063d4ed4ee75b88112646efbef741556a450bf621c609a6448edff6071cae7858406b4b9bcfdfe2dc2d43cad0cab83b4d831e4278466ad1848f447db3cccfa7f68faab95c6219f44dae3734d96cedbee0d73a6df8a4b066522314fad06cd637f3bbd36571a47f1a1dd6e16e479e1f44ee8f9f99965a52d1fb350417b656367e9d81136ec3ed44c5f437d605563c67678136d624800013e8c151879e40dcfc98a7fbe641e4168bd4e4329c4728d9d76f9d80dd6e76c0ab0ea4ff23b8d847204f00939601d4a7898a64e8773afef526c7dec08c9055e4215e192d7ca89a9faf4b0f2029fc912793f6f1d072e639f6e6811c14cd66aefb9f4e285d1f211a0aa89bd0f42c69195bb25cb870b7b2a8fc26f39252442faf2884e5036e75beea0f2314450dd8c458a46dd4b75975a2e5da381dc615ea8865c1b744eb878aa9bfe14f0d94cf7a90bab55284ec5a12bf1a809c81b236561b7a83c9cbfdac0a9875001491eba7d8ca208623df84ade1ad4a2c4b8d58862f73779eb2a5ae70eb844ee851f25411dba6dd07c8fdec378a4c0fbc2e0cf4525b0c68109046801ff5992c4f5ba01ca64aff68074180c9922ffe05e6ba49c84b59c8f05f8346b9405b60a59467a59fc54675b1782fc71ed38d90c9bcd2eb06fbe6c1863ca498466d0ed6973cfec102f0aac0233a3764885b7831d81ff44646594d429c6fc96abf0cf00b7f7fb5477137e9773b3c85770fec60a36afb2ee100cf9caec36365c219448c4fea7fe817bef6b20529b18678f04071e629bec6eb9a284c510faff4875732b15122c4fc3a61dd362c59faecd1e92a3ef39cce2708d82665eb0c56e96bbcfe32ceaeb69c625af4a923f48e0894a753c16bfdadd73868fbf9080e76cf0cd1a443d7bf63f2479a5b52c5a488b6305c6aa77fbbe7f5f37c5822476b91abdf55047e2ab1ae573eec614179f007bd186ad9e132063364b15ac041acf9b8900b5d06818756ae2c2b8f88b887b3fb0ee74dac52365f80fd58f0ffe8400e987db02c6f1bc81982302789950d4116c62b5547a0f3ff484afb354a3dc8a04f2921b457e9e95fe1f9024fbd0923e3bd044f67eaedbb5b75c5d46c28a2beb291314c0db06ecbcefec03dadd6b4e9c7314baa862f6b58bcab3938313b278504332e7d8b28f2b5160a9b6798a6c3f2897131e6ad2397256abbd41db6484791d675e2bc6dadc2654dd7affdea4ea21cc751f0a194aa6f7d7d58af10b15511b3e3fd2d1e177f726864edec471f8418b9089d2bfe0f7f2a10a0feb437774c02bf35145b9644123f9f42f6bec2e94a8c8c8dcb7e44e78a18af8a1a87765e1aa41c41cc35432b8ad8e92e7652a342949304073c67208a6914987f4b16c7a1b243a4e0640e9ae3335c0c0081b2a68bb27b979bd6b096f0dac1590b6bba09f50075d9259fac6c48ad7e2dd762ee18f88a32401507059855866254b00ea6dad6d039b55338569ba0f9cae794ac72ec9c24c299168f579af9e7492f272aea214a95251243db62e2c7c5546635ee0e6a0b90181f3bf5f774f251e5b6c1429489cba27590b29a28a3b4425f99f437df8bef3bcc8bb3953285edfcca029915e117802fe8574328c0f86a21a6ea82e9b612a1d28d6023d496ab8ad23042fcafbe29e0b0fa4c389c779bd655060a74d2f41d3b39331ccba22e673c9cfbf1f3985900b6b580602460770927991452764530dc0c03c4fb47baf0844eeed5c6ad829c0e67f8d6b008d1352c81478b8831d155a82f3c42cf49f34890b6b9909b77d041b24d2de21aaa3d0865e582b738be8484dbaaed1a8d6985b5854499d2ab874d049f196e552b61eb45a3e535ae255325fd5cc60e8c9a4e7397abf4434f5a3862db5174aa703772cc122e1d5d680ede32ea4727f932f5bd7c23a97441a5aa7fa8a676d504f29cb31055b914c00a8842c0ab35cf0a18f7fbe9cea95eb8a7e6db7ef8628987a863fd88dc3fb57751287a59cb742bf4cc73f75376df5163a129af27c545dfe9b6ab349183b8efb74ad686a2622b3cfaabf16de7b2af73118ddcc419f1c2f6de8cc13224cc2882588a93e4b1837665b3fed5a056c97495be9a7f2f2471f0acc946bb646e574d063871505afe99539c8de19f9adfd172f5b63629f8309306020574f2b2a8f59e12985d8e31c49de2b074714cabc5a4ccccacb2abe29161b490edca33c092ccdfaf8add3cf89d9e2fb388dbb4f8c3245bdc14fcde7d64da4053a73bde3b5b6d5eff2456a4e413b8689a7bd12d03038502e6fab5d452e510e5652f7ad9b9476ad33c2a67ab57ff3333bf49e296ae65855009cdfdd14b1e268386368607749b58c5d281155dd61431c531f5e8fe4c7ed301072b3410ccb9922e05f8dbf568fb324027ad0258d79f219b65ea69745f362c9801d4efc424cc03e94e91e645623bbe8904f56824c435f42ddbbbc208324f6c403f826d95a0aac8a190a98a086e3e120be5b984b993a21884a48c47bc4dca228c1b33ca396e430733b63a7e67e8882973f9423f2565de29bad5c5c4b11658aed67718e22d212ba2391444e8b786cbf1b844154d3fa1bc1200762f68e7d34186d5254d69b3f2c70ea030aa7173ad46910b44b4887c0e940e676deb50120887ce38aeb6788cd5c050068f3f772cc67c93c28052797156e0a439963f1acec812109d9b176e9ae9f6d33932da9dcb17757f43beb981a36969a0d7ccdf007fc63cad16cefccf121a79d6ce7a41f6bc75e2076594728821746b9fd224d824007e5a2132fffbe8a46675a063cc4af062ced2eac0e6109750e2cfc764ef2a29b06acef7b68f75ce7d66ae9b28cbdf851972972bbc7e5f9a409e1052100509838695a0b4b2f8db417ec8e3058e8cef763d898a7462f1ee00da87dfbf136e2f43af872f1ad4a93124bba35a34fc0fa6b8391ff23aeaf59b3c37e73f2e51083da41a942be69d4d9ebb5a27294680b2163a2dfddedcf9bd932a092a8ed079b15c4a403db1553ca1279c75dd8cc37528b73ec711a97ccb1b064c9700774c66dcf8f909674dce29d8edb3afd40b644d6fc5303923377b17dd3c44d6b9a44976a2a1155cb66d0056bfdceedd6945b85d321c1d5c17ce608eb324e0a3914c2f126c869a0a96f63c19f62b1d9983481a0d59c4ab3962b10acac2987289d5c25a1893e47eec14fe27f3248a1de5bef0c2212f86f0b0525920b2bfa0ee53b19b2b00369363f0868b959ebb00b7be65af0876cbf4c658c1e42d0b7b7a46dd0dff5e88bf620720954ae6e29df61107e24717af4889e9b48679563e04412da2f1ca763a3d23009cd3acccc8f3456e134025bb549f5a7bd74e64b369fe59f478f6c36871487b23b6822e5671521a1d335b4d0c1fcf24bc95effef3e972106817d2dc4d68ba72d207bc52081d668e0349803bb617410973bb7e22c4f6fe858d2a1a45eb38032773f37b44230a2b76e36e5f60eae3e5b06bb2eef8ddc9f557c7acc012a26eca61d9f3ae23222fec4abfe4ac392e0e312831682744c948d89c6c03d46805e8091908b4792323dc072698292ef3a113dd0844faf5eb245d8fca10d201f74b513dd9ca72f52c818f494cb7f58748cebc81760bca0a506538a1f9eb7141ed30ac371160bb5e0c56646581d360ceac3f1d498c873ca4804bd71253d715949e9e78964e5a87a492c5c99a91bcff066594ae5e4dd218d4b63ac8aa8d6019e30b02faeff1cc1e7fc10d6006800f61c5425b8f7806c5e7fe5fe38331f51a58a3e6ebe0f5e6edcf0258104a548ec6dbb9927f69320443a855c909a16c14156677cc1e7a1062176fa89132e59fb52c6fa1e746e95efa34b8ab78dad2e9d44ce10741c561c3849776fc481fdc7b2bf586d2bd79a53dd7ba6436c05afa92f955b6268fd970c1d05cba04b01be3cc4d874cf2e0cd230025ba567a76197bda616901c45277ff2cf6b7edd8a5f7b9b5e99e41394018c1a5553646c3a624c199eb60972f2384275ae2f412134b7addeea7d2bbdc193980b06bb14a41296479b3a0c5dbf573f6d4de877b171d79f07991a7370b2cf249158461ab060e8da77973b71602b4d8dff37dfe5687b190408cc8e41f5168010ad344fa29d026d43657f9b2fda2d0028636d6e9b57a48912dfe46fb67a9577aaba575467065f2c05dd077d7e52fa16e20e26558b7688c0c4338746a0095da8b3c2ff2788e1e42ce9d6b75c7d3c90c2f706041a1a9015e1c061a1df85044d59b939e439ac9cf2e9518b8ad229e794517853323ab704cd30b500cd5cdef817d675e4d62f8cd7d941c5de69b20ab99c65d43a2e043c0c0c8fa7dbd30052f9e98e0c54105d910b9339e808c973c5fd85585ead4b57f4827cd1652a5e340bb40fba1917e634638f4f8c0fb5906bb20d17219256cb98b3fec66a5463e0d2ac17e9099e5a69da2d1b2acfbe5068e8cfdd215dac682deb16f73288ce2d568d2a1b01128d07d9c7fb93a459c26452eece801f91ea21d9a49b6e4c1f93b9dbfc2daa647674998fe22fc042ad18f5ac3e2a32b779ba8595503e1f3746fa3ee8789811fbc9bbc5979530d0d14560b5c9265f2fb27760e671fb818428a1c779f02bfb685bb79a7f585ac810ffcf290dc0470307cd3d998839bd19d22ca2e83ad8f5d6edc4ee96573cdadc61a4b9d2ca014a0e899fcb9610708377c0b3f89019e541654ec7a68a42de68953739b5025c28551d2dded830f89804598f727faf4ff17538941467dbbc90c2e0c301a2c671bb4592b6ee85e36486c81557727a760f12d53b158ffe94d9c07384c5ed913d7d1a528ea0272c20e748a945a2737d5b2db4cb48ac905797e9735cab84bd232901db207a63b24d50a1ed2a96adb329dba6f4bb986101a29fd1350bed3ea6e363c7de2297708794fd0a87c64b69adc401361b04daea7285e99571542a511cd161dd85d4ae71b928376a01643ffc7323ccc8e75279b2e11f92d304f161243091c17a20c5cfacf6573a8f3126d21381aba8b4319450dfc7b76a28a41eb2b0bc78a974263f596ac4d184b85e927e2bf63d0da7afea9bf2e8d184fceb83cb9a59af2b4e9887b01a3860b63948b5616114188ba54a7d6f2fc2546443587959415d324dc9323ecbd2138dcff581fa023637473349c2479d95081c4751d5d90ed624c531b226dc7c6ccd94a2e3123443d201774bbe38927010adf94e2c43f05f22a0c44fc941e5750132964d4377d6747263c8ada63430864f13a6f2e94bedb07745a418d9bfaef439a56b614ce319f9312532e84c3a97c5e6f2980825027799b4ed1dd6e58d4d17e8f43883efbc7003675d73eb21ffcd18c67cbc908c2e20ca7a68bddd7d6692f995552f4345e433c7a8137c56fb0c17cb8eaffdb995ed42d57a9ba53d22d1fddbbca4f81bf33eed8cc6cbe1490f6fe21e96ffa6521201bc64fcaa3425e39263cc09df7c81371fb9c98be54b44786c2bcec66c30b1703852f29ebe73ec4ba1eb84f071da5a184122e02492d14ad9a546cfe1c538602f814e4838cea85af0da882960df4803056a8b17addf4b37ea7c819f977eb72b71eefe5507fc48c4e92ae2b3b3cf19f79c7b87e7a365c74c442c7ae72ab21017acfd8eb1e79db413f74fc24cf3bcdbd5155ffbcaa7f6219f6d4ff0f63da620ef0e20a578d40574790225c4aa205bba915b8721bd50eaeb4d71332661d1b0dcd667d7e1b907740cb461191c53b1866fda628c060a1693d0c2688b99988396ffe7e2494616eb81badd46c4d9110272ae9793d8387d52865356ee0e4cdb96c2d875c8b5f761fbb3c153d1f9107754cdd79438c87ee28943fd73f4a1561eeffeb755d41801070e1fc133bea7c6eac83920181190db50fa6006775c7acacb97df34fa72653c252c39aa8264dc353bae8bb743d5b2048ff91f9d17d20599581be37368541267a458531c43dfd6556c5fd9043ace81e009c704e07f1d345bc28e10974fd6c88264adc40219f85a4e7210b82281ea1851945cecb1fbd4145ddecd553637736d310a8204549d9ae06aa0fffb2ee08617930a744fca35e1ccafefce227a8493a96819960f5b5d43d2f6a5f358ca13fb25519605a6d13ce679c9c991dcf3ab0eb5b91f601f195380b73c065a9ac06a25e82009e02498e010cb2553c1e5c636f7e274dcc385ced0120b8325dbb4f53993c704e0863c52f7b4f77aec8b5ae664961519ed6f7c3dd639bc3174db1e9607f2da0f1627484d26354014ff8e0bb8597cdc8b6817cf5b782cb0c6a8a69c95d53029df1e64e55b45eaee1248051a85b98ae7f6344a830ea8b5d26b01087aebbbf1c16524cab863c3971d54dd5d8460abe5db2e77baf0effd273be3661731c3e7cb35944e727d91080c9360bf0c846ca64b4a47df0ed47190b4e96543486381acaf2fd031b337e4b26991a57bd97efbfe418698721d61c0f8d8bfe284461cdc793d4ee0a3421ef37805c7332cbc05d0ee11acfc8ed27b9e72d50d03f4045e9c704526bb5e741baa0551e03b0cc423cd06c98954ee54c52241493f68c7a5d8d48bf2ffb786fdd75e13481cee1ecd748bd4f6edf00280b89857feab446190a48f3e6cf4db461d7280a1373b0e4b442f778915939dc4edd3c62dedbffb8ddd7c0f51c089560147bc9ce9a8d277a4230786f5ffd67cf6dd578aec9fba2541c814e0dd4cee685545c1361afb4c85376496e1e23c654017edfb4084d7e3f37cae9a7f55b23bb36f9dc204eb82efa2b6bb19fcc5c2f33757bf6fa3dedf11e9fcd29ae6e9ebbcbfdb16b4fb58a691a0115ffd8ffe5471f339e4072c972631040e0a71ad1d7f7f9468170f3d5266c9e4ed7d311e2daad827ef2a1292dd6f0a0d0c1a019fc90aa669e5aa93743423f6f97acdb69343c83c7dba8c657b567a953066452c0176f372f613971ef43baa9d33c4e794d6cc95c6ea69dfeb86deb536fad96cf9966b906afccf61fce1a75868873fc723ff7d2622b66924902d1553a202c67a64e3c14d0694bbcbc3fecb1a6260d5734cda4b2b8074f508eae7a1dae4895480da74f4986e9b2da9bdbffd79cf86c8df3b7a8e485c4c1cf3055c64d7263dfdb339fd5220c8bbe232ac0027ce477dd9441ffa657a16cd8eb5666bdefcd8fd27fa6e43e4392bf6576c14c0ec5fb5a915dae4c697b157d59004d24208b8c0394111bbf9df2237b332b4ccdcfbd59b2b4e7aed7ecb529617bda69b2d0189ef89e65ab7bb8e00f2ccc52c9120ee16c7c6f02938263aebaefd826479422627852f5a6fa4c7a44adfd4d88d0d92c908376d222fbef032d521e01d1b455b4a04f5efdb94fa0554cae88a4a6a86a0facb2f5f0b41376311b8c2ff2fc32f0587235d869b5082dec2a2f57b7a91301938aaa91c27b8efedd48af5ad508e9050d4344b97297a1b4515cf7fd2a3c822db6d1e27a4d169bb3f8ac2eed6d836be77b24db25218ebb2759824d8cfb4f470939360afb57bdd45d9dbc48f08552c7c79201fc6398cc5ad138a353ce7f3a28cb9c5f22486a9af81339095f5621d09010f971b6d316beca07f79b113ab7ccc918db816391ab9f7f11afce19052ba11994ff0aa7a8e718f7048996f845b1317439d75cef500da6eb0a81f73d3386a1896113c4a0a8a22eac473cd154c94077a02692684603a875d877d65f9803eb33bbc2ce731fc8d5e74c8d3d6d3eede7c185ea87aae94017e0add0202635f726aaca74880e7b3f6cc960d8adfa8ae3aea7fb03d82d54a6e4058ea4bd1d097c31f1c293342255b5607c3e1c0c1bc9b6abb50dd370ebd1497d2c32cca1d5a4e9985fb20d0a441944948291311953e9b97f73f2bea4a2d2296fafd122f6cb9656cce647a385971142d8426a94cfef2692e394fdf73761ee0aed73bd3e6d00c10e49d5ac621edfb73bbe3f762325fd335c2db3043448f6e865038015edfcc1271c6c2bfcd387a6904bacf1ae1b03ebdc5efa7778f6b019570f2e4e4a51d4198e18eb5a07b5bf7028d21922d7e304b7b55f86fc76965ef645123ffd96294598f7e340a8b06d5623cf8a30be883bc68007f5a5fa5e6bb5b3c685927e548f78e99fc85ab5673ccbad9b53cf8a0790f8422363d445539f1fbdf5c22ad1cc8511b009402143377a376f3c0f1f97d27a155b903d475acd6b0040712f568279ce60ef141de5087f11610900c13a0b492a99e5da4738d001517c51bbfe572c1a6176ddc062f3e86c58999f0b569568966d6041767d4a1d1c0e03455076060760c30d109d3accd5f028eeeb35baba5855228b0a0e21fd0edfa40eebe8d432caa6decf12592733a8c4d9c8064b6b973de79783d446b5e171a134eb59795875d67bee63f2f81908ec6a0214e2b55976eeb2ba809ee456bbdbd9f05d7e3c83201e089e943e8f4d1425768871bdf145062be641079de4bbf8414410b510d3f30e6418f2d1df76f43b28decd8c87d21a177af22919e89810f04ca9e37d4227a93aecd700590d6db46bf975250396e1e15b1aca88410865fc24bdcd2e287330649a7d0c68a09587cd77f6980b0a5b7eaa5f66a059a87c708ee0f488fd16e6f6d131b2ca172e2368c4fc67b369c8b483ed8bc3b1a734b2af02b3fc64869e9b76b66e69374168baa92642ee3ce9f9b2f7d963f4a1818429087f8695d684221199e66cbf7d2133d3f6061ea507da2cda805c35b718b13b457498167713dbc7aee21a6c62d90c1817fda8fd38e270160195ee750f49b024f9cd383254050dc5b994c43c6249bf10d12599d359fead1c4c7af81e673381b835dc43f741f070661b47335704b7325d1574635ac450ba4d4805496a8815dfb9b179f67d35a6cf9dd0b5a5b533ea969f139598d6744de672d2322e788fe24bd73479f0f80a9df3146202a4f7b592db5e4032a16d4cd4cdf3d6746667c7238cbca7e3bc5ab7f26ec507fc3c2c283a24616770fe3f7052d23569d4214abc0861c31b4b98ca4463c14ca77f0095ecfbf8e2c127325b23c511f856c42322445807b3576f068743802d1e079b6577d4694f7f64dc7073d79e44c0d20333e28e2d41bf4589f6835375f1b0c5d9d7b3eea6e16ab08bfd255c5a9a37b06de3dfa8f3ad1715c69fb72c0c9c83de8d7844b2f617bb0c2a23d1a599383fd665337891aaa4cf0e6bf739f6871b668b1a3bb9383407b2d7e8b2cb60a0d71e2ceb3027195a04ac7efb003f6ced1f6fd8ed3bfd5979af7e60e7fd74fec8a678e54d373e25c270828afb813f13facf2779bda1ccfe956eab2fc6408a1ab5022947e37368bf33a7bd92e37c77616ea23abba16484ac0d0830f57a85ff88eb792c7017061e862e1aa1b3f6bb7c89b14b62b8e5f0c9398e52a3dd654a8dd46a252c351a0c52","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"484baa4c1c6a1c4c5fc2357573c24fee"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
