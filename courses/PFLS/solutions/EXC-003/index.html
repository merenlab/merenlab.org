<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Solution for EXC-003</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #217573;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #FFFFFF;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Solution for EXC-003</p>
                        <p>You shall not pass! Well, unless you have the password. Then you pass .. or <a href="/courses/PFLS/#exc-003">go back to where you came from</a>.</p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="SHOW ME" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"ac2ad5d959b704a542a09151366d35512ca2e019e1a5ef943568cded654a38beab153c67ef2c84f63a4688460726ef8774735db657797b6f6bb4b3f2accd873e770051c6146b1a0e159fb9e7f2a2f077f53f7c27346623c8b9de2efd12d390251d9594b2c862a7a56361d8aaddc6bc5c5eb7f383c93643fc5fd155358724aed730fe0eefe7775134ba6e5511f615a687a191d40f75cee0909b21bba67b6f56b6a98e8653066808ec943e86b979b8a2254446bb4a78a0e34a4a2cdade8e209c481900c822187374eb22ce110e2683615665e80b9cf701ef9be2f753bcc142bfe5c3fce54f496e0dc5274f254a7427294fdbd75c0b95d9e3d3758a7b4b534e4332f8bab7f1acb9d743c25bc24b8d984405b9d71473e9cb3f1fa6ca6f422793bc890c8783b1140056d2741f0fc4e8e42d2c861888ca9d700359d3a2a87ac34d2b365e2aa02b3086f10397d64b29e1b0a13f761b55467abb5f4da3300f90be3efea8fa21da10f69a3ebbc4c82e72ec8143408795499ca93326ec0ca58faf99197a9db52b695be2813d7a50c0183e77cf1b981a644d56e917ade1649c56e1915abdfac6ee96200c547546b9db6f5e88ba3fae3a27df58f36d701ff2954f2da0c429db24cf35cac2649badb8ef50d38e9f1c33c0812138ba88df4f6b149e4f2aa396788ca2de53922e57b1b82bf426b796d3c3b06c7116f1ee37b377951a8320db8d8bf235befd12178d51ff782f5df89cb7cca67ef46048f2a93ef92d36f2bd20fac9af7763bd116b730e2a12f347700558d4e05c9f2524d7d02d79d2c177dfb80d1ca6e506632bf2539a3aabd67fe3b7b37ed36f5b9ce9dbb8c87c5d7bb0a36b3c376f0ac8e1323e1ebaae3b2862374ab00f305628a9f89e1ffde61737219cf63a024ca1e5496382ab2e3dd55c9aec867701945678b6a58709974cbef5f2bf5e826f09a5926e5f7b0c2f468c6ccec679b7f47e11db9e299fc7b5cc126a0f0779ed8cbcdece89fcd05a2e07219c5dc4ae59977a059ef735c644e81c99615e2b20d844a49d1558dbe40484049c983448eb10d53d28d6216d4ba0cb2df108453b95bc3ca42f7b22fb884d84b4502e2a2c1bc4a986bb873704dda8b4b5392c1c5cb19c4e2545fed1574e0c9f979d8b03d96d560829eabf565c8f5d00a710623c5f9f542a0dae8c104459673aaa386e4d8ad8d5b56c90d71ad3d895a064baeab4eb71c201d5fa9199c75c85d5622efd19d6153723bb7bb5606755c51fb6181813367a9037784bdd78be43f068db968efa08d4b36564a3e9f58714bafb2ca1dac1c4f9ac0320907543bce746ffe909e2a061b9aacb8fcf18a55527294a011f52aea11243cf8260d1868faa2649587bd51de1ffb4ea1e3fc226000802c0adb1351a199b9e9cac72a01a2d736b9e8971fe70740c07bf38ee0f2b9a8bea44ea96a46fdc719f3818b2634bc1835a29c5d1e9d082be9b478c8c37894a9be0ba9883fdc93a0cbf4264817c156fd27b431747ef41b9f6d5a2920e466265be8fd5697551b3580424f092719673d3653e215b38caa15c22d497ede420e7efc6e3e547d695542af8ae2100f0fde605cc1faa5316343d9bbbe39227726763a7bda4e77f2ff28ab44de080d185956bf6f5754eaa078510ff8c15b836d65f5405a88b27062d5730a404ba2c55fea0aa4c6bb52c1d1645dd675b3fba07f9a018bb8dcc590717dd6ee9f04ca8a023d4878e5542ccd44cc7b033a00fb4489ba103669064a96e101a64f3a76f88a94ac59d82b9602da057a092b620a886e71cc15738b8a3320c48b85ac634b14b4cdc0bb2ad1c0fddbd3734ea3545031cdc3a13ed78bf2a915523e9eea950826613a11253ee7abe87ea6eb20496193eea75088473d7a8f6756c5bb99229b82f68bdcc303200c5345f7a269afe3c6c3d6e3cf213c1cc8277ab762c416aa15020edb452cec56baffa2f44c43f2231b1be5ac1ac0735f1112a62e378aa1c0622901c26f98c9dd145422976547d7ea8d28ec6e7b23df1a3c52964ea4a9b7b8b5fdde939ad55632a67482609aa4564577b34c010e165b8af5a36d4fa2a29bafda8ac41cbf2a9d199bd1cd996b07b8f19faaae46cb713de0e623280df06dd2a280f4ad97391811cc531f678f9e1c60ffe4c8c232702962e170231fabe5bd5c9f3fb5f1d6ec54ad36cba7f45660a6b173ccbfe9a70c4b9737ba3e770aa3993d52aaac363ca0d6373d61c697b7e2eb82402fa5eb6ed30108db8a3b722c4253bc81281c487120bb4fd2a9133e841919c2c09edf96ea03871c3d913fac0952a04b78f8c63c842702b20b545c29ed5b3788cbdf884f4ad8077c34ea04b152747fac2e93f56551147fd9ace7065dd2ad61452d1b75efc3e9e1ec531c75a48c104f6b3a43922d698db120289d855dd381e94be92510dc8ef5d9890ad04ad18eed2a891ff41c4c69ab05af0dc3cbf7495d7f7d82802d96b0c394bf190e19260f7372567a02be2b8efa79fc76863b7ac1aad777303e1c1f41d122ced00caa3bd306b4105c9781627cc0559606772c6c05bda596b384acc3ac695e44ad0fc5b689ddfb1997a12f62b9415e6761098dbef5c02f09b367b11cf2f7fd8bfdf0087f34f906e1861c9eebdb25a951655eaa3b8a2a22637450e7b648c4f1067e44bed5a893be652ece39f7458941375eb627ea51e9ae7240a587d57433d07fdfbaad92a05e0845183116cea96790dbc59cc63d2f0cf74ee8a4ce645b5233f82d1dfe064a6eec9257d19dac54f75679f5cee0338472c2673de160e7bd8e23500b3054c6ceca3539cd6505082016c3626ffd94f04c5bd39d0b7a04609e019904a9354787b5df8371a504620419f42ee63bf713886f914d7af7199562668c042753f149dc1091dc92240e48e1ead358b5f16f063b856093e1d838e0918c36809463ef6a3d4b5292621196f4a041d5beb7ce093638e1119e99856da2bdd2346d0ad4738736c6718247f5da8feeef9d5b8b0b98d7b7a6e292d307a4745a0844839b4ed55f79d948d3d834f8e7f0cbf11e72772c25bfddb48a6b0919fb9d46a6aadd66fcac3173589c0fe7cf477a853bfcafbf618f52c4d6ae955fc8a58e764b17f32c441b53b598379d89653dae6d1bd322a2fc718b1b54bd36ef4daf98b29d8760d51367bbec1674bc519688d6ab774eb1d196b98204f0e522af56b1b4cb2dc45d16b9481df11c50ae7f5910f119c8330983010ceb4302626666946ff60df03acec5fba61ff5c9c1f9c12058e4592c9d80cdb648bca2978d1991a80a94c4c2fb129210f6a896b07b6af30cff6daac8313d2e48174f5724a4a1a91126b7f3b11935d41b1fe384ce711f4beb8fef7d3c381ccf36df970fb08e7ea6a6e5091afe467a2be9a6cb63f45aaaf495be8d3036d35537056b95a241cdf7311d37ee62fb3a20e1c7038ef0697d1ce68479b20533c6644b985b41ff1282ae8ce51bf006f9ec613c04c12c735cd9c132cc056e524c19e0d954f6be30b6686183c115e2793074f8974665ae5a82f98d8cf81468be01c69d2d9be72b237ae2855d831897ba35f335e27e1e6cc7038272e0b1bd7bd50159f865f756810f700db578cb653667cce32a58334425c505456731eddf5fc68794264f35462bd91f79a86c024f3cf4c412ec6a9ce0120a770bd82614ff3b60fcf5949d0534177b280f74e2ced997ea7975f5f5ad5e789d760c8235f3111b702df5c3d7c5fcddc0b4707d7acaa12199c690714f851a196ddf826d2e5401b653091920facadeeaebe702c2c77444ba65894110d1916d4a7e72a292b36676946662589bc8c3b442766d29e9a1ae49841370c06aee5ad5c80f20d6be8b171b8f3772b8177d157ed8a7334b0217762bca171f5a72b7aa042ed76e6626c92fb31cfc60ea1a7cc1e49145cff2c7d7dc5be7579beef74413159069bc9d0c0693914db8de07f911147eb45c3292c2b699608fce464fbe695a68b6821bc39ed47089f011146e07c20c106ff6a8eb8855570727e17168f9f3392643ce8e773df733432d51e172f4f69ca541261382d930bdbbe848e085f4ef086457d6d6da42306e993bd9aada567f268ae28a26525503ddccbcf9f0f21d8b39bab45ff0a14160707cc60ece14a8f8a9f2cd21b0edfe1684faac3ee248d174d888086d12a6fabe5b3bfa6a76185ee5776acac0fb2f0c8a43ad67d944ceb95f3a3fdcff67780add1b66ba04857608b6690e1c002c7121b7c247dd912ecc57ee1e1c0eb61558ea89a487524389a3fcb9dbf263d5098705bd44d82d5f256cfc9106a3d2a8ace9ab71fd374a534948be03898fb33c936d2f32ee73e409e5b47cc18248dbbdce95f24014f1d71fc905daea4ddc2b6f2951f25502c401b413996571b22e8f1d184b8fded06bf4f7cd81ee88bed4d3b4e19bf05ab0588b3895e2ac60f476d75d5740144558af88c8a9685e4305385bca362db86f42f91a39287c9f41041e2bbf9239d9806632b1273b2bd4c22b12f395aa698f85b34d0fa43691a0eb2e57e2b8218301eef73cf91dc89baedee45f640d7ffd05b50264c8c6c3bb8d28cf3629f35f9c6058d77482079d80933449fe685945ef3f78db7b49fea840b0b036f1f3a212919f171fcd78c77c1df2a7aedd19b8699925cad16d8de7bf369044160a4b846c83cec6cf7d3764ef7aa9a2ede127bd5debb07f78ce07010bbb4d745b679bc4c972153f0e618bffecf9d07681ca7597ccb757c892a48c77a191697f86a2dcff04c632874eadc45a5856cbe0e4448bfa1c15877673ebd813002dff1e77fa3c5cb0d52949fa58cc65264e2eeb94baece49fd7bd71b94e0960f7ed6a113604a56c13d824b2e0437002bb5199566c6b8fb40b1d2b8a7bf8fbb8e0c1dacd2d368e2e74eb8da06a86a31e63a19567b541c686cf0b1a677123364bb076b3a8e61bf289ac778c271c905593eafe763cb63b8ffe45b5e986c200e8af82979c4d3f870a8bfdced7fd25746853d6d0d26baa14a908f5f61f752d5547eeccc432c0761bc6126c003abd2baae464b6bb5a179c16343ad234889ee2c2f3514c1403fb68b68c093d218a011585f86e956a92f095babea66b3930ca5acdafdb3b72877443341b90823df5bc22c875ab87ea0ab697063c15d92314a3983a906349fc89eaa86c70957f42a82c038c8443810925470a8c9dc81ae66103a26fad03563100d76e20692f0c5fb942e44b434d1c33456b19db7011ae0c02f10372f55facb4a4dceba1c04c256455ce0becc83b612399ce993b21898ab409b690372cf2b733dc0f8e8b076b4ff3e3785053f38b33548c086959385528fb27753f01d51989d0da95ea9dc398fc1a87294a8a36779858d3c018a93cb2a1a5ac89f0d7c6f18f646736c327f6dba93d65e18c2a4e0b42038af9b11ef926337f8948eb629ba47a438e6374275d81da2d0587f9ed8fdbbf2ad04fbfc40d0ec604123c1a59a4d084740d72a1b30ee289be528ddade52bf3c00aa8bf7113dde40300a3b5465a2c03e014b04a86f8fff20d3b18c5e38643e4f2eae4e9851c031d0fd6572d8fac2c88faa3d63685913e616df35349cbc3fa5ebe97567469a7fad11238cc01e2743807fb2356603cc636624cb9dae83d9fc4d452faf433d7dad7fcfd32b28712bbcdb5dabd0474fde4cba5a7a084b9dc7b0e183d595da02e46385e36211733c9659c492d66bcf834ee48675cd4029da405384c8a07ce62ddc6ba2e48f716abaaeae0de8e39ac4528e26ed2da7891958167cac9f6d0f6587b14e378afd6b00ae09aad23814d3c914cefd202991f4a24b2f34fb8122eaa40d9b6377d849c97dc43043a07f8eccfb958ccb1a5d604684a63e6580a130d12d7885b9236b5ccd4925afdfbccac5e3c495bd98ea85b915fb0b70af10794624b03653979d9f3ba74d2f4e494ac1460f29ba4bb8f04414b3ed12eb81240ed32b4a9754e40d97e88646296778904829516e0ddee0710541935328d134ff658b5354fcfe016e8bf97cc630cd48baba4814b1af33b6afc5e862c5af43690b312479719769f381908a44b0b6278b38bbbadbd2a480f3fe2ac06449b9f899713031a1be1c3640335ad7b5a95cc23f2106300239da7beb26a1428e582b1b4dd05e9b2937d3e9db7fd394d4be6333024b6307c70ec3ac42f0d05d9515fdf0cec4a7283b2cc7c54978340579304fb498466cad3b4e2532d15d228746b53d6351c704601d05c2ed103cc29aeec7b3d635c12c4317c2a1e936ef0aea5c68cabb5a361f32edcc50011c51c33b530e4a90e38b578c9014499edd982b2d3075e69e53b30227e09a069eccca993e4d2e841363269ba784b62be2a33d169b9a8f1156c4c978eec73b75bfa15d78d29d885512d2d0c5c4a5e12269dc8d19660bdcc3788e2a2c51d261b3ebccf3c23bbeb6f11af747d45f2fc11082d0d2be2c8512e7a750736555049316512bd8c512b452c82cadda5b4e6ed3a24eba4765d12e6b0f0825e4ef07c73b3038edd1598d979ce1afe742bc1debff569c9931219a90ab7601416f3fbc9eacd06da56417a6efc63b78236161e476ff544a86bfc6eed953c303f0d87ddf77f536a79c922feef7108a3f4f12551672410dc2f63105c3666ec980e64cd5f5daa877665470b8c5490f9d61998f72d880b38566a9e3b12dcdd41340a81fd9eec083f25046772c943f333cc3877d6cc429678710ca3e8ad817817d9d16e023919d2f3906cd0e19899a56da80e98ea3ce32bfbfb820d22a4fd8b15e6eb0d88edebef8dfb7e690a1cb71b7ebc045a12924791da19a837e9092dc14b30013b8a48670773d65c83a2f46dfae0c13c83a1ea3183a62ccfe5b0291a022af03a6aa828a486edc0f2acd805801b2d929fb774fd2a108229013911d6d50074931a3b59573a7517debbf0e13918da2da81bf1dae70dae7ece30bec9dc4b60b00314a36c60fd3f96ba40242e6951f876060f8b7581ca30daaa27fd8b18782de8c11ba2c3b0172dfe4091558429bf62f5b8a4bafd3de70ccd11432d1dd75eb570e65eaf9f8fa5c73bc1494ef8b14b3c97292900478a88032e97c832c22652f7f10bc37557a056db94cacbff8fa803fc43ff4e6f7f7fb2cfb5673ca5ca45b36667c0f3840dfbd989c9b7c09da7c05e6fd72a82b161a972f3b6659de45d27ab3cad13666a8dac3d0fee5df7b36df0f8a636ec513bc5052302de50aa2fd23f59007950c9b80755eccafa50ad8eabea7e73081cf6391de0e01e680db96d5c984e57832bf7f90b86dcfd1fa80b8060ff4ff3d268ad74173fb3af19f083f436d093a6a2a96f9ebe4ea836d101871fff35eab5c9da84b74b1de1d003ad21b6aa875bcefcfe5280dc7eebadf5c8b22ca20c69b7e7a0b76bb707b6cc1560cabbbe4c0353893ed768fe1a9e4725dc7b8f94bb4d9ff6600f8b9a6be5b05ba6e72aaaa9eecb0bbdec600e24ccdd147b37e48e4b32eef708f7a906014eb938c8b51815a14d5183ef1c77d93b58e094b28229d0e07c7902f770ec00901f8349bb1fe7a11aa99c48d1c2e00b9c8d5794a8861e938ad1aad714346b9bcf0cf47d0a12441768f020cd799f9204bc247e5d3a981aaf39a0794014b4940ee779931a188704c519c24f064ea1c0c2c57949abf3caeb44d9e034c696dbf4e7bc52814d8b56ad3ba0f8bffa14efc9b5aa697a4167794b795e31d08dac56e5c500dda1d9bc42a1c732a439f29a339371e80a78be7e9b705dc0b31f75c29b60a17cc333b1fd924c5dffc92d196a65091e02f661455500a52ee3d23247422d546c3ddce5478139d5408834bac39e88a3761edf5ccb2e4eda4ed6aafb750216e572a4292f27c40551db2c28459db5ef9dc851714263a66f729b0b9df8698b49ae19e27f1f6b88c5cd3c5cc8cf9882d2e461b5eb44e0541f13f94c809850299d4578f8e92f8adeb9da51f8dff81f9c0fb3dbd19873f57f23d3d42f698b5b72b793c30d2fe49d7dc7c75f5559e8323d24a5b7694249c7671488ebe11711b302405122e67f5e586a133b93b2675e8fda31c6da889fe779465591feeb07c1ffff1dc1f26d45d15445884fa1a9d780f7898b1db53801914553e0537d5af08c1d02f85f1710ec181feadd35645be3e2f439449dc7a03ef961a3fef05a1b978d7c2ad2bb5f391ea685a65ffad09bdf6d86674e3a02c13dec49e74877d35852005e7ca08d70aea007e255b74b891786b2fa72c188475ab543e46b530c8ad1da600d1a6baa996b95a1b341367ba19fc6ac7a51e177a12e8d8c1a1ea0100471d440ec1ed878386b5120661fbbee8f6ed8f8dfd29398f084d5b3dd14f13f4d15f42b08554be731a048227b95ed587de48d5c0bcf62efb6c7438e71bc55c1ce173fb1013e633d37a0e25bf696efa9c25d0f71f821f48932390eacf59a39040bab763bf462908a51e44b2e87dc1bde86164915a71d17e2e8e353fc7ba392a415522bca33555b5144d9fcd44b453dd2a71f59e4fbbd2a94701b28c0da88d57eab13d749cf0142c9526ccea1309315fd8c51b95fcd5375d40da32db36f718df90c10509c46f40e75736a660df7faaebbfd54a5c4665bcdc2658c5dd9db586943c173c4b0e0c092d897476c7394b041d6fed61482a6adba3ae15b1d3c9b16345709d1e39f0125823cba20e51fd8cdebc213abc011891a91ff48a21400f44653b742c982be8fa69c3fda117e4e69474ad206257fd1d4372182808903e9d5176c0bab8a417e9a33cf5e855925d7572f7785bf26d40ac5724d6c44d5431b5d27c40aee1460f3f8adad2d10016d02bdb1bc4041395a9eb57191e09cfe6b8b5319b90bffac5d9e618b4b3dca0dab980a5860cdc694b099ea4854e0100f02061982c3db9b3bbf10099e8778db756d8f5557b42225c1c39f662f0089b5a0a4f08f45c7a13c7068bcaebde5fb4601f7b4ac325fdc5ef89d931cd8e4ee858af753e16c8b58182fe827f5a63028e0bb3d09f71c99ac50341b0db4c314402f50a051b4ae4c5bbf15266888470f06b9d278d27492621bf7e37364d18a17250aab8fc2788db88ed981e8c6d996a391a795ade29fb6e22b09064047eab55ac5809bfec74ad044712e09587165efdfbaf4e2b31f6840469951e4c198707bb136754babc03879af65c62babe7cda88ff6c787102f04d4ac625be665bc5379ecdb301cd1b20eaa9de01423bac2237e97673ebe872de2f5a872b855d2f76fa28cc79f53ea25dbd45f6051d9ea9d2bcc9bdadbfc1d1dc86f6b9e3a06f89e66f70eb2e62045f7680899db0500e0db642d569a5f87b1b451511344da1f02cd27e469d82502f423dbee15266e2603f4630c7c550efd8ba63bb0ca63ad112a6c7e31e322940d18e1cc91b7501630fd88a44c22e85b2aac344d6d16b3766dd85b1b6eebab44e8661a9ed48847815ae4f157beba8c95c995714e8f39a0213f573228ca0e5028dfd88568ccf2eb22f377a96627ed2dbcc264f9e228be4ad8d4da16949217e7bd0e2de3ad8eeedbf44f1ec991101302b82f8ce291141256f2f0fa9f901f88d6b0527452c8e7e6c60ac09cadc5d2729b91c4fd080bc8cbd72808258880881c14ac54d74b55b4ce269e3c6d5d2822c01e1f349823443a1a7a35d59cfa80d14d4d69fae992988749561c9c5ec350d8b5879d103a933888c64a51a0b91e0cc5fe49726b4bf965c3268e026c1760123e3793d5dd26a7e2901697f85519f56e2a01a829a393e467a4dc91c7a4f5ec3e4113112ec494f04f166ef8dcc92f68994bfa42162b48bb1f2a0bbafd0bc41dbe9f4898bdf23f46f1675a321ad76e40690cb7062b5463c1e38f7773a3a8c99b928b5099371f496efd208f2a4aea0d61a4078314cba949a0c796eaeb6c197d41435be8324a9117344023791051c0ce669132f479576ff9b243166958a3366def9b3e52ed0cdb807e96427685ffcc6d7c3590ae7177bbfdbf3f739d761600b7fe14913226e296a50b77808adfd49ba41b9006b5999e39e4d273f6d5ffa5e19fc5faaff28408222ab9de07aa64369dc64ff170d966159bfe4d52a61c174c2c57c5a31c9fbb6518df270fda25b1358b9ddfb1772e1820631a507398d650e72c55b1653158a2e82696eed0187c2638527bfd0d3ac940d8f1fcc83a0f6fc0822ad043266580975583e9c9e8ed694cb7ca532019d868ffb5afe97ed6911f982e9d48b1f3a2c0dc5505752f29616be08eabdd42effeeb991d8e52b428de8e8cf1f007f4e1a2d2c241e3f94cbc1478c0cd4334791ffd6ae3be77c788e1e956afec12af97e4e7605daa3502bfef9f4fb2f861705693c23e71ee69ed6b6af15636ea75dcefe0f2bcda998cdf8872751ce3cb8bf2cb26021ce715c11bd702fffec9f128d9a03d276dbe69f05beb69494c364220cd76ad6a611b3a9bf8cb6c9f6d95404096177ff0b479d4c6d5735c85324ae1324ed0f2267ba4420185729fb8dadbb8e5f2b1f49186ab4b583ce34beb189d4e5abf90a76a5422e13b406c8dd33bd75eeea09f2f731af387eeb9b9a2f807ced5da448bcfaeadaddeeb8c9effee38eb399b584fa0fec1f13f9feaf20d7092f446e0a86682d8dc6f8ba01fbe77d66b6163ec741653bfc06acb208f1d7654bae1fb4c2fffda882ee2fbd5a58cbdccab901de91e44cc3900534b33ab85186b3b24b8571251cfab38b2dc7b34b99a42cf410eef3570d71cd4be8ecbb55eccb17a20cbbd8174e5be641f07dae901fa6267de9da928b7e80a3fa7a42b16241a4c0a2afa9fa23d9e1833da21d5581732ad8fae03b5ad91fbb057a8793aeda0dc68c2e36a4bf941966569ec5b54b53234d7abbf26038be75d3bb64a5616648a25d62689412ddfa14e7a4e287b90dddd008a67e750839ed9c9b9c3e8fba80bd6796b64f9b214ace846da14642f243f0f7cd053bb329a1ecc7cb78fe7bc4b83f554de518bb3fee172274cbc9a7065d043139ccb64241f68fd178020fea659a152211d9d787a6e960e44cd9288c58829e0c517cf1a00ce90f406694af99026652c6fd2de20d8fa7e14ed1c9329c1e0839f1d2d9c7c3deecf4a034f1471f5fb3e8ac9c0213ed3aebfc4ff126427aac6c56d8cf26c6b05a1be91b0f09ddc5cbd1f1328fc16abac97ca93e8193543efe5bcec4dc105adc78ba2e5f6ad86f0d75dca01e408000dcaaae574b70cdd4f031e451768ad9b25206efa3d850945d5a579303dad806a4a8ffd9a42f0f88c99b34bfc69fde6786ab343598e245145bbeeab5ec99964a06245340ac7a4d721e0057e283590e795b29a3c718c966c925226a39141411a2f0f6192127bcf81598b4604b2bd47346b54ff6efe1711bce46ba146e743f3a62e005526e4e9b74f2bdcde029b2f34f502c66970f66bd4e05aa1f5a239d971b1415d6dd32994cf445223d56000768b3a3f3164bd2cfdac50bf75c2fcaf381e7ecb6f449019d208f0707641935ef2ae440b79fd63987a87f1ff119d8dec6f683dcdb7ce42413fe9e6174c659f16a37098f2d575cad1db588254799eb8193f71d301aae53f19772c2fd7831451aacae7234883114d257d433cb73e5cd27b801bceaca364e297fb7392e35b34c75fafb0280dbb6004c2b9a875af12fb402fbe4b1aea2d5975e2104ef10864130258fb1b431c1f7564586280bb2214662b6522fc61ed669644ccf399bf48830b36f3c1349c48bf09d793692ab208993deaaab341915c418466a86507a1732407d5c14ee9f2b7d4a627dadbb4177b264c58fe5fa8e5e7e4cf48f1acd1e7f3f40c5f9b20a73d05ed59cd1af92fc6c2b51246d22b3d48fea0e1e9ab972031caea9ad2e6e9e7e7176a0ff62861278bc6cf9c20e1576fc119039a3f383836fe81083e87466533bfbb4660d5159a456393204eed7365804985eb30e3be6a48b71558149a09a63973667f2acaf2e6bdbc44a3949155d4512b9067fa201fc70362d955ed620b0f2aeb54668610c882d74cc7c60719733c814d95c622f77c5f4caafe701a9d6016cba87b5385dee8a6735d80c660585cad08018c85d73674eb922cdb2017f1676526895d9ff559a2f869ac0e9d01fc760642a45070bb51ab8de4f90837e08eac0c29e000471da6abd7f16dbf4c96427fb97232438aaddf993c3cde215a3c4a937fc9544c69dc994d0782ff0a5f8d342d8fbce7ff1c2b3c1cb4e43c8b67f4e680b35bc16d919c505bfdf604e03c67e9ebd781c87f7b3df1aac11b45ad409b6a83db2ca99f684404bdb3499a77014e3bde3e64ec954c0fb71be642c426d99c132c8e200133ddcb33a58a45cea6826a3ca927e60f89a3345afa4a3612d67d24f2cf6eef086a907e65d5120081952e7a36c0d56ea36473dff61948cfc1146eb6f0e6de5e0399c835421ae8e1ff75ecc605150e15124fc3b8a083b3b56863a0442c7ffff04a403d2f9fe8f9b020b2c6237012b193584495f72bf04f85dc064286c7869b03df512c0c64677f00d4553742477486961d49360158e61b8ca39d875f249f91a93dd5c16dc0b23c91e83458d7b00e311425171d6df39895305f7b756331fed2e29ddf075eafc3e114638e542a1e2b16fe929ea6cbd88ca8f724767812ebbdfee0c70cee5b47251be3f21c67a6a602fd33b9cfea514296141b81abe38196502c60adff70b14cedc625eefaff7cb8e5e1491c8f3585bbe46de6683a836e03659c8b5a900b01ae5de10820a36d40f11fafea25e65b35776746a908f93b32cd030ad1ad814fb6b6077d6a05fe69169d7274a2d4f6bfd7c0930d34b2f7f18ed7f93c16b3904fcec090d7a607bb0e29821460c73495c6c7e3532b147990753d795cbb4eb662847aa0081710c442fa2e40a927f9654346d6e733113145a694a5cb223db7a2e660fd94bd2731bb1722ef21666522453c45ef451945b4e3c8008bd4427a2e479874cf240751463af20e819499d67270b63455f71f42bb5b87d0d7dd0cb2654b46c023c45a155af543f30a062beb44be8430454ddb4c3f6d56226dc6148ea3f80ea4f94f601ed99014a36d9ff1c7327f5fb24448a75282704ad934dd61ea7959378cb943988ecd5ac84e5e657e15a82566608ac9b744c00ebd8c695384274069a49cfcc93ed267d50c132551e0f47a0de0b334aa14bb00a0b51d143200cb3dbf0930dc7ec5228ad1bc9d0e4315a9eefff76a6cde15347aa8bff7634b5066e8f038d12d1b7fbb6bf558baa83d2e3e6f9812afc0d45284ff46c9b090e5cd6cb70ce831931b6e71c5f8b4f3833e4cd7fada4d448c82eb9a1369afa84e430f5686deb27036b22201b8b70f063ef5f9da4310cc1d36cca52ee7dc3b0c16939e44f8f4a233c79bbe85c3e4ac2303ad910f5262e268f8a90e8cb1709fb8ac74dc08a4fcff6f7a729115f78868c8441e06fa7cf70d403604e14df8297e4384c158ca9af9fe2a664b7960742cb984be88e58c890813565498a478da53c1ed9689db2cf8c2efd44ff3af0e066302a797c1262bf3b81d848efb3a76f1aeb70ada83daf28993c27565c57e135c859be95106610c7fd103d24afb3a16e610e61faf3780d5a497b5d94d02cefddfe6cbe5fcb24f3d5427294aaff26f64ea6ca9288cb5c913f9869bc9e368c1b97dd2874421addaa013cfe0b418250c2a799472a21c17ddb25a2c3b6d8c7bb75081216c6a09d1c946d6928abe481c87b0cd39a23bd8339c46aa582dfbf0b1170fca5853d85f58303414752348f83217ea93a49e0ba37760fd93aebea7ecf47c983edcc034db579efa58314a9f4d95721ab8deb82bfddd822f3f0a7420ffe073cb1c64aa63c939dfb7d604d479f2197870c851735f78153b94d4556a88852b6420c918042f987082e9ff1bac9ebc8081ca7bcd1f661101a379e1dae35637e969a3554a69f98e56852b7243b76b696a0d11990b7c9604a22dbd48a948b1fa1a53f8483c8de25e7047793d665f9038a6a3138939eb3c078f332078cd361693d31160a2aae73e9f7f9305aedc9d3f8aa160c7c45290db75999996214adb0afe75c7102f1df6af507db6233cd5f8b9c2df98cf0698586912a4b1a884a8d099dba77b1d0e10077eafd660f481261bdc51d00516fe5ea60e3ba4d959f6e3f829cf7543a375026bd3a0542ab07787e44abd7ec39858f6816ebc66eb3fb7c20351e51e6cc6512d5691d51c090b4eae411aa729f894fd57b6d9ee6158e9018bb36d85b086db0ef406f610a0851a7ffdc4335b18b5e42e71f278ed73ecb3563e20245582f08679289f355a5a5ee95ed342dfb49dbc341b98065a6dd2ef8a6ad357f871e770506814ceca8a449897cbe3b26028613829479e92b5860996bc51b65c1cab06027f6855edc4fb2eba477cca4245b02ca597d7ce1efb4b5c9727de4ce7fab7085e07bd7a88d84fe93d2da58b891c25a82b0fbebd4674d7f3cae49d536455100db15b7a5b46494f3cbf0c49afeaf359c0e6f39cb3f4321f9e86f9f7661a0ad1532f0be22c7f13485a6fbd4f48dec1f13ed689ee84bac55485a10bd3a6713da0cd01494a4b2fc463777d7a4a7c12ab52ff11a2453525f062988b84121408356e06eb23a48377df48a113a882d6e1702ea2311f7853913b9d1f37c2325a32a30a3cec90b96640dd10b0b5ace6ea56d3447af5e1d3e747c4ac92256e854b528ab8a6db6a5fd70292a870cabe0bb0dda1b4f3b8e068dfc3ff65ca0ea1de02a2a7ec091ab841e01765ab568af696216057af3037d2479683051e21495df472114b696349d0575b36ad0a0465a1696b9892441015a0e93896c2e1ba62a0e61212af5f19576b2f90c41afdb8802e9b27b9727bd2f0678571926cbf8aa0bd194f5df77ae29ee76fcfa6196b8a0b5e28f04fb66e0af749e5af8c7c10cd05ce3c45259a9d04f0a0c60868979b88c6aae94a1ccb89e7e1a5322aa33635527554dac240d8ed4e1af931a7dd666e0acf3be768ea039700f55f8169b0e4c5c977c20558b422fd1ace02435268cbcd0ad667e8b171c56b330a59ceda6f720919217103466f2157063a844d815b11e891458f19240de0572e97d3e1d94e681c46158458e562079eb5ee23e9b14dbacb121d17693c39140d6fa0787624dbdd9222c7adaed07a51219320181a9cdb4626350e209b2df3360843ba0ee5bf47ca041cbdc6f0c48f15898c74d5b93b76ed8dd1af7e2f576e1dc4d361c8fda9fdbc9a7cc77814f7952badacf81764f419d80f19f3e549fb40b2182efdf9623ac57edc13bb58f8ff7c6209e2bb0c61f52e9f052246c28c0cc18845746654eaf1716adbc3d0c0c4e539d83804195e3fc048a6146d58c4ec36ba379803ea287168ded4f15cc7766fed6b22c6cc8ceec77148dcadbe63da885e2a83c4840cd94cc548f82eadcb8c41a355a075b8ef17a451d253440d289d9f352c64f582365b8b15b212b641d93d17c343ca12f6c684553e9b5e","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"a91dcfefaaa708caafe614013941e004"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
