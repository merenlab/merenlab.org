<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Solution for EXC-001</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #217573;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #FFFFFF;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Solution for EXC-001</p>
                        <p>You shall not pass! Well, unless you have the password. Then you pass .. or <a href="/courses/PFLS/#exc-001">go back to where you came from</a>.</p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="SHOW ME" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"dd8dc7709abe40f57f453328beb7540f499b7fcb38013adfa81c11e9c128fdbffeca756b4a2035dfd2743aa4154c50c01d055b356e2f27b00e480072421b9836664dde141694bd9970652600ef62be30cb147684bfb5aed89cffdfe84d0d01c604005278a2c91fa2b259d6dc59766b89d7bea185b2d65a73e53630b9d25442323e4b10c58839cb2d8a4c1364ca1714d99c603092be205b445185991a108e4ed858ab7cf60f7cd8489ec2fa841e1cbc50503ffc7d291ca478245d5f1b1c5027a0821ea4290ee7f0b69c2a39cb160429a71402260d9c4c9d13ce724e8fc6ff9821d7d81c9441b81cc394622810d4797a999e6faeff8c9e7a9ec6867124afc8935befe23371adc4c59c3d12b7469160d5d5944bb10bf486b95aa8e0d56efc199eb4fd198c5622845215ff1cf061954044599e854376febefa61f44032d4767d60d7924e687a5feca90390390ab5e3c4766832f9ebbab6e0d05faaabf20377733b023363d0415e4096280bb813f243ed0ecf04b4e2a1cab1180ea4e80f3bd6cb350b3f9dd9907ac2a9d6201b23f03e615e8b3ce95b8772c77c86f8ff9e821fe27fbf76929031ef5e3c2a6cb8d1da77b37d75219c4fd300ced73c6ab7ebfe7771555f0c30ab6418544de33b862d1e4038f3e47740ec2b32b1ce80270148677a91089dbe39a3734817ce9afc5e27db1766a003450f7927b52d36765077923c602b399acc11d51019905127c2e57410fc907b20f737c7ec87118c5537a5fc11688769e64171fc1667d9725bde1935bf671d46eb686cdc1c87b1852c27c54e9f460d014e7a720b03464fe7bbb923a14f086a7776b75217339e2e81b4821b2a506c62a8980e7e802babe1aadacf11a4e7074be8347c6c908aa59f5aad8019bb7f0bb26f717b76ebc37de440200cea65d9bde7d466c251216e2399a1a243d52fff451f9f4ba10756f233dc9d53da0b6d0d3f6e8b3fedca025f15bb6000664d158ebe6d61844fa1822d000c420b6da69fbc2ba4ea17fed6c14822db1b6041ba1eac266595cba0f07527ecbdebd8147f7a9f4cc1cd23eaa7dcbed209756cacca17f08feb78e18641bb8644e53decd1c03bd45f89343a51442c72d0aa6ee77e439b78add04fa54d0e22fa9299710b020525d57bf38628917379cc5b220a519e9dd62ef763a4d34c79ebbc6ea99108219ede734ff175caf3b670dd639f579194aef8183d6d348920f8a973953ce39964106f8ba551c81d0ae862299fac0fe0819bbd56d4b53f9bf119c1866b86b41a3c470466b9ddcbc97062714ddeb9c1f41abdd90bbd6bc9d8871d6b2d959a64618e4865db2bd0e87e992180a3fa9f8d0603be4c0ea99dcc4898e5d2a07979ce41b6f8eac77213064ee5abf67b755fd0d66f1605386047b6382bfc8a145e058f9526ed5c658140fbd1f4d24f7d52edbd4c6ea8d05bc39e9841ff262cdd6ae5ff11e13d20fb870d784109a665ab7b843b67126c50c0cb798cd553cb606fda706f65b76e848d72dee8bcf4c18c90d922638e67cc892de474ebcd05c0e1507570371f54263e67856d08ebc0e8de4d1136f0b0c0119ae9dadc351f43ec19b604d63ba2788198946578373e8bac8273d7ad4cb61fd54e6637adbdd7c022007f486b9eba130f980c4c44c6c6761acbfef13a7f11b72dd22fce2e42ae63d634583b2425bce3f75fd88e798c8fb44bba12b55c3642df12c636fe0873d7375e0673d0fe84d0fe3a1091f698613eb3e12172f5875034e0a04129e0543a8bfd5a5916ecab493c9580f168195228390aaa2c7b2ba82bb254edbf1ccc0f56dd10efcc54e53eebe87cb1fc6d80f29d09958137b604d7d088296f0ee7ca68b66e457acdfaa0758016051298d12a17b9a5864957d0c109c818dcf99d8753e730f633f0bb6c997f84d84fcf43015a6db9ce0a66893fb1a02caa4652aaa5e9b27c255150b05b3e8372d21d1b6abd38491a7894eee4f198a38eb84638ca644d515cf910e354ed1a2b3ad5d9dfafdee6c85c6a4cc2f771ed50ef3604efcdb68ce7b2ddf2eda1b534c8c7d1d83cf39ee5c23bf88f316bb121534089ab884d1cf9e2821f9b7b2ef7cc261e8b78b09d70388da641926fade4bccc61cebd2db97743ec00a57d83821cf62e4bda1c700260df6b8b4e745ed2491c8e73b326460c761e1fb18798ba910ed7f5540ec3645f20804e4f91bed623d6231d132a0b986bec430e619d4000204f044726fa82d0906f982ea615ebcdad0852e52c35b1d4fd424affb40b38a74ed93e2f517d41ae3a9df83f193770d8ef01ed13ea0c42a354b3b972d24ccdfb111902c7868633b3164755f19f46082eb931ffc3b4f92aa27ecae530b72317f9b3b869186ba53ac240e4541d43c7cde552582e1006085177a3b2a3e9fc882245c9278af45ce63ffc1df324430239b48e0ef159522e7f7a4520272bf2227c2160af0e6b08b373e28203304969a5f73f0e853bdd61e86f55afd515135961e68e2df329f953dca56fe62e6db23093be45ed38ba7e60e909a544d9554769f2d94e7b4cb293fea87a5cb6dc247bd92a9babbec0c78c4492f0ad319c04d7586de4eb8d32e53a62261a523bff6878d79d9aa6781c20c59f3c82b4599e579db246701f7ef995c219b39f83308f6bbad89931e7b65874522fb3bd8842b1455537c40462e2160ebfb3eefbb186e603fd6a8c8ec9778f1390d512d8735750fd690b1ec7845b3762d54b82772837f4bfb3853ec0cc751c5597c6d37a09c811bbb252ca2ae7f64f336c7205a58cd9f7856167fac2f0e0d82125de58a5ae4d74d81e7b07756e41c0575bad7e11467eb010873f239bf363fa439cc39d4b3921cba4dde23c84f6903eabb900c4067b553456689af976b242365d7d6e735290503e19c4dd9859368d4c4e621a0e72315cf357b7b65b600e55aff097f7314190e50491c3f001a2561a2f84712701811f5aabbb064affa20db32768f011997531cb6ea40b3bae79f21075dac8de95ae7720708c2cde339836d2d53ae53915a46c201014503551bbf0552ede159ea486862066798519124d6b4bc0a9882f18e9e6c19e9d3fa19f668e5675db4ba1d3b2d87d43352b90e6c4b4fea2bd8bf710fe048d05c941a33374a0295954638aec47c409272f4b9bc17a6d50c5539fea2e05731e986f4370c9951db3a9f61c614246365be9d745ff29dc27d2401ab172941427f19af0c84841011bfafa3f7277b1bc8ea24d28e6eb677667a6f73b51f822346a3bd1efabb6dc147c5c8050483a1dbdfb30a0491b93e1aff6f3b37361bdadf3b6d858017c95868303b4a29e969042a142b0c2ab306c17153de4a8fdfc8fbbf6888a3adf9bf84ada8b3f6eeb01caffe2cf00f71fb1c3cb7e464ecf7496e7791150f100e4407422ce6e572bc27691da96161837e0a50cadc1e0dfc15b551715b4bd6626365e6c8819b092ddb36c9ed37ec251214241836b9b74aec9291c299a83a79883e0dd0be17ae0c777f0a6d5ddc906f27b8ab260ee114d232ac62579ab2d85bb1f2b423930f957c12e4e0681c9f12c790b686d1b67b2a29a44b3b18bc4f00716b2051c3cac207fd4c5ccd1c1f8b6ca871f2e68fdb4fa15af254e086abececcf4d51fa7d9b5873fe3f8bfb7e3198a5006cfdbc7179b8ac6e9fe1656568a0ce138959e1cb45b655db420d51ba39fb0ae588080ddd048e9389061f29a84d186b952c6557f3ef043ee2239f561b39b25dbc2741fd39bd73479833d55308134934ed6c0c26ba5f55e521d8d186c6675954121710f1329075c724022d67eb8c55d44a0b27c3e80625080c6a0446d754187f88e2f3a38c72d727cfa8343f5ccf447b30e0a6b8b573467e0573ec5e87e93c8ccf3c9d0d0ed08d364357d2e9a6ce3e7317368caebbf18bebc25832f2f33dae2b94fe92e10295be10bb7cb77c03db64be0cc59b7bee78876db18bbc37e5aa6958872b0288dbdbe0595c0fbfa13a42858d10ba5dee20b52c89b8166a2c3c4123c65214a0d61f7b6efe1ee259546f36e3d14f7d774bca3e2da13312383312ad7b283949139a07db1f1502831591c8a29786e4c9fae9c8a37f6a23b93a6228b7423dfff4f536df96096ec1bc2ba1524437d4ceaf272aa7b492ade0bc803df45edd4ea5bac9ca748c5b0799bdffcb1b03d0ca0bb84107c7cd9d5cd924fab8909ad76c534debaa977a625b14945ea31755753c2d89e11a8f5773f8cf8bbb3095a4422c831ea5ea1e41f6b4a75bf17b90690205e915150c2142694a0a5edbaa23b8acf76bd646c76eb6707df9898682278d400cb8443cb04830ebd0a8c9892a87801d505f96192581afda4c4e0996955d30ff7e058e1ea58d3b6db9b159636ffaa4c5826b72d158d704c5788c6184489d392a225d54a22374754844602a59534103a311ce70b03002390de9ba910d518a2391d98491d7e0284c685ccb9656ec08ef53ee4645d19e9ba7cf7da351abc68b1d74c748cbb3b5a67457481d7dbd96f9be98f2f94a9891155fd71a51da5d5ecc0575874ff87093582890f657b7b958cc7228d70347aa555dd75060dbc98649bce062f7487cb8ba95071ade3b6b9fa814d2b7f75035fd413d569c3012eea24976619ffa6c33e1f1c46f055f77cc377a917e9cd28eb6c46fc17efcdb76788f3d66a131c488b0c80430ec7283e32ae1aa14779a6d8e8ddca0facd05789e93b5e4546f2fb5c56d808f50444a691f6acf27e64547e17961357a51ca02c292e13ecb1b46544efa359febf730f7032b6bcc3a18f16040e6477695f30128f091d3cdd068e6aa3a7b5f410804992a2eaa0128999117924bc9b82395c1c8d24075efed616cd1ebe379a0fc57f72ec7cf19fe22012c79dccf7c8c8a60368bc022c9cbd1d70b5803fc43862530b516ce13328b127c07ff0758aaeafbee5e8e675b07a330907f7f6f0629b8567d75a138a2cf662dc698264cfaae47a0d3d42bc3bcaf562423d3041c3c5af06676294f69e0ff998dfb54cacbafd2aecd557915488300a40c3fd9af93c82bed0408a2dc682299e3f8e0a1b9b2f779d973baaa6bd1090f8532c44456875adffcc32d174ad0285caa95c98c5c8a3fed1b9c127dbd675fc0296a23207035f0edce0b7011875571ab9cd01f79e6af45fd26ef21395f211f4c705569877c0ac2605ebd8ef1ccd7acf7ea90be71a8a3201ffd8fc61f9621b62c2d9aec104c56a7619c031231e96f7e510545d6994f7499a92c8a21c76e25f33a12da93c7635d86ca29dc924c0976867c72188e4b4d75fe1ae519c2592f4a0da4a6eb17e027fc2a7505fe1b64ff5e6d6f57678858154e05a729c2c2d57198431b7533b68ea36d540b0287df0f6870aae432335f89fd1280db9af32897675bf1fcd1fb01bc40be0c2be66d8fbea6ca6b7ebbaaf39c1454da0f84bdac2dae5c3ec455ad06b38552023a2d46c272bfb0a36a91a1598d66776872c17cfdb6937be2eeeb0999289e67e16ec6c1af3cd1508bc050aadd59f831c7f4a6cab5c9a85f2dde21710b8c57fb769a7e071f8e33c7cb94605682397e7839f515127729541fc520ca9938ff29208f2c8b881e3486d474f6051ecf281ac731b4b19978c37f1f267e05d472f57465fff62ea0d9bae43a5dfd9deb2905ee4235699664601d3bec0d8646226d9e643be3fcfe704a65772e7083c9e68cb3683319800cedc25aee35ecbde7d8ebc06ac352eed09827dfeb12b0e1e996e208f8d67479c20d6ebab573cbabaddc04278ac42ca3d3d864327c5a83e58101a58ab5c7533eed49bff7d059172e52d8b2e8fa00d96b37119b6741be26eff64fff932350ff796c0109def5537cf8d62255b505922bafa18aeff511cab3e04a0c6a4a12555f6b2c37b223baac4b7f27b98bcf6d16be7019d702174956ad1b573dd9274514bf75813ac22a5a8c159fff5c626754676c06ecf630603f7dfe5ed579fb605c051520a2b257ac85a703f7fab13b82ebfd1655be9f45c3ac499ff193cb94e5a74399344c8620f6efbc77650e9d39e4b2dfa375495bae5f041f1a38dcde973c5649ca381e580e5602dc0404b8cec4b3859c77dad97407e0fa98c99384a0ead3d0a2cde8e54df6c9e4d0d758b527fd8db8f3a82596ec19c1132b3610148746fd14b0002410648f8ba207528ae1eb33a823eb14793df6f82c5e6641547321d2899d021630efa7add96d09d40036cee2d591ba104aec1a2615017a921f6e2315164853660c33600c88f6f4d204afd0c9eafc875dbb3991f28a4299f0683700e8d99d6277783dff22f07d2185a177aa062df5727998e45755ff68d261695cbef911c999778493caf2bbb75ff39e994c1fc43f12821769591062660a12b56c8b90d10e65beb2a42f775ac452eebf264fc7d84c6030120c482b6f34d1f4a75abe8518b807ad8bf3acdc1fd7145a05c408f9f86b8a1af24a6fcffb5712d18f4f4d44dc3cec10ece36ecdc870c94915be42e630efd5876064911748fea8d4ce30422ba11e7e243b0fe3e53fbeabae4556500dca5da064f13eadaea4ddb1cbd3ad16c0d645cadfe886d5c3f0a892b2d642d741061e082dd2ff059cee14fd302f1a77c04540963afbd8bbf909ab62f7c3b2c7616e603d2e2b8f86fc69ca3a43b9b66c079503f3ddca7f410656ac28fc355223713c4e8212e20867051e5fddb95e9bed683ae081717700e2a6b00dff01c32cffa2712c4fbaaa0ad6ddbc372b38f3fc110768b2dcba2360dc8a40224b6554f2fe7d342d8a11c7255597d002b2bcd0bc9762c18ba6ecc0da8321b29e2af81115412a62214b0db0e43848de5cb79ab0fafb58f7b550143494b848647755276d4613a407a41e603d4d7cdf9e98f42f4f11d7c14aaac04c9d0d0cfc71e2857cd66c55d7bda93ad7d9d99eef1df01a7b0ee1fac791c6bb62720ea7227826e162fd26444481162dfe8b41a6a2ea284b2977b49803b39fa6144955bea5035a056a6cb63cd8ba54cbb9f9edff7b1be896c9b747531f901b1621d961cbda76e626f53c3c92a8c25aa90c1091b9149dad1e2f55fb7d75d4876600f0ef0c65dce3b0073556db10da33b4113a7a67b2ce54a3e021e6079578086d0fc143e83c26f19ab8a89d207c0e619a160ba0188ef9a0b297919c4beff7c67b4501b71fcd77385e2edbde76174b8c260b482755d84a54f83f7737facc7b1934242762bed2b6d5d910ad6e5d629aa0410d9a1c9c45b7c655dda6db416bd5e4fb1ddcd8ab0b2300f5381a78137ce8fa89a09c78b5748f5cc1d707f37b51f36bd8da258aafe6a795026bc2ecadad5f20e25dc62f5b8f27f915697d26394a36c494f78304828d50981178656be39084b8a78834107241248eaf21f786dd4b162441d421ea870e07b9ab7e05aa72bedda8023fd059568b9543fd053a6989b96bb943bf8b7d5074d681bec28d46b7c62df29578a7337e35dbed567fa587bde27b7b834883ffba38e5788a05045c1ffce56c010b7b4f56290aa21145a537a96379258aa33e44b8bebbb14d32a55c0ba1aaec82b8654a8c16361600a7ebba63efb5f5931b0fd7ddfd9cbb023ff3fafd5f734561b8caf841ee7a6b2cf8a6f0ee4f0b28e100971bbc2419b40937b4812b7c40cc8488cee2287abc95950da25df0853f2210cbbe4d2c4fd565a7af4938a81a7656338b7b915dad52ff499324664e3ea0524c75376c2b09eb7afa9a9338143bbe811d7934cd3555b7799758fd87c8505ce97f6e2112108ee68df9c11b4de8a1dccc53b3ee254c1823d1fcd79e9a2068537e136ee459e12022f540d19e3cc54bc1fbc700230c14a398a6a71627edc1e0018464d989425a2b85180ee6ae69ea85e4cac30879295be69fa4c22cd7eb5a3a194caf6bf71c8fa426cd9ea6c5c60a72087db8a7bda3310926f24d24bb6326a2e97d3129cc880d57c7e1c6a01b52e79ba00c11f0b6cdcf8ce940a7412179489262cb088c0ec872caca70272a332cfca49bd6c143f6e38514a370af53950cae2093227739c7d6d7dede747199b975a9ef04e5e540ee6a30e5ed8ef5bd80d0c5e4de46b77b59653c5e02e64163aeb205e020869b65a94aa136faf497f381226292d8125ed9b88dab3ce93ed04d7945355fcbbf5e7639ceff5eb57e5464fb4f8917736192e00ea326facae6c626fa9b6501e195d9fba3053006342ca8de84c4bb28bc86473f0289506f8ed70887477c622e86461540108855203bfc59f21be6edbf97d37de789f3bb14dece5deeb49e86091c7819234e08974ed3ca4644379c167077e3dc20a22017627aefcb3107806e6ef060194f303476a4b5893fff100c4ee1b7c949c14c721529fd0ac18662b15c8867ac76314f601234f3ce6899a91a6460f41db195adecf9b397d67a6ddb7c0b18a0f932330c6706a9c26301f8a927f2ee70def78867229c0521c0eba74c73e67c09bd008b164cd2c782097e9167f56ca6089d1271687ec959127a84a88c5c3464d1b3f9d750024939b04e8bfad2119e913f367486caf1d5c1df1e49484db3682a851efe8ed581d92015f77c80a8c8ff63f2914049b32120f997b853c8712443a16d16162ede9ec51072090586e9f400e8a9805978e962b43824acf1195262bd6bc626f91c4d502ab7f9050a6faebf9164f2f87affaea0375cd6ebf7f61b0ae535b8fb6a4f1a7824b25c67d79045102f6d27bfc17a7e49af7c09b407c2d631070bbfac5a2dfbcc437b0181afc3404cbbb1a5c30bcf76a9145e30b428179327f92c87d922e4c68be4f80277f1a1f51e6fc61b2e3132b0a7e230a91554656dee8297f4ba9e81042138b829e43a7379d7a32e7d4b3276190f84be9c42357ee5ba0c4094cd7aa837b70f25ef9aa6c14f0f8dc82ccf494bec8beab6da40cc9837db04759b977fc5dddf212fab39c7c66a43eb791b9c0e7c87aec7a9ebacc88797513d93780f604a1f5c5f6c372a82659cfebaaa7b70b143dfbf602513b954d0f76a842f4fbe432aec2a64e0220b11eb4ce718be3ebb27cbb0eeb0b6050d89e4e828a2bc5f466945cfee7b08d0b8c82f69d26fa8b9431957ddbdebf1aecc9e3de48919bb2500ab9299586607ea64af63ddf732b9693565a1c329561bf7f30c0846aa7a97064e8b5c336f1968751e0b4e94feb593d4b12590ba7f8ea71c5bc0da11a9ddedebad02a04d8b4f3fa1fa7d0ff7585e1f6dfba5724f951d7775f4f69ffb2e9590241f733e48886387829ad22ee52bdff1cda42005077d183388dd0d095d7d73b7f9597f00ebe7aec265c898e32165e04cbeb97a9dfd23fa99606977f3f3239eaaea280843c09b872a1e276d0276c774a19c83d8d1664d3956415c9df6bbb4eb5176c92be12a036d3c329d02295d9f20e7a085b96ba31db8aed289bdaa665acf1c1d246702265de37d1ee76667cc0638353fbc2379330dadcdc1186162533bd2e6cbe29b31240e717e789d3ffbaba1b8a811377fb2d853786231cfbf7f3bc401f632d17e075b263a81228ddded0a3b11185992914c1fc1ef4b1060fc9f670e7fd926859652f005aa4d6c2c71c4b7ff7c0e7c1a42dc223d047157a345ddf19e7a9691b241aa76fd2804d4cb865f7fa731751c6b5bd331e02dfec775a2c592ac4d168d22836143b5a4c4c9ea14d065f95fc4e005be18ea702b08b0b2cd3878023b664b10b1f3e676c823800064695ee553e0edb32aeb0a2372d03e2ed82b9dcf326fa73004d080cfbb2954bac2b8d57116092489f729fbaef32c859c63f8ed9acc72d62ec1e7fbda2dbacd9de1f88b0cbb5fafea6573c5395f2394f9e0ff43b7daf003310abc85dfc8db10fac5374dafe561e7ebc79f1d5bb00d02c53dd3e9ea1b7843778863cdd86fd9f4a99774473244566a0ec1400023f8ba420706e0b35a57439cb80abdb235c54d186001ae8d75d2d8a10751f8c3941647a7b26831cbbaf944c849a0b2685c318778888b281c4791fc1b74277930939686afa772c9e5c38ce1aa5e09de307ddbc887b2bfe31214ed44e67ae157b65c1a04b80fe3fcf00d5598b3e1b9cf7ca76343207b29eeb42578666488c26801a3ef37de2b603c35c1c6812f9f4c41e8d077797f241eff65d3378a6bf3d801be935cf724d10ad34ea74aef4f90323a22560c58728110245738f098317469cd11f7abd78a1d8c735be9a0ac06c525a6c863eec5ce331d149dc81ae8b235edcbdb087854cfbbbc05079ba8ac562a42197c7d67ae1541faf63d1c565e89e99b67881f22953c31fb478de904173492ef167bde2253a5bd08dc8aacf766e75246f5f6ae03c15af8f0eb555792f2b7d6ce3ed7d231da2cfb997a5846e45106e78619722250ec13e764bce355896963a7e4031a0463a8dcd60101e47392277bb92d95d19583691ab6e81b70d7f504018d16e2a7ea8792a94366f3dbc30270b3505f8a1d9e1b90e4cf788d7e55fb513919ade96bd51149b76f31eaed2fbdc356245bef4842ccf3d33d231d0fb9b656e4f53fe0f4e65f760b50a2ae4b74091c6d836148ef8d47e6624ac76c296ed5dec09600400683c469dfc7751bf0898416181f86f92f39ea2eea8d21c0ff543d355303b57f596970c96e0a08f9dec60563368eb447a347f9d627e2a0646c87cccd9c09d473a0a68d96e72c323305890e00b6a239baf719534e515eea4bf1e76dc688e824e96783dffff36b63e99b7c7c762f9da3359d5be671ba6a3b54f93e0eb709f6c7062aca6a28220230e2747e02c5e4714925c7e63776ce60d1a45ef049a59d57757b855c33dc942a1fd55b7db2d5029bcf9cffe2b5632618ab5a1b2cd55943ca170966da5f597cf8f48c8a353fe8d8375a3ca77036d6ed05f30a7fcba3032eca86986baba3807a7c8e401f46c85fb8e1327842f853d3c1f1cfaab58b4029039248dc6ca3622ddc07b74c7319b0aa60b9eede921aca64388d35d0309289f69d9eb43394a970d1281232da32a7524cfa3fcda939c6f551a1d591f39d9efbda8d465ef97f18fe38f7e1941812016ca8d8eed85c7119b6f2df4c43d66f27cf3a43a6e3c0255a6f2d6d905a8a80a3545c3fc5a90b6897070f965d6bd803b0f393dbb920fc3396e2cd68b3d549443d65c7c1e336319471c437778c72c456f06e419cce5d542f98e080ba428ee97a82ebc6976479ec8d9ffe7a4b7ded2c46efbdfe439eb2352b22cff287ba45610c4b930f80c7b26ed93f0a0fa003d8dfda0c5cc38c126c08a169fe3164a04475e03508b8fba65c59246b4ad16cd6013b9fe9e9e24dbe18d78cb60948e05fb0d0d4d9a0bbf6f039451d6459daf27f6731b5402f2bdee4824a513e926dae1e54bc5662db7c4faad411f02d094f1a8a05e68f66623d118243666e3c6ef44c2e70d19d0ded4111c1c317dc79635dc6712bf41239625d8559120107557d867defd206282e47af5c8bf315934ebf8a5643549c1a829cab9514220dea4a966c7d5b94551bea29b2c7a2e7cec4e1910d9e6745c8ae9c868a36a04731881ca3edfd18087811aa0f38083f2bf41084957bc46f92239d2092e51ac266311fad420e549eb72d42cc575b1f07a8479e66bd1b0cfecbfd23ddf1580f23b324650969962b04651e623929f3a44615c9ec750333a9ced389a03322ef2da6938d5b135dd0599448c7a09623dfe1bda233e716bda82064d94f80fb81bf83b2eb68838dac030c56678236eabf7bdb3ef1e044812118ca662d6eecb860d5d0f1cc137d24b131028fbdc790329c37081a42d3384df35a9ba666388a2411e0e153692939e45f8cfbec6191095d3184450ca6d613e4950f4df708782fd5a541b51bd28a0c027825f3726174ceca82958c27b72c04bf013f1efbad22fb6b7f6d96205974434edb098da2b3290b8ec58e7184269bd84dd88265b5d65c3554246edf3e927a4348996afbe4a81c0f25758109cf582ccca463dde1d198e17ebb29294cd57dcbcf49c68cc439ced322e20f56641e1b117647bda61d1f3262c0a663ca033481c0ad40a919f6a98fc0f48049c71ce7b8f26850c2427e676d88bfee33243a4fd2ddcfbf2a1b306d6db9fa48c5a133f4c6e3a439444564e4d3b784b44116d9e19f992ecbce8819331b48ec2db27011e363b1bf904d3adbe9c7204a12e1b797efeeb1b57df7d0a67ad262b6f5181a9346312c44e677c79f3e441b377127bc6d86fc9adb66ffc6b9b2c5bcdf27962014d112fe1532db373b471c63d041aec9eede222b311510b6d25e5060eb8836b09eb906f1c4ce961b846b56515c5c0b17579b62459f449e95877dc110ca0fee65fd7ee10a41a6732f4b9cb9601bb0f2fd714e62873f6f0acc19c9e92b09f705c216f3767f3e16b6f04674c2871e391cf80f4bef390307da6bfa52ecc1d4c06f18bd08a6baba1afa2478e5b737aff40de3330ec784272cb97429fcf9eadf409b9405baf1698c5e5d78035ad6b57a67570480ce6f6f90650a08c39e1df3c72b39f65d9a605efef04359694ab955c8e0f05b9293dca7f3e1c236981aee1a045f4eb9cb15c01f79a8dd963ec3b7d327fb37aacdb1b66d04a671286ea155ffc1de415ce69582ec315803a9c22cfba9c0e44b4ae0328c5e09ee7c868ad65e917ab740daf68c89b87e3b0cd3accbcd3285ea8dd2f4b266f5af7538fb3e3585293c029dce2257ea4a6d98296c8707a0e678e48aba33d435c7cb21490633c86d0856b6d1ce522e7eb5a6452db7c6a616ca87bba8f57027c82623538d933be3e17aa4b37316057185f31ff13428cc8c92092a1774b1033c764660ff9bc1ed22c736192891712b539e24167a323bd7243947cae7681132b2016b8ec8d1b79c00f4bf733a7f1841586fff528a1ed32ae3eecffead5251dcd84ae529aed0bfcd776ac190d57ceeff257e194da3842616c271f1eb315794f49a880481bb1bf4b7ecab3942826b2223fdfc657db2ee043b63b59f27c5c1a05db4d3977b1222638a4e048472962c9164f4d92f7e6a64b228da63c93e7a33857f361268f83596e9e148ece70ef272717e6f8e9f25bdb2eb17238dd17827a7e20cd3e29b5693472ee1e2f8a4474614e4f762d098bf205801bb1c501ae42b935d8137bd46e001606e0d418c9cb73e2748ee9cfcc52eb6a53a37eccc870b0d5097cfea773fb2551a5c183c2218811572ddffc09c09185e31df02b5e1eb2f0b6e7cefa83c826f62382cb0c3833f46cc37b643495caeab6dd27df4be61e60b9456b8027073ba2266c729352e3f30e5eea55cd803fd6484a15af26c830eb65bcee588e8fc4d2f7d8bb255083af62f9fea809b26bd3139278d77b7fc99145e3e9dc78abfd1b5a413eaa9036ed9317b9ae64c420323dba96436a33bf4ef790f4dc94011c61eebe1cd465b51247a7cede47eff319ea7ec9de0cdac0e34d0c1e69e0cc27ebee2c8f82dfb5dd3c545c6b32ea752cd8ef065eeb8b8d3d8bd6de1c54122484ee87c8c4b6e11d7934ee7ab220f4602bbf9a8b6523d17e2fb0cf2b450768ff901a6c4f3db95874c148af4104508aa970ae5e93ca2d72bbee86c36f1c9757ecde707ff97ccd7806c6ad744281a981952a5f4833e4412986731f1a18d3308d9079d25b9013a86176e46ca0ca8d4cec1642f70c4f5b35062edd25221e9bca7b9dd33a5ac2e8c05639c971a488aee095216b1e8022760f78397287743d0245af752a025afb6a70a9486f4810302e25d75c51a2d1adc24b32d5dbd1e411b969bfb7dc99ada368a22dec8219b795fcf27d25f3c88a174b10b96fc9db5e009c95fec394af280832af5dd2ea3e87caa6b47b0fca3668b76e4d9142590117029711c19a3869db90eddcfc76c4d0588c2a4fd7b95d9a3156ccb1a06b63159fab911112e079be7039ce6b6378c52596bc64569d9f772d360fa25d6d3fac8887b70f4cc9fb7619e93ccb2fb7f4bc7657d94fec9240a7df49aa0111467062123ff39901625063ec34001232d8c2187a2762863b271f8908243a28b903cbf713bfa1e454bf93e7d0c15953705f55f714c08aec4f27f66c853c0caa56654b4cee18b5a2c0678dd9bde7f095e3987f40d0a69a2bda5e42d956db196385ca1c2f4937917fc7e693f0ff30f40e55745ffb746d3dad540a78ff3bd200a2de274afff7a7868bb76669a1239c510de743bdac4024d8f4cfbdddc64d20e9dd29799180411c760cff6cf83447f0513a5d59eb04c78f8513e1c369155c11b8b374ed238decd333baaf41ac51b82943b56e54654722f9b0ecea9e9809575e300431353f17847e74c95903ec90f2a588b2ad4e5995d0f74fa90b86f8fb76149dc480df6981b09bdfd05cc5486614b3c5a42d8232eabc53802c9f729e676605c1d35734c8f484a1658fef9a69d082b39004ab17ee508ad60d9579be276d41f3815a6dcd54f9bc68c80366f1b919e6972aa57f14a80d2dc741df225f1fecedc7708b12707efe65448a135ff8ac5eb015795204a4a846fe31f652fff800a8f577f3d2a2e37d6c2d9449275832ddc18d7532a6f801cb2eec01a00ceebb13bfce94882febc0a68f7b527897f78d11ad7b0e25175463db73b571f5a3874c8e37213ad2c26c7d3d81791e14fc77963c17b9beed8bc7e77ca80077904aad2eb338b84f44a4b747496dbb6eabfd052f9ed9cbc0a9f22ee1a1ed4cc73cee919ee9893aebfeac135fe4d5756a218096caa2f93113d386ab5a064ef67c8c06a7aee528f14d5a6e80ea28c5b8178d11ea54b362651ceced2cf3a562743ddedf4e32efc6148495b3fb985db4bacf6e41a11ad89a09e76e6716e5ab6b62ece39219967f0e6fab6774e7d39d12f4655fdd93c43f11076ad159863e628447f0d3d543320207890b908f42d5a978fe5fad4a5a2772df4246bfa80bf629b40b858e840e7502f71af52b46ed34c0d58b37b41091956191dec1810a03411c0c055ec208354ca9852bd6c2c0c3b75610562d0bbd20bd29c7f2980340caec4197f0665650f55a70e858db51add6ef2f1d4b4dfe0ebfeaac16c88bb91d60d9c9e319e25ea113e041e8eb5d01601f64f7f8afe10e49d1ada42889721afb919469d47182e44aad031e456a937f36ad517720ac389299585dea6137c07908fe7ba643d6be4c3adc6cd19b4a8dbaefd93ee3b8e1e04d04433f6b74ec8e7795567554bb52ce57ce3e2e0484f4ed393a660e25f41bc0038713b3b2b7238111e85163c609b7dd047014134663485f50fbe6da454f11d2c3fa1d92ed4d1595ab4232229b5958179b4090070039bc542ecd1588a63c49ab67e4639f890952ae116205ab8300f58fbfe07dca062649b9f286b9e17d11f762351f7adc65764b836e1abd4e54e1e199e6ed4017e1ea30cd39429e359a3f7f83add5d32c848800617f31b25e5b4582c0a21c69bd8ac114ff5771095949f846e4203e4ccfe8ccb959039157f9b36bfaffe259682cc18739b7214d06eef56894e4d9522d6c0f00a6c6fe84f61f20db97e111df1d3225c8490ef0170bd88c666fae849a8028b0739d23d132d8b8a45a91f095db3fee772728913e292374f0d09387bd9f1b33eabfdcb06ab669ee54ff5099c1dfae3c8fcc85ef1eff3e712775549ea9803c14b79ff092f92403fb296a4de101b8b370e1b1e8832b8838256cb782071b78c14b51c578805a6e83847007f73df9f238a1b6087366690fa6e902a6842f259b768fef930162bb007a2acc2e4c05254525d8ed450175c23e05f5121946249973e0bc5dee63cd0bc734752e461c2bc7c46e2c9dfeb5171f7092803bf4b9c6ee4b4a121a8e66d59244af4fca788b33c08ff01b43dd2fe81d4129d57a605d53a460bb23a695d7cb41ded5996f2944a0c2be7df2fba17a2451624f54d0f82e5e3f8f1620b5568fb91b37d5846bb05b74a79b39a5afb25dba5314f1b83c372775fcb4044633c3fa5807dd244e1ed40dd27c0105a9f6b72d4893417774e4e313fb1cc01b5f24d00017bb394ce8e9eb1abc10d6c01de1f33197b747744778927c5423aca0618072c0ca8acf0e0c28cad347d16ab7ba97e2b8c3c4dd58dc2f7adca4dfa4a848a9ade5d47c33ea3dec5e862ffce29f826fe57c7e89151e18df87ab20ba155bf26c1a21030a907bfa40b2fb820a39954576d45f9f2fba1f6741a22b3c99787623820b4bbd580bfe6dd248c1b5213697d1d39fd595d7af6ddb708fb5368ad13c8cbb1b7796421d886e12cf95e11066405dab5f382d9b2c8f91c73948b7a0da49f36181a5067396137de9a19279bb25fd87eef8186c6aa534cf92efce7a9a7bd10780552be9b5dcb328d1c47b8d5b24a8bda7fb07132f3561cb0a11cb72a24df5e1da105ebeb34358e1a6517da38010485fa6c8476e322bf09388349d2478b2f4bd7c0575a2b954c7bf19bd4e7cc4db8be5c0c515ca55f334326e82fc8e2ae596f072fda5fad584d20c71b985a4864c73613972576da627aeb73d5d2e86967acb0bf2ea0b85d7839bd39f5391d617941c7068ebbeceac28df8fcd58ed6cded241401d3b2506aadf9e8e411d0f000a5dea09414eefb3f8a56c62e5d228810b52112c177979287afc42a0e089504bf674acfa31cd7dd86675cf7bd3aa2398db609576a3a9a9ace33cd50d320bf6cbcbf07e9370c8b751c4e1709f0a69f70286b2b49a201e56e4ddfb517b7dda09e33869ad9dd0b9bed19d9067d643773de6a3ed02597d06286c12a7ff7b9cdf88659ec53bba8c9d5bd496dd1d1dfcf21ff63ba1f32c5c86f66cc051dd92aaa4650e457c303b114fc9a4d34100628f71b3681b43cbf687692b5e1e048b1856177f745675c5163b845f8b7f1f54931f91de60768eb11bf3b289aec04c6192f1f2c2abdf8767fdf8a0a320369b09750a333b73a9899eddd72efbe46d8c3cb1bdd56d8f97e81529e9d5ae181a4330a4b732003be0c40e71e97edcd1952c7590b037cbff1fae6037fd7b3c3ce998b39152c06e336f33f2faf51b87a1df540156e9831b3cb5dd7788eae3ed5bb2b89571a6312373f3943ef64a3f0816a4f209d70863a31281bc6cf59c7abce4032628017446c3c50fa23edb1ba9654a784e354b7e5a8d0ecbf1133294e8aaaf10fde6a1d646be6c4cfd93ca557b5fa2707c048a659d000189e1c25484a9757de1367bb4631a81a9d8457185dd32caa12456837b1ae58f41163289824fd43827c926d7d08ed8d2dd5465f56a69d9dc3271d5963df948268b260b2fc90db410234d6574991433b5dc5ba5f5b54d80cfb5e0a925f5866bd06e7366ad0b72b5381ef59e7547bcfe1c909c93c0c3201bb956262be4626346d50ab2d8","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"f75bbb3414144a7992bfe3e908fe0176"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
