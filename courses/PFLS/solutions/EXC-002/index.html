<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Solution for EXC-002</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #217573;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #FFFFFF;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Solution for EXC-002</p>
                        <p>You shall not pass! Well, unless you have the password. Then you pass .. or <a href="/courses/PFLS/#exc-002">go back to where you came from</a>.</p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="SHOW ME" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"2654b2ecc4593da3404f70cfd5ea43204a98649215a71769b3480d3b95839f157c72ebe731a800f3bf81432524dbd3689ed6cb35980256f3d62a65a7695f0ffbbd3553ace7a719f0bc8bcf64426339b60f0a793cf557f878a53745c3e914c1d1bd2fee9f5e7746e22c15e39bcc0bd4606b50fe1d0bad2615ac9ac664842c92ea9118b87ad6ed4a622a57079ed863a884de9ecf07e97abe63e4d7021c716ae7706dc1c2b67c294a9647f60bba026711d5ff6c40dd91ffaa42e8e4cbf59a68a77b99fe88a3eb9405fb004276b978b785382ee3a9b9dcbd82b3139118ab4e80f0cc01f95beb566ce8eecc8e78b5886b50c535f6c610c57643fdcbbca1e19791e708e65e604c68214470fe920754d9940ae8c442f0d4d058a648bfbab8971f8760f5c5aecb6f817bdec7e11b476c91f902a2203da5a806772ced6e155c85419944f7a0d6af803265cf6d129c20a5688412dc50ed42d1d54f51b37e63dc229ea498ffbbe6387399c4e4f29feea72c5f06dd5b2b4d26945e3cd1a0ab23f9eadcfb08ec9abbee3fb41bac028eb11166d4e1e93d10d4c84b750b4519c35d7af8452b9e47165b2b7589baacc223f4dd99a1e9ea69050692a7a3157ed50fb9af380ae8c171174a0713d9cebc7f686352cf9e2e3673fde7c14fbd73a06b9e155eaf7704d70c4b803f1335aa59292c719139c52c049eb2c27e15e4b74ae72513385822234263c96e9f1fe7e1469b23c7d464ea04ad38a066dbc5c71bae54909e765a727bf57267a179ef038501659c737932127bc1fdfcc44d5d888ae23d422bcfb572c2b506dc4c52f676e7c94364863c4ad186cb32450db87a568bac89ae04fa4bd41f905fc92e50ac3c012bc199971ce26d4b03767b7b18cca586968ca5537b8e077e6c78687e3e2a265825572ecdd3dcdcf13f991785ccacd597dd2e7ac431510457de176ea14ae9fec574e2f75976e65b94e00f43aa268b363bc7d560b572dfc83fbfc712f65aa098fd526387b3cd9f47d9a08303ea5acd3d502bf3dcba094824eda7d4283b7e2db21688d5e8e2d14b4819b81497b0a220c8db12e7b217bdb5b847a88611a628055b9bfde131901520c5f0013b210db6447e37a6b8cddfce9e92a7c8338e0dade9d8500b2e55fd68425027061130cb2e42c7d9c0b88ffe712431985669e3e5876c451393d78c7890c40a6fca07b017c242b7c21d00b87f3e2dad5e24ffd9fa21610ab2d13db71eb005eb554a0be801cc1a2dbee34191fddc02f5667f2fe91a253cef5b04e4634d321707cb3ae0b316eb6939060c5bbd17b58a9eb668b46e791b3e12234a9c2ffa2081205918899698e41f7489f28e15f345934c7a92f5c4bacaf661108ba23b4bc653df7e42506190b1aea6c7cd1197b2ecbd006eaf66e0659909c00cc31906b32b05c8b6563a5b426452b7e8b559f143c81404d37d64ef567f5d9ca640ceac4a5ad3bc943fca1fd81208ad731b64141284cf69dadabbc5e966d320a3d023b43ee247ea67b47868c7b7b9c6eb7f93423c3c20e55623b217406ef20113e8afc8a9af94071bc07d363bac9dadbac5ecc14dfba21ff0aabd4b562948999e40b290eacb518e069bde1a1f2f1c99efa46252301cf465785b710c90b5db0ba2e39f5938da26d58e50bd4a5657e8544267742327819f09f8b87927b7a95d2924b6e80448226e06250865b1f130e3905d4c62000295980a6f95d070f574cb8cfcf6abd29c8d7bf09336954e31675635ef5445a68e9206ec6d1471964595ce26dcf09e2149e3d477a231225b04399188ab38ebf38888552f1eacf3062a426edac9aa960fe0acf087a4f108b0f35222b6d71ec85213fcb5dd92222da8930278aed11ec372605ee4bf09fa5857c58ad31ad8936a3707d4fc2751c52b5bd219c63f6d978e66200bb2f4f66f3601a70da4ce42d5233b135c44416090974b2ea7d688702b4ca36248a1600218958de2e281a1d425c28008b19e67a86f1021cd9ccfdb8e36f436f02f6bb376f041fe8840c25821ac04637d337044887004cc7eba1c7261eed05e3963c27a51738d5db48572d4cfe5df2164ddb997cb9adbbad22430a3f6c4645f3f774910369215d9fc85af610486cb04f4b942cb470957a19c09700f232526c7163c8525f73a22f7816f1d08fcca8b03de6086106a7b31ef50b3417727f9a40098d994e4158b395d962dfd2eb4cf8f03721a5e01eb45170c2fd65cbf551e9ef969f80cabe3097b6b757d0c32ad3fee4387399494486afa4c6c4de27c33eb1dab4fb2b9d608d0c90c8a00c6cb74cdce9e920d9e0ee5c4f69da12531b07599f652e9d1ecea930208a35daa1e3cf0b1a4ea1daa3f0c2af6c63c785410c5f63a195395b1bbb6ab8679a033cdedc8bf106ed80e77408ab37d59be3c865a4c5d16494eccafa93ef4d72b355fe9605d2caa52d1d097cc046960d27a582704537fedf147d26590844dc5d40971ae41d0428b4a35b60ce75da602166833cacb9aea30348431fd50ea7cc324a6469440e16b2f5d43b1b5aa44b39a148b7de295a7c82e202a40e83121833f184e5958c30bca2bbe97f3a2929b1392ef8eb0243f1252b5afa4f24b76cdad9c5599769f5f5ef664f776aeadd350c8c0c9fc5e68437a399c252b4cc10933a2a7820e284cad4d4404644fb0daec0c30114e125f12791a0a5e7b07762d6c66436dad2c22a1969464bd5599144ad43dfd16ed222957c4244a6e2dbf48762a2cd692db1d9c7b48d84911f255d1a4283661f96fb2ad06acf6f3f20ea648a79d9c5097cc2e3cf6812b58420c6c9b5efcc22382a36b92a7bdebd2f352190e0753f2cd5639af0570b6d0afafe6017322dc65d3583005d611aab91e05d5281993268d6102dd2f5997c932f2715b9353cb8aec745a0d561d1abce4c1744fc050f7b2a7ba85fc84fb6f68de851432843ef871525361afce24918e52ae01542615fbe55eea8f55caa12198e075dcfab741ab39da20a98a8d96b1de83a5eb8c7f1e0e2b430e12ec1d1f1645f861b0176af9e753eb420e44a9d388cf65969a11e9780072b349177037a1a5c73fde2981f23a8bba263a23dc18f90964b123e35f6ad0b6b61ee1faf98105f9e650a144109be68a387f96da00241c6e2e5d66478412a6dd7a98b6e7ac3f4178e52be64dfb1ef5235d79a02abfc59e5a4bbc19042eae36f1b3ee1207fe1654bb1bc292de96313a8e80d4798d30ba827186e4120ebbfedbe1b9db7017ecca49dc99785eca59f12b1a9d62c09a7650c608c78972b93c8fa5354297e633d1757530dea5fd255bb2f0b7dd5e7db70da75f8dd78829abf2f611c2d5a6ccff2ebfa53fd29de78494286c14ba0c9f360c3578968785a53ca4bbb1553fc8ce4ac0ddb9e872274389a05fb9d9b8025717e53f4b9683ede2509130b22af96cd9f22e2ffa01b2ad2018e570fcc21b64a78b040f0c81fe95554dedafabe7fa0dc030161852963800f0640cde32ba6082f9690586487dc73a03ffcda6fb481e57ceadf652462ce577df18a7c57889c5dea9021c4397bbaf1ed6d7907db32698fbc959f01c87c31bf83606526b5dc0bfcc64ebfd582b3b26630ca625aa42eca2ed11e475ae3f15eddf29f48d9ce0ebf11eb9ee1d17d0104e06fa8e490122e6c484e953a79521559e6498357ee05765de93ecf631b974e9d2db5bf64bd556b4be6c4f07518beffe4526b2ed17b64f6cdf57897d4a221b6c2cb261e5ea2fce916a7b3e2496eaf58e6bb67f2be4486ca513a12ecce474eef28999dc8bc664a1029172bf86f9d1e0f255b09b3c89d9f8bbd1b44a6f0b08d4b39f125b189cb4d2d5eeca9ca7efadac3a3ccbe5ae26d1688f3cbcdad9de936527b43fdc9321affde6f6e8b9f8e6f27911d3b361bedbf0547ee4d9bdd7170bb71b5ae6ce8e33abbdfd458b99fc77cd620967539eb8b4cb21eb87c430cf8141b166b4c78d532a9ab67148b00eecbfbef1e6047c59473b7f7eacb24d6d599c7aad8da7eb19966eb06507b99555168de2bfec6e1fa6499b64c23ca2f3ce644a8ac54fb06be559bd4b099cca8085d371e69d1160c4647757d3fdbb539448deb619f70403b3cc73f3a61d49fae382d7b7ee87cb92fc979e79814c08f7b4dbcbb7703056245f7b8a6ff52601c06e952c222245c188c53eea8f7a8bf1bb71948b33cd015599b8f4d94a1caf31100d7c9b95ddcacded29361abbd8054f9deed426fe9d54f82683d9891558657e2fb40f531c3e90e7497791990fe8d4d043ef6c40cb8155be4237cbc6d35812062b2e81c4c939133dfc208d430666a30c2f75a1fa09dfee58bb0c1b572f4b982a6b743bef278c4298d7161fae7dbe2e6105821cd925e829f6f17c78fc0b9f6803484a1632d5c547dc2a754146180e8d7fceca0c9e1c2871cb936003f38c730b86074fafa22fcd708dc026e1ffd08d1f490e3f4a0b3b2ef0eeb44eed443c558e025e31d04f9a820c85d41ee6fc80d3bb9e0a24a91f211e979870ac323f0cd7401825a0dfb64962da0a10ef6f9a4460b67614ca99a84bf8c63972089d928a3fa60279954551f8080b200f1541b56d989d6ebdf5b4e7b3f1cba4300ec795b7ffc524196ea36956bebc403d71324eddfa61a197bfa3a4d08f9a92f461ecabc955c41780e28e18395013dc0e331f0dd12882699c1e8176d885134385833b3f576971718f9800b816f7c8d241c471ef2e959be3dd8c30d6665d952de9f91ca0bb11291f5d0470ffabe3c4f1432386b25027e3454770630d75f8d25cfe6511626e90e6f09f7cf1f5da65f6d2490c37e99cb59e39bd783437b175bf157b1c375c7a023b4288f407e20678bfc1ac7bd7a40abca1abbbd735e0bc45c2ddac77823f037dd68112979b1380b5b186e2d1203687ce1663319bff14fc8152a6c97b3e01778e49ce10880f9ff0e45bcc731a17ad810f7c452fd4e46320c1377e12e7b28021e821c4ef6e1f34135926a2d0415e3bff36a1cf87cf6e3ba64728594046e7142d7e2086569b22aad2b31c5ac8ff5486853008aff69bce869753793cb0b0996d7aca94a315281fd6e4709595389baffaf99ec97f63cc08ec1f2d14fa4942d75a2581a2a35c0a86f7fab6f88544833d65cdc986294bfc4a97322a86cbbd90d45667583beed6e29e5eab520b464e828570ec21cd41947f9bcf347aab09c99e6b3384dc90bb0b313495a737d3fb169309fb0b3063cff3391d054103dae05229f5715d535b15020acb403a0b13fc9cb4534ecadbe5e740aa6a867bf3899c7550e35949c11dce1d711466dec7fbdf8e9a2b0d613df08d564a037cf367d2cd6dc8164192d594e954e19d31e6708f34f3409cd4ce537c812991bc0ff1c17165d573eca740cf72e7273ec6f5c7ae0a7974eeff3976d1d67824ae453052b1c5037f471ed3cdcb8443fa24299252cad690e8560ce87455b4d061d8b1aeb54c90859ac15df7f21703562874ba3d5eff78e9edcab58241c6f6e99f6ca7dbd62d0a6939b295386edbfb352ed7c577dc1ba3b2e118de34236a3790cb52315a50f1fa02974a9ec3570e5f944ab7c181fb20f4537d4c0d36e1fd1b63b976cd509c8c21d2e9131270b16991097beb415223f459bc653d0d1f205cebe7c54ad50bb1d8aa4fcc9bcf1884df82928a0caa7f4ba71d0ca613504e947ff4d3eeead1bf96c948628f04a577dae0cfe2300a582ed2748236ce9582e301fb97085782d529e170ac221ae086b4c440fc755255c4fd5a2fc8822c6965f89844dd4a426ebc8d6a0f3eaa5a8a2dc0cc5a3bed74ad4484f786599e4d1553e06c5b68d0ca0301c2e9a85d5b32e0e67ef05a4b0348b0ab4f6930b980e84305e4a55b75aecb71aa96fdc27d003f177bc404c5f62b404e9f19a1a4b87795c492ec0a9127d2b5124e49d13df8c91f2d17084d87a6712ba490011cd00c6639f55e7a3ad002d4eb575b6d74e626edf62f84d6ea4a0b9150e0239cc23aae5e540b389a70c265f14c65c31ac6a324ae4cafb7a58d26273991c2c3aa0d82a8da8465deddac18a3734a29b9fcee7660cb37fe4fa400b73b913f84efe2946b8633ae5a696acfe1d6e3ab9a87a32921dd8ba32cd569aa0ab835cfb0a670241eef77e81c80737a4933b11045ba167038a7945ed4e4bf5881b4bca13decb7af051c1863d6bfc6b3e7509ab44e33a0cf6c6871cea6fd34a1aad6b126ba909fa63bba2c0b4e6cfc32c3e789ee24220385e06bc4b66dd7c4cf41d77aec9b371fb6286de679e99d9944f7a7031dc68a97f3c4002d35e0b3c0d53a12a94962a7324239f97123839fce99298fd0e43e00853841c5e014f9dfcd56616fc15f8ff3f19eb0902f6459aea51bd6a48f0030a279076a25c1f152d7721d211b08c351b2fed135d19b6a9ea7ba08bc631ed80a1237f0d6201a2f43f367062dd405f94840b2bef0bbec47492a48c6b7db105bb7d28b634302ec93407d82b8898e74831664955af761145faee75e72f5275c74566e026dea22584fb8730cd322669ba10a3633c8d9a4f93cd123cc40fa50d402639071c8a672290aa9f6c5a72fd4586e8221cba5544ee9717316ed7202421a106ffdc6b01fcfa07f8bba9a2d6206c78753eb987e96174cb7fdc1f785a003e03813ea4f84e0cb88764fedb215c7b1fa7a4a4c2cf20779a221450de2acb4dd5a0e340d20e74df3c6cd5c4dc60cd841aec77e9596264027cd08c603002622c9f2824fce06cd6e864734d617807b2424a5c6bd81e619ab672cf345fd0b4c2d0cfe5a8ddee7821dd2d9f3d06c2a2c4fccd52363014a3f461552349f9a2bc98e5dd0051c51eb757f83099063292690d3106da57fd0346e2c29fc77cd346e7b3febfb22061989c0614d339b19802a7d177cb870d8c0813310feda1d5657903c55c9ec888f4c758a80f89a13f2d4960f9cb39fe015fcd34806fad7be9490594144f5923005bb333d13f323a4a5e2eda97239a1f148fc742d82cf820b731f1cfbc69bb7d3f0550c5982810780bfc368da89a0752fc2003c67f0a0373172fce7df23a076668da9ad14ec8ddb19f5d1d9b69cadcd39369dfd1e0debcc674a11523a73c2f52e785c0135b177330d722edbf19b95c21e9865c544a86ecb5e3042d81f6cc1ca9ff682e9d3631adb4b1749cc591175ad0ffbe58b3c3063d51ab5f8f4ed45212900269ca04ed5ed43d5229fbcf2cc6637f843268021bd6f10866ad4a6fc733ed90b857be7271cde17712da6e833cd9b4a973092ad4bd4b175f6af974d6cf6721dea99f56e9b8654dcd8fa5111b8a7a79bacfa1a00f34419e674d17f305a1f1e943482e9ffdfac8da045be1b6bf151727db059ff3ff0b4371547eb8f016c87ec7d0857ed137b4d3f8bad3caae45d43c826e21b178011cd7440368dac0d27d0816a6193c8777075a2217872be14894071991d55e23f971304dacecbb9edc73946f80966be883d14c788e3a5793a06b86417d860bdc5530eaf96df83d20cf3dc40f593a87ee698f840906d2239c7466bdfaf97db4287713f3d44468298a7915212b1c08f76bb969aaed8920cecc34c8179b15b78f6ea962311000c6b0c57832ce757fe008c40406fb1334e04efde160c2f866c1ab6ee0367a0bf15387711a47f8a7623d2182ff51913dcb53ca91600e03960f23a06f8395cbad72f1caed4c3b0059f23f940fd88042a5c685338d3e1de73add507cd21637c1fe0773dab4b216523ab68884d7dc12509ff1368eaf5eb848e6cc201b7f722138037494b2fbd8c20da43ba8ed13beac5b561746c348327e86a3dd5085983e5afec0a4ac3b58b2f9b051c0d911430817762cd0cee880d7357beebaeca5aeda0391dbb1b19af97629026f86ba2da63c2d32968c9383b759e1ca75b41d0d418b6c0b4d3cb983b9b93c7c911f2caef669ec9e32a36e94af465e06f7dd97339b688bce2bdace04c920ee2d6e2a4ea6c9f605a0977f4507b6195cb0dcd1d5a691d45452a734f13b54d7f790d8ebd3d00b65526fc60f283666e1398aa4488cdcd0b2c1ed8e770e75203aca4305257d95486d5e2d7e8191dac97567365d38d71c88d07b9f6d51a17f5f901a8b4f5b5f6c013c8778ec4e88abbf35c775192c13d56812d5a09212fdb907e342050f2feafb0a6a49d9ad56ce3731462ccb037acb0555edd6e233036fd4d2b8ea3798e49bdac662a883f512b6692ab02d69949ce1edb6276531f96f3ac7e5c0ff6261eefc4abecd3e11647bc789372e57653965750fc8d99008d7d7ed62e770da730bf295406ed753c6e56626bfa7552c4e09c4386f8ffa40b9649b7f3776ba7adbded66af79224d412d82cf6174c976e5c5c9779cd10b0e5fbe08fc752bbc226778a6d7a7142f0a3f638713864791f584d9b2f8663fb1c93892cddcedbc15469280e1bcbc4a8d1c6d019dcb2cb566f0534cb02c4f5c73493d0d822b3f76c9b81aede7325fedbc03a7f7cfbe0e61ea6dd25e4cf8409cbd9d433cd5d615d7313aeb5ba8cb08474f7c72272125e7793722d37e253dd2edf6ded545c25a59d428a825b8608b571cc35bebb0d23c98a7486e27f9d648f4218f59b70577cf9fef435cfcd2a8ad9cd43c487e8387c1f6c2e98b5077bec0f4d18a3f1fa312f4d4bd54898236ee070c37170e025e6f54a25de73b3e04f10112caa7071f7e56d5cf2f8b93f334695d70f8d1d6c7df574aa54dc1b14b090981c9c8c360c0c7288b2400d8fd7c3a107caf564b2ac52dc6663602f45901c609cb13965490acfe967cf21da3d89566fe7b676e148133f49db9d37e6a4c909940f8f7d81b57568dfcbe4407c36efe68a4962fbcb4404fd637d7e82816afdc1f3790b1c746b0761863c6801eba2de12472dcd0067799591a6b041e0027d82d294b3bac014da6d37fb5669df22b9d0effe9b1b9a6e543a72df166031dd60cd8a2559b48a867e8977975b6be10baa9ee95ee0eec85e3c37172d0e19a874adc32bc11584e7937ea521d9e734abcb8fd505f4f43535f7cc81a151da8557203596ff070571d78cafb8284e9689669427db86f7a83f935478a669647bc70378f7d55758f2a81ea2e8fe42d8705b12ed281489e8097ce8f131a7fc56730b42043419eb71fee1c0117ea0d93a19829ed57b9571dd63c3afd86a7b7efd70a14ed3a6549c05c243fbd950f14f13e16fd5dff221ad98da727130c0742d9ea1597449b40db792d1be6d7f17bf79b60dc723c9855f0c622e46b6be2e2fe981d5c5890f5231d872654f531ba6a84f40dfc7657f9c842e350cdde72e1b85d6d509243c47e99504168260d4202b7f5ab39f5a30bfd9a522a23508083d9a32adaa2cc55125b0e5cd685bca8d1d87c36ce45c453d3d599b590cc6ff3892ef010490f0eafdc709286074324e8aae50d9c16993d9d42d3bdcc9e70518cd07920cc1eda23731daec27d2d935ffd9bd0d651d0978c74625117ab5811150e40bfc1728bb695d23ffb860d58830fd7c698d005cecfc677dd7efd65d1a614d2c1ed106fc88e82e72d58cdbe585e678c81e668f1b2d54708e7a5f85525b09bfdb2289d5aae8ff17facfb6efd5fe1ff51e5db05f32a024437fd23fab9c7c2c85818b1ecfa32f6ff3c77e4cf5e93bc31af3380bcc5964874f8f49c041e1fe37d669aabc412cabe0da3aa52e16b57511bfaaf9cf772da434851c857832e6c318350003c6d594a25645bb877b839e65e2f12e07ff030ca38bb772483994d3e6e07d9d9c484699af9381f65bf1b166862072cbdef39977dd950d5c450ef777244037fb6ec8a7e1fc0828b99c0abaf87fc800bf9148a90701baf8f875d2bbc7cb1bb1aa0d1201a40b2bad4e0db26b5aa62180f572c52e0c4fc930c4fa6d898f4c0f55ff2276d2d22949c1b80aa1e430e62778d43edd6a6a3ccf401a10df1885f7ea3a5c09860b2be5989cf9b44892d8e0f7cc7407f97e860fee8b0ab7c935f4cadc4a5f0fbb583b4598ce8d66c8b724eb72bf3164223af4e5eb4006d04829700f1c2ec5a1f7bbb1719a786dc133f5477c2bef70158c77b65a8514cde479fc9b84346badd80d4b0216e02214259192391aaeb18114f55f0f31dfadb54f4c8a158abe908b436ba888be9b91a95135971a1a343ffab6456ff9cce6ca9038ab46ebd02ad9cd627ca0091e37c62fd34866272d4dbda8244aa3893c6c9fe3c8ed6c47c817a64886ac5d80a89325a691d9be7b5b93bf224e53539a1bd768aded792dceb81a89de2c8e2f10e4200bdfa40ebbdfaa8e0e404e843cceddf1a5ca0039ff41776acfc6bfbc618ae71a1f9903597980cfbc2dceb98566812c117584e185b89f4fb232d5604a7c45afad863f06bc30b3a578514fc1819cdecf0518cfb6abeb07dded57b7a6b9aebd44ef8ff008e582cb12a2223392d9b14fdde6e3bcd00d27bc37bd6aff5f52b52a718a33b7849aaed4ad8d59b754694c8b7a37a5ae61319aa67090dae136ad5d705823ce90333c1ea9333bd113d16167fc41ee863b319333e1f073dd3994fe0045a323b878162b0ea5f2d278c23a1938c1dfde48416970518a26f8f392c55ab4aa59b99d27e7fb360cea9c1781dafbd91fa54110c8e0f56214a1dd8c014b65aaa294f1196d6969f578d99ec6a4301871e38285f4cea96fafe9d785604a1a6f0768b74d25ce5c84bf3afbb25524eaff93e45e35d4eba16cefeb872e9bd6c56a600b3af062f1286f89e60e7fac0e241408e92e8e2b5c9b607a6f0c9622d1ba0210e20d845e6a422482d76fd3f165dea69269efe51e2273bef94f5ada95bcc23d6ba3decd62b626c333727b3db787dd8f9f4cffe5933e866b1e50542626c1a83062b1fddda2650b05508aae6c261035dc26aa2a3c2aee40f9788d4efa1b5ebabe0b63c3b43095a2a3cc0f2a4af827135495af974cf6d59b17a7e27d61621cc305309cba373fc7b03c944af3cbc04545f146a06ac22617db9a89194b80ebb819cf4c10fa69dad56aa8d30c77914b53a857c3fe5322d90cfb963b9e444b677818ffe3e6731dca4ee98ddae47836541e6f72879df595737da8d4d26b9ab270b89eb7f4c23f1233f8cccc50a305bb60fa032e2500875baa72b9faf59752b01d175849b8662608f2fa20cbaa36aeff8a938105c0e6eaa1f108be84cf8f813ccc9d2ac84225eba4eb35f4da2fa2097fb77344ed74be5dd480169822e4a56948f389963f1622d15b7391aec43a6885f814addc18162918cd94dc2e201fc4e8acdfdd5f1950e7dea9c993a7884d35118fa0b07b0de9dfbe0c059896a20ea7cff29779d5061b71504c49af90ba5c6b5ba5f879fbc6a965e05e13304fc1e06deb251efc2fd63427555cf4f14f64019e5fca21f8d3464fef710ade7cb22f86a9d6a514f4ed592fd2436ba4702016db69391ff1543c1998f31a330a11359eea2ec11c9e1fc79228a75a35301fe95bb4026595eaca85c474c7f97c6264f167fc5c961bc19d9536e4e434d93caa3261dd459815fc9d27e2d67db91affceefd832b49e3376c65d2871335a51f5c309d01f4f3b1b8eb389145ae63cbb741c142ece4373aa149f6fbd754641f574bd483fd2c02fc10fb31452ddc350dd70fa8685a79686de3206b70b422d031de6d04a584cb2b6d946d70941f1b0a9a620523909cdd85f87b08730ff27b76bbb8e27ac913ebee182e3d5233ac01ac5735ae2eef6de8732d501a1e54e720d552dc6f9801f81dd038667fb17abcb1de80a23779d5648cea3cb4f424429c46bd442668888a12d1a3afee3cbb3a06c4e1b62d292d42a75a2f33887311e0176025e8b09ddeebc1bb46e1ae6797e1c8e48e4362e603184197f1fd8c282588667ff4edd6aa6334ee0ee5a8c22cbb971a7e391a51b52e9d63a683e749a3e5f627465109aa159fe2977d4e30a1f6ac80eddfcef9ba615b959ff923daeef7026d88520d94cc3a49e57fb9248ff6aaac3f80921ad28c0ceedca033596779e1e63efc329fdf4c62604cef5af3227fd325311c58947a8793c4211fb1669f3316378a3dc26bf92567c6b90777859a17ceb385e1889e93fef0d8dddfc6b86aa7eb0b48d40ac83d891187582a1229abda710b4250c5d1d471d26df090bd551fdcbd6a1e08422ce7e19a1336c8080aacf688b98e3d05f6f3314b3f707570c286c11c67df72767fe70ed5210cc4d23eb0843baf10f89df1e86337c29ab4858be39a7d1204ce88cef7dca551b249cb5bd7cce79e6e770fc79f2e06a3b8871e3826b617c60170886deb1ec4ca4ef9b97c94026a7c32490802ffb7642e15718549a4407ca051260b1d66c1273b0ec4967309f8323d5afeb02ff7b10e54981d497f90aef02b8d934c9c60bc908afc061f22c92e517bc69fc064b6e23815e26e727b74b07d67b24b1c18cc64604fb75141ea1d5bf841d97e87951057136dfa86d0348114d3065d1a7008b21e1448113abaebd842e892a1339d4f2d10f7e35f929285d7e86896d2e773c988e3dc099a9a3e6dde4ea7abddd119451d9fb0b7456456500bde4f251bced1f1459bb2698c2261da4c3b877d5ff8afbae551463e2ca82b7e680bafbc690a9d13c392b57f201c74bd8edf114ac0261e7236bce9852b6f8d23901917b312670577a10bd53860f731b597c076f6f5f08ce99892adb3c34d9b40afa1393547b44da59bd57a4d390a935d91937746033543d9c4fcb9acd2367b8a721b5a0f51af54d0664e57cc1ea8780bbaa1f78b7f989a334f84795e1afd94f4c867edd01261725751c26b0589f8dec299a5758c719919c3a8bef8784087cab0d86518787ac26fa8c680a3f2f7d86efccf656afd57e5f414058df38aa5683616ab8be6c94095c926fc050aeceecf8680fe0f1a9b11b4a55a054908badffc4082515c0c0a333bf3bd9cabf69256b099be04dc41e6bdda8db56ccbeda848fc7d551406cb87ee2087abd6fbaf79dc27eda4d6130e25d871b245b26d16157ecf200591344f0bd2e99d3b1e1dbd0e67323195af877d3a63e85218eb5eab4c50d5d9cc98d71a1567421261248c43576169c2a7bf00f4b70b830bf75141c3ba24bf345aa4237cd0126c492c209dad026b3263010f6a58a672a5e067d64da64d75a69e155dd1c85f5e3221f1dcd604de543411af63d6e45339ce7f4b15fb37155b7040ae12640dfc298e67fb1194558c373bfbc71def4d1df3b1684814eeebf24795315531b2efea2e9c788609a3662fba018c4369ba4cdaaccf8de7fb024f2534bdbbcb4b8f03ae8eb853d23db1454414f1879eaa0812a46272336f557990e9afcd9224698b9ea1981db4ee61409676f67f7d2244b9728ed3711c5de42d881801cdbacea020562105cbee03875392f5041034ebcf1c894dbe8736b320e0a7be6a80bc258c4cbd077c952c6d9ca91c30fd9180bb8dfcb3971f1fdad645e20653c585c30baa5512f7cf664a422b6f56f0c66141569c187c70b9f855c03449ea808125b1cff026730ae55ed0139babd02d465f3bc4e284853405851dff5fce862ce71d138195e4048023dfd4c687d85b46ff686563f5d83f7d8cd9c907ff8de01e1508253ff4f6536833335aa042399d51e61383974ec95ae76a7fbbae04c2ea9a62c0253b7601d0d781dc04f3e50bee83938499e0df04471588473e7fa9ca6d54c1ff1df677db31d43e001f525bbc0b88db269e68dd8ab93b9951947ea37ae15d4208f167ebf913292b16b9830694323e4ca9f20014d0f0bf2f75fea251a691f869980c2cbfaa1e97c5949d3ce692b7b2bacd17fc9e85c9580f3313185cfda48fe2d4a7fccc78b65ebf69523397cf38d8017e30102ba8f50dff487909ab294a056a4d2c1a1a2a1564762b2790e5c973e9b002bbfce884d0ff34d14668e2a058e54af6b0ff483195d0e19aef3b4ff1adc5f03b3047ab971bb592b1d826994c788322e68eec09fc34c2d125bb0246c253bde7f4cfa4ee535f5e52d90602f1132a6e75105c1964aa545b193798e80dd33f63068ffffb5f71a2c325bfb321aca2bcc8b9d866d43d29a455dc982d457342b66f958856398fe50a54e728e415beb1ff6d8ed031be741b73fc6042101743cbada35d0a42f9c2a8c2ea2cb5d263f44f526d5a8d6c2e36d741e7d85f47efafe004fe2eb9d8ddec2609c43bf5f2aae7befd6d4da590601163aa9b5765b73505419db38e3e81f51a63d3d0f06cc1618e8b1586ea866cfcc2ef03dc44eb0b68dbd6bc07208007e4a10ec0bad3f4d58aa1d8054e61f9ad088feecfa13b1b00e82043789d57c366bcb8abf7b507ba222fe265d60dc29b7ed190cc18eb1f1bfeb27cd696002bef18c314a012285afaf30eaf70b08b5fee78a298529cf2dbbaac32c15911c67493e93fecfbb60355aae34e856eb72a150decb3245dbb55a18f097bf8a1c3fc54aaa70673c9a6e2f21bbed709039179ae6be13a9d69d5a92b28","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"5d5b5bbb182acfb2d67ca69f1623cdc6"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
