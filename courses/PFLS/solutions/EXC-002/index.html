<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Solution for EXC-002</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #217573;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #FFFFFF;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Solution for EXC-002</p>
                        <p>You shall not pass! Well, unless you have the password. Then you pass .. or <a href="/courses/PFLS/#exc-002">go back to where you came from</a>.</p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="SHOW ME" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"aa133c7bbd8fbc0af9671f19ea19fff02a4f397626b92792b5f541229cc260232dd71a90873ae3f3dab44d200dce48b835d98383327124c60e77f2f426a971d6b3769a7501fa47d5a0f64fda06f092732df649def4f2e3a6fa3ee2addd004c8b14f0b3bdc347439c455499b232d54249ddd4cc649fdf67e0c56748f771eb706c6051413460196e7ce333a362cf3eeb8a291af5eeadabf19f8fe0968f4464e0c4210ed712ababa00fc63db76d1dbd8a70599166de800c92bde5aab4a1b955a01e47277a68ce0208ab228da6383e6cbc9d6aadd37b43717333edc69a4283eb7ef85b5b3ae82004e4203dd2bd2367192ab99f47c1c91f569811a1bf48694b4b28c7440c523d2b3a15a5d5a399f54c6ced087ac188363a9e8853331e0eba83970a7d8963f66c4f00d052cfdfbfabeda11b18c7dda56bf8ad0df9769525687f942d4263afa236e410d7654107a51de2cadf659b72309ee930f3234c92cc216cf0ac6fdfb82f6ca0a0b44e8b6c592f24e5b7fa43b8ea3372bf1fd7462ab5cb4442ec15a3e574a1ba0f5e752d1a4f51e3c251530f1184d9c6162e25070bb7cf66beaa9b8faf15051240d2f573681d0f9642129d9f8535d49dc48ce1465fc9d7e7ba401bfe04cf59fa37e240d20eb44736812fa0ee2562f53333c054ecb2c7d2165b3c99e795ca7c08f2b46611f089566cd3682b76e81ce9fbe63459798dd572ecf86a908e2b9eb41c671c665bb0d2d4d290dec5360e164c165971e8e0b52021d88f40d8c5e8e3475ec8550b822115088a084d8d583d833946d644b3b4c1a69a802fe0acd04986249afc0a2b625c8b1517858f14b1642ad4eb69d92865705117834db7aa1c7967c60a2f989e55f6a0809f323ccfb032764e98044569efbc0e553cb34d07e468de50bb836f64e692967e576eba31af8b314f5f2876170bbd82ffb36c4011ea5024156c2810a73a60b08246fedaa0a2d8f597a0ba1ffdc549cae406355ca9ff8e3d5aa6f76c7f323b40054dfbb0b708dfd9378ba75986b207a44849bef0e32e5cc21c63af51254a43e11a4cb787403592350601a6cc0aed7ff0f7a48ea7453f8c7155d43d011d96cfc83b76e96ce5dc5e4cc62b946e3115c780bf2810fbd0243081e65096446427c6a678bdb13c39e8a7830874229a429dd636dffda2ba6adf0ba4346b292f194fde5a59dadb8f8eb38157bcd0b9282529391ecb99c82e92e8ee208694cf538deadd8942722b195f813c980b4aefe38afbf71882b481fb98545df380921c246d76ec941566d58c25b6f09c50404e510e70bce714dee630bbbd0a495a0f363849fb420794a2eec6b6594896b27db32b2145a92c703977220f51c3ba40c088389d2ef662445764396ae242b1e6c38bec5d5173c984090b292801eaba6f8bd207e662e1cd61324a98f827582a078eeb5da517f025ebb2324a0bce4b29a62a44fe21e2868f4ce95d1c87e90d3f040b2b3bf1407f8affadaeca66e8505bb610361ee0e49c3bca2834c2fe38f5c70247f55e80fba1e2ba8ada044ba9562977bcf2f883ae839c98ffd9f25d3e9e3a7417a70855f5e601ba8f883da4506478db263464cca7f9a57802e35ddd61afbb30d94725900a690408e483961868fa6c102b2fcb049fbd9333cbdb2e085711db4ac42065d1b552efe55bdec5d6f01cf559550e570f8c314ee4510992f447981b3b5534d926121bcc01080dd4cf802012a2f232fb3bf4072b8f1eabfa2fd18ff3aa52e45273587e83997c44c0ad02611cddf34d1816f66fd927322c5e4a531919df201dc242e4754fba2ecdd4f74aad0be39a33a260c7e2b81e1d2cf41fa2e915fe61baaadac2d10acac1b00036e97f9992647104c254fda99769ea0905be8c3f89283ed83471499773cbb5aa040b79f619ba6670fa53896c3709ba28448ce9b86efe6ca01abc2bdbe7b26a3cf6d5402b16f0e0013bd671a1b4be62aad142690276322993fe157749c5f7ee59fa9025044be0a7917cf61a47431297dde71313f9fa289ba75a880e8cc58d27689e0cba18431a9ab279431c9e3551dc9d7c78f72cb1f32db2d2ad4291b2a0de9581b53da3eaf55b53311ae21302b645759ba105e4e1bd427eacec828cf419a6e5f13238739b7c0b54ced1e341545d272ccd110e5d34ed56ed0cfea54de39bda3256657730c2a091bce78909e8143addd94f64e7abccdd1f2a29bebf67f84d41034bf2c13d3cbd69fe5544092471ae0dc358e216d1dd1413d1a6a8637a0817d7a5d940cd522c1868825f8e480aa8d7fa972ae1c670972dcf7b5bc2aea9035a2c00f0286a5fe67803cfa95240d67a70a7694eb5aa3a9e29511c00f29cfb1f8724964e50c1aef562d0eb6ed969e6527ab53699bac4f19009af8d74d92c24201fc75f61a0857b3ec41e487f5fe7a6e25ccdf1a01bf8efc219f1f729a7d9b279fbfae4b3ccb0aa49c29f3b49c3f777faaba6cf7d3b065cbecc251ec4bb2e8a736006010a1be4b11c102188467b5264e15abf9c60302205586fa9f9a62dfecf13ef958f3619f01c5e199710059e862a46c2003584e3f7f2b2f49a35689aa64788f2fec4f64b43c17da0233c2a54d95f6dd343ee07caef1c870e474e94badd9b7caa9424e69908960929bd6c9f002107c638bf997704b8b1f97bf4457e565f8f4449572e3c8cc7ff4cabd764af3e7fceb946e30a425863766f0b935514654b652f9f489c42cd70a3230c4d31dac9ad559c9c91d274ace0cccf2467855ddd65e2ddfd47cdc96c97712161d68d7d2492461079caf7b190bc948f809366c8c4caf380d343845447e7c9db352d7f63112b6c722bfad6f5682565840aab59ab0e12b1192482690331764f54255a91a9a75861721e68732a74f97a756f7533058bea1b91637218b78f5d71be9e22c0ad59b2563125bc18a0d130fbc5c58dc7ffd74ca3d82116b9a2a6129bdaa29b04419ed7a1b2a9fcdd2d1660f55164d8191f62bf940c183eed06a5274cba4d92e2371e221fbefeefc02f9ac0ce2d2fcdaffc82d5085739d60ad3d319774d98b4879c97e9f2fcb0b5059170b2e2253f5ae302d7a0b2bbd1fea61a929e9c2e0f795695e5922135ac77c6857021454393b504245a84e2b11215061abd3e8ffd2fa4990427d52fd6ab457348ca886da6b147f5c00acf56be6da1d59604720b6f3c08a98816b15791f2d8012ecce6dcab21664877d40e417f342616ee57148c0a0cf2c581c5c622f3ccb21f51fd8ca1d303f2ca575adb8c4d82f06902b6d59379612915c1e078bfb6dc3938d4c5e2e81cb3d8fd60d1d779a987b9344821f7c5f507d1d9ddd0949f3da132ed8a68b982280be9564a8839377cbbc086c135eb9dc3ad04a75101af79dec97828e90bc6f02a921229484f771dcf843c4372b79d19417142d1279432f72627a05bd974b0c9602268eef06740d772e1304bdeb69b18ff3960132ec05fa49c8cc28eb58f9550a3d3713e599d17c9f8502a9f218c1b52860f952ef788b1575951e3a368e4e7721d9180c773c09415abab47990f25cbe2631e90e8256a512562e7dbd668a0c66145fc04c8b6942c384f44426007302b2b17ce1ddf1e73aa79160cbb7ae6cca3ce865c82baece18f9e75a5c4489ccfdfb205313b1e42db604556c0e7a4ec8b8e65b2240774fc51e5d35d130d46e2699be9df8caf239c04a5ab9407811423a06dc8b70ba03d4240eaccbe40875d09818316e5510b5ca8cc485dd3b73137b77431da83732e9b2c1bd71da2d90571336f09de2081c22e5dc617ea8eeccb783314312fbff3c8ffa55bbcdcf552e0d9abc6491a35b300c2adb9481e47bba7c08f994116d0de5cea7f722dfa0c2cb28b730876088eebcf361e95dc3e1453ddacfeaa81202afd26f86993295929d21b0a9e2ed11bbd9557f08fdeff7d80a17970b58cb49460352a4dc6d96e7aaa7cdc18110d27adbc7cacf11cd20fca2a02366aeeeec1f08dd58d2f04bd82f25e11f22f146ba6e0995e56940dca6037bbac8017aa6901a1e7d7485c7d3fcf6369a0c4423204fc82d5e8b72b907e3e6f7a7f10ba60b8861c4c009de2290a624dd51a99ae67754d8c817fbd2b2087864618ddaa781fddb6f4f3e6cb7eea6be8344dc50717396a4f7695ec0f75649b9463bdf47b11bf7043376291166d8b565180dc9ac95c63547fe73b4a4a62a5ab1c5fdbc98697e57cd518218a5cc631e095025eb1cd8ba13ccd5ef48fbe2ea6ad1404cfbaff6c73c6c156050c5b08fdfc6fa2fce172437cef110249520abd3b3f935f7a7d23969632f517b98e8a3d5be0e818c676a984a57cf7a0954fdc7c301b7bd60f096fa35493c6beaacc8b477aaa54d53af7adc5100f0ab0fdb28beb9638501bdac8beadfc49ead3649c59a55d6ff62b49e02075944f3e75799d478ebe67a0e5b51dfc75453241708f32a9c047a56e672151542df2e8836134b1ed9feb74168df82933ee81ed53efcba5b1a72090a28b1272d432d84dddca3f7c399f673e4629021edd2eb9a30f79bda53e768f5365ef14f2f3187047f6bba90500cd716de20bc9055cd04f306ef2b8aeb6fef7bf97af669d04e367d8479cd47d1ad0305bacb6476535d869746506d6aee12af80f366f58451ab72e339cf7a1457f277db19581fa3a47a010a2a576682f2626550a0387c6546d5bcf6371d3ff598ba9f9fd04cb4be29fc1d818d4e09ca25754b71dcd92d6436d0b2e8afa30b1e11879134e6dfe3e9019dd80e2872d77c944258733ce58922f4d07996abbdb333d2dba270d35adfc735c1c6b30b6d9fe1cd7dd94cece317a142bf3d31e9172cbb6966d706a911a60a2e90ec910c25e10b8d73b8ea05b97145d085a7fa75e3781492b7fdb0ad8dff5b831d0218162b6b229eaaabb8452e092827af2e092fc8969c3e9c019a97a93e836d48c0a8b15eae1b7644cc08943d3c851361056c5461fb47edaa3d9215cf3fa31146de010e7b57f242e45734f1fbaed4827240cb202f10701f7b6a390f0fed86d7c17d7abe8b12708a5538420392989e538f4eebf0b2531ab9918ab381e2ba020acb1960ed28bd85a10d095c85d0812242c4f1e61b3b01ed60d8061e12d7cb47689e4f199e760de7efccbc8f52f0a7b40b34cc1d073ee8f96ef9079afb68ee19e5f3d18656ede406cfa8343604dd097f843e8adec18335f27fe9060381768f1d70bedbd6324a3c93473d065a24339d971db38c767ecc3de0cf2a9d6aeff06d0280133a6b0cf3b0867e86529be01558a0cdd75017fcd67e113ea97eae0d28c0c8b7d9d1ef7b218b9897b8e175cb6ffc847a1de2377531e396f0c5008ef362fe2c5845172c176f257a0adebbbc552335a5e77275b7b85a4af7d780c9ec57d039e0f065220a7eafad0c3271d670ad6e55f259edc1f5e24b54b9961d4233a9cea4c9159147d4fb2cfed0a916b1e755626373ef8488a44b4b907bd7ac687b1260beabb843c26c5a2d0c82fe5382fabf0485ee8dd48123aebcfa779badfb9d02f530e4abcc62794419e403587b3cb2c144bb2f999a62f3bb8775cb3a53f7382f94a9d5ef7e0a63600afacfcbfcdc8eb6688b314e07f92f021d7928dec73e242d4066dbdde9b375d142675acf2fadb94f0885a4df3d7f4289eb8a9b51040adc83592324c1b13dd97f2b360fa443c6257313ed53f998f25c219fa1cc83888f22d3f3698a4ac5671d2c0cdc95980c1d88d6d3c7d0156f6becc7316aacc2dec6cdcf3400839ecba98fa2a078929533fdb5742dcc18b69184171a4b29edddae027076eee887bd449cfc85af577506940a0dba56681352d7578c83faf3d5ddd3d53843d2b36a73fe15d2bf1fba25bac8a20744a5860371759b57b03742fae7c70d96be44d93d4a207ec7c367a68ed582858e88550077053f7c578b5a46be63d7f6cee51f96ebd1f0d2ad234cf4ea28254808df1b5f6190e38bbf2aa1f8cd150e83a1635c8c96b590202d25262f6c9cb94b6896144c8543b217d89b295efbd4969b754457bd56a92cb859672d5fe645f26a81a0cf941a27e7f27ce4f07d49d77e7a2a2ca886e959f2089c5c4da28d1191c9846bb8972db2649c8b23db81d9bb63442a4e81fc0656f8117e226a98b5412c562a0578748b7e33f0439da6cab510d34eb6a512dc46b8f1236c42907b054181096fa5617e69ef4bc3641f4ca89df73625565d98f44fce52f3489d4e6279d67df43edd426b0f319a1097754836f3e5cdd4cb5136af7c7999b25128b2cdc4606e49f86f0cca56820ff2f27add247ca2a477090acb36283acef83c93bffa6bc0fc887dfb6e9206e472e3ba245572373e01ada3f6a18ac7da5aa2aba973b8ea7890e89659da285ee04ef42200b786374639c3ef75539d22d4b47947e349f95e6852b2707f3b36dec10a4851b49faaba21eb455dc3a35837ac658e90d10b27546e578ae54827f6428c2c81f63641a281b2f1ceee41eb522ffa3aadc0a9c0b5fa41c113073493df7d8102cd3940dcfd82b1487dcf0da9422f968765da4ee52e8d89c0d40a605da4251e2fb850f520efbdddfac4eb20e686a97cd75d8add9572aca8c11efa888b08cb488d6f32aa3a17a178efb13ef0a706a175efd48cfbedb5b1ee82494b4ebcfaf20a2bef9e4815f54061bc6172decbd702633a994932cc14a20314b9c2a9970135095fc723d63948c474be448909660e47c653bf9c051d8b1edda1efa18d09137f2e78f7577ecc30ce7f1706f2297f0b4d1fe653dcf6b916073aa10d082110457feaa21223eeca86c3018a3b4b2a46449930ecc553b073500900c3c1f4c9407bc25640098454ceb565298b1aed7664e16b7f9d22135c70dd4588e02ad8aec11e4b7b69776730833fa7f85be584d21b81312d060ed3b07ef6c81b4f9a9f30ae33bb7ba00695a7e25015a2996df8196ecdf55fa147594cfd24f958f0fff1bdb7302a09ca37e26f1d1fbf75971c54ed1eaed434eb9e12058cd2f469e7d3b40db6a9b976ef46d93b93ff24e15969dd45a7326b49fb42d45aec4d7ed4652e6644f9291474b4a681bae63baa61332100dabd71042d9fb71cfc8d4fc0974c9b88248d86829cb1a3e58d226113ff6feefacb09c6e6f9c858b3f91f2d7ca2def57f2e27b8ca4e80516abc44915caa2eb67f2e7ff70a419689b6d93037ca73962a1dd91c1bb51fdb5bc22edbc4b5af581268bf8346802f563a896619db57bdf042582fd2518e5d31832a9c6ca8c5d5f9c60670a7e494f8ebb627261affd99c47ce341512628632dbd18b10fbd753b5e341520ecbbf8ef9572962ef83fb52d3436c00e8f4b78461fba49a7b72420a236776784fa535207252b95950076aaea9e6fcd8825420bd498a9391f22d8e4630f79396e704dc6614703e01310c7952f0debf026c2160fdcd8c7ea7b94be77e6da5fa11aaa8ad589a379b923f0f9b37e5520d50e5e70138ffd1d73c47a5e0b27d3e77f6f90b2e92d0ecb137114b90c50b779b88dc76d8b60a63b3c460b4652765b0280a7b442c4516a3409ded14cfe09d9c914afba0fead143863f81aa7e64e18e2853a0ccbd48a85e642329fa7f4e1162eb2fe3de57473b5ce0f56d8b47680bc7a3892bc24263b6e91f28402569e16e370fcf270175789bb9782a2cb740d92b38a79af338ae6634f3f34026961de787526b153d9aa27bba382616949194b57c73254219efe1b9919cbfd197d0f3f2e3c6ee4c1022cf6040f14080ad5109f20fc8553862c5fdbfa2e60653beb7ae7a88ad2c1e5889c4d160712b646591a4182f7f8f53d0ef22722cbc5a6c80c8680190b59d3fb7f2301534d5c69a0ad7b791fe493fb08db530a76fba360c8994687ec16e0bb5d26ba150e32acd718f1e2645fa9b8a58fb05cabcc8fcad3a8d13da3557a0e23744ccb5219ac1bce6eededee71eeadccfc637ef49bd11fcf3d8d1e63dae5093eda92c4ea74715f05dfa207dcfbe82199b1b3bf1e6ebbdc2da2cf7b7a01c933f46ecf684e5bf49fa1123a011024d0df211027e0dafdcdf6fa9e9b15db15e8eaa025b0e8dee575f89f617cd634ef8607ffde27b9574a8be064ab9e87dae6a81f5e0fb4d43f6748a7238f5c3b155ed8dc93fb24c26128070adf7b659b12675861319a22059afc46e0f4b7d29ba6aca0b82d7875d383f01df2f4221d5f82c4d2cb14fe96213fb941a37ef50b6bc92f6a7ad04fdd153cdb62889ba21f977ab175d64f8f086dbc6f7c18ac0911b57e1725dd57be48024de35d73c3940ddef7c0d59d58a506cbd615c6cdbb98534aa34248fcd2bb1103d3d05a7fb738f5b72af07e4a736c3fb7b3efb452f7860441a12a734c3f64bef127c6c683b02410bd2acd8f754c59e52c37e1651bcce1a0ce3f22247eabc7b6311eb61a76940d83dc40805dee621a8f632b73efca16dff1ee36e4e4d72667995fdd3c466f60c46e7fe03017d69f64d64f1d0966c7c02841416321e032ad5fdffc441c05f60b3eab5c95d169f2dec648a31ec659966ee9739bcb695594b4ce2aff3ed0d4a2221cdb4f02f4706cf5231cd17cb0a18594bb4d64a5c4865d1bf7cc9a6c633d185bfcb3c10f7058c0da23018fcbaafdcb7b17143804ab216fa92ac2eb0626cb76c7c60b81750c96a864ede58c5eb4f4de78965a0303793404c24baa1030f77dc98ae5e32311f8146b88b5703ccab113195abfcfce4e4794104f3c9f3d120af7d1804381eb3ad7d9ea0ed1827ac167a84336c012cedc679306cbeec007b4ad969da4aba8b5914eb3b0c9c85ac366d5e02cc458ca154d8bace52dd0fb1184b5351ba791e0489218519147aebc06fdb2f35872fc7a113f61d36b15466cc1f0b934bcddc5f2d1690f2ff40ff8039b8aa3c1523f1facfdb14027051903cdfb8013987925740a74a851fa95ec870d7f3701f4ef91a5a5b1f3fa16570b4bc539553f9296ee475e9011cae3694ae098fa5110134002f131fb3a52f7f392430856e52863727095fe52b730c6c138d0d014bc19ccba413fa60a13131888e8232596ffe8dc554011f201ed6fbfd5fce079f6fea8f2670a84e0946d439a4554e281344c651cfe9530eb77b64093ac0d551017c3264d0e70cf60d65622dc40d3750b9a438cc23b712fc963fbadeaa0217554a9ec805143b704f7d4ccce1c5eb529ff647c9c7dd9cc19eaef64ae0ed40c1c508625e9e35f6c885cec0049c5d116a707e7a24bb219dc05ed529a12c105dd02297446f8c02be5ca47d218b9fdd2aa6c7c9712ace4c8cf584931e5a7c9950d37a7216c8e57535fa4b1bc38417d60c73474c2667a2fdafcce4ca4205ab4fb823731fcc1ce72c7c5bc305305dd539578290c7df35518f33a77691c556037fff701222d84eae9dca0c9e6ea9d39a41c5cf0f069d81e388db4f7695f8a2cfbd7be7a48ac64f87b97ef112ad5fa8f0277909ef19f1408091d5649fd522b5d61ccae52325441e6785f29d94566610fb7663e05a5446eedc44d50e403c6ce42f57a8cac67d13ed00c85051faafd2ea3aae21c43a8975b359a0fc6465ae80c1f805be1c9d941ca13dd9ec1521d203d2aee4d48ea7bd130e2f674d9a75a16f0ab5d6cca4e34e65b73bae611f0999071efdf971702fafcdc7277cb6e52a83a2b130528c4116e033816851bfe44409350781f8f7011f413ffdde93696fa32d19623df178e1b592def0e782a140476ca94dcd57e9fe77cdfdd2626fe2dbc4e2e7e895faff273db9783de091a5d851f28d0f114bf435fd4db6f3021078d6e1b978a93812d410bc2b61f16d22ba74542a6f10540904c0784705ab5420d06040b17059878656a4585aacf539de684fc2b68a272afac7ed2d18db00fd2173c930e41cc5d1838c1703e751489130cf162f587efe05e70da6d26bc5961465c13e83973ec244d4ccff593baed9128d9c012ab83287f3781ea1bbd7befd55c9b88a721b4cf38f0b1c75cdecc2017a92ff136578ed200bd4da6d33ee1c46450723fe362d34ffe8919d1b437695d3e0743a7fab2c7f50907dce5078b21c9122aa001ec7a4d6663f614fff58cb69a2414ad16956e690223cce93f1c4b0bbe6f003e44cf5b571833ba5ad8081f6efb39172dc469e175217f2da206e2794bf29bcae3fd3c6afbd683a04833c2cc8e63a703b542d3756402da035b4a10aefa3ba37da909f8a3e4f68f8147650e5340ee79a653e664f1757fd234f563226f85b39563ff57b8b7d3a0746aff8f97705b34ac3f189dab228a03977f28e16ba8951c0d01fc7fe5d4b9fe83e0baf4adccbb9a11a6416f49629b2b9c4baba4ce4d527d122d3e5016a432d416c6f93403a0b7cd1699c41fab64cfb0da0bacb5c0e0dda474c30c347651b9ff3c803698aa8bfd2a613ace69c2c49442ee378bccc2c3123253a138269131c3678835f73c8d29ff8f6897fc5afdf1ce1a9786e7509e8316fcb93b82a8dfe4a23de378a0889076de6508f2ff978cd80f3ea6c421b508d662227f0534665670fe700725cb547d8666068facddf19b3aea6c5ad74403695300c54c023656ba8eafbc3a69581b23bce8acdefa6360e3880825533273ab0457946d15769b106139ee8a1893edf6b6cc6a36104ac51573737ada1ff3edd0a0d7bd6b206d56d76aba7e25b431c9c20a4d642c70dbbb87f2dc6a608944a365b038d31743c2f8b694c0dca5524953c1ea6955f34dca4ff6fb56e3ba3b3373d08690705350147e9b5c18bdd6d1f64f042fc42a1df37aac29aae2b3050bf27c9c265aa6d837c1afab534c708e653a606f103b5637508383d4f76b40ca69f00f2a3463ea97565a07cd37941896af93582a5e1e47cada4044b3d69dc4966893ab6c937a7aa91145129c6f21437be8ab0e387c885bceb6cb10a7542404c65c580eb13b2b5ad8060f831c61cf1a8ae0b27737ad6bcd9f17622143345b0f1fdb827ffbbfab4da9b84261c8f76f5c12d32a1a66b04db6626e616d898b19bc520b16c7d9929c95337cb2b38bb45085d1b6bfbc01764735d89f0e80359b849a8e0693a656520958cbd383469a3c065fd9d55c0f691f883abe6078330322429df5863c5dc10657d6f32f55e668eeac81f3588ff807ae182271e2a539a7e98b6dd9a7b86f2cb120516db3015749d2f67a3e7458be0b3214f7e1a3193c5c7badcb32d2f940acf45ef279105b5a7597d177cba45407026a6f59b1f0c905b021da3b96704fda7f99f3af651765979f255a2142fb60b914c7029d0e14004128f16f22e2177a0d914eb297fde9452ce906e5d1df4c1189b3919edab1386213cd290f957e1ed0474f8b60d406d391c57b75f2af994e73301bf0b32207a1c5815e156972ce610bc0dba6834a6bb503c93fa682ab2cb5e96ea7cd42ad22e12e296df4c3a8985a435c08f367c3c0441452512ac0c3e6d6b9468901ed1e3eb08f4cf623ae9d46f17de897d873197ac67dca93a250b7d06a05ab6009c3eb782301709353f8a8060854b2527b2c16aad723e232d5a9f9778fc077031488be8661599133f485b69e929d2c77ce1a3a3d68e7cc71fae9ea34401e55f5b82f8fb0409f52284de2e46437c5b93cd8c33cfd641b624f54736f357ddc1878c8791b93436be2bc06f954455cbb4136b0c4b8ae74b13371afeb9acc3b21e122aa43b60eaa19b7d6dcd55cc7b88cd40427acb691538e79520e9cabe312c85e7fd198824cf219b8a834d1448730a47b1275aff97b2321b0abde72f412cc6201b59c991e9ab83f8a107b51d2c07728043981a23f7485a2c31e02123d2e8c521ca0612f882c18a91cfd7442ed2324a80954bad100128826fd06529ed77575a4fb4324dd4e838888b22aa51efb4d7091693f315155ac019a76c1198927083027b9cf307e962bdbf781be06c78c18d35e657b1ae32588abac6877c5e03a75462e5f90bac489b9dadd6c3ddad2f307379cfb1fc653b8ebcc1e99c90c1d13f67591975baf064645019ac8c48177680c3f4d12fb18535f84f0ee52d1903ef11f76a90b9a1138ca8bdcc8ded3f63f74942dbe3f6fa594bcbd59ed1fa85c4e6f16dff5aa389068adf76e74da286900ba790d2dd6b00c06fba0be18106042dd4dfc66981a5f0a751a2010bc59ba6b4ebcbf77bb868dce45044dedb686a88593cbaa3fe5dd7a884657d528a6b065cd0665ba5bc9e2d3f3095ceb4e1f001233fc41bd727dcc397a2784070c6281c3ed601ef33bbdb9e0c867088e1e6c58af62b0f80fb2362b98a100830047b639847d042ebc3f9f401273c0be1ef58f3ab993b9121266d091f3e37b2dcb499d83def6742a0e12371d1114d3f4214430b742e7399ea349e84a748291087608b6be0d748b118968dc70a5502698061eeffda71949af83228b384ac75605376af21e4e10f236eca86df38ed405e3b848f481f11d4f0ea4c168c76c0f80b19831cf64ee3a94896e6c21b9cc2fbd5d301a2c11f00e2a62b17072c83fbcc9eef918a260a9412f82eddc050db035e88d785da4325f717e71a1e594cb575e6336c8942e55a13deaf4a2169d8a8a6d429fb8c4d59e879da90de40e2fa3e367b286a9bc91b324deeaff0c33627f7ce5b06f4ca55359cb9a3c21a8419dc43f56d5639873466dc8046c05200f9ffbd7bffe5577797a0ae6d9935024d207994382b0e1f7ab722b0bb0f17e8f77d35b033a01f3c374bf0df4f9859d690b483b5499884b1548fbd33c553e0f614d2f1a15c93c80099bc5b4bf2debb9bbae6d9552571050f90d977ddde64cd671332a24b8f3ce4d3e723b8e899dd9c99bf595b0de0977bdcd6ee955d9595f31f079c04f9008bb24e334fe61dc5e0baefbdf2e99c3733f1ee84c752e5e43a9ed9f56a066b4a07d59d5424fd619f3d696fcfbbbeb168462ebfc72bd34ff1c2f6297c42559fa8706128f9ffd31056e3709c4134dfe3c617970b87406dcea8e7c91ad3ac103ac4a4607303aa0169642d046f50d470aa332a03b74cf1e784b808af05f8d075543aa14a92838c8c58c56bf93154aa581ca050556f17127b52b6e9046ba37e90e1952b6915a73bca1d090836aabfb7d9f52971940059874c08dce9034a7ceb111a5f7d66f3d53a65c414f5ba31859e23eac81168472a93bb5543190ae4913f3b4b6dc28bfb7988f91b5bdda95855c09e85faa2d2e0599944bed68d6086ad1a2296ea85322fa659512cd3409f9aa48b8b6c57a6a8b813555fff05aa53d7ed3938160bceaa2ff94558e487e1a46a61202773a3842420ca51814dfcc416e6510cdb47c7cb305233881a9bc0c38766b6be416a446faaba760e6de6412a0672f98bf9d69cd6d0f64e3686e735657e6b30035021c8468738849dd8f652e3e64818e5944a779c692340ca574bac18340876b3f1a6212261843c377912aceb0eeef21c8e27237f44f17a8048bcbc563f277c726fbb53b523a28a54c41245777132bc7e4083c359f5c0c31271abae1b25c37b6f27e900e36b5c8fbf17d6ed9e64e1ac386c71999f3639d5aff1bfcc46a7c5edeb27dc548552855d1f28ea9f59c090c62594ff965c4565f4a71b819ab7208fb7cb6a2f7c75c482461d5c75763934b3729e0b53f8161879d96fdbf8baf2d8aff72c37b1febc904b5d8185294897f12f07d22b6e36721a4c801cae3cbc9fa36d82aff4da3acc4d746b95dd279b09be561e9b4eff34f4c6ea0fd9eb2e4cec85a60469bdf7ad0b25596d168d6ebd0e6b758654b14a80f801186524504a3a1e0ed5e34b32c7f6d3c362871cb7551a9cf37b603aca4b4d206a8728c1e32abd59a7ee174e8692dde0708c06aedf22e71ed6bbde4425f4b26d3bbd9319fd5e6d55d22752492d9a03c6cc560ecf85cd6ac517da82f83a539fd35c045d7f73160602cdf12fa159d41df4192f5b97b6a889d2fb317723ef6a5ba3b5d67b30542da8fa4e8a09f4c25a713ae1496154ce9fd05455f8f9c45ee80e8fa4a792d300953b72e5ea28ad3e45bba0bca8f2f1709b5e41e25eca2e4c7033c331d26189c1c09615bf18e7065acbbde428cb867e1517c9d5df94f9b35a2a57ea030c3dd7d1d0d5e7783c7e01928962d79c6fa11e76e94ea403c81fa829b97cce9a14e9b48adaff09b4aadd43dc2506a5e1c053c7c320d9037b38e09f5362c11e234f9828b4302d6e1c39e57646c090ebf435a4ab0b0513a155564442f82ea66ad9d294eff1f07669f0aeecf016b50578942d4b9451376bb9cafcbf0c62041e66eca143a236baf32dad120200b0263631713002a98453d6e971d3050a0fb18dd9893388fe2a71b11a95385bc3127f0d719b5abb5c6e8929001a83411dc53e437817971913b0f209ebd66df4a43c1f0b0d9b61167a1adfa4572a5f34b6b1fc5ffcbff304bd844e456e23da90c97b0b16672d77d70f871b7952891f24bba5a26b8246532fd9790c35fa330774ae6af0612b08ed3b68ffbd41","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"e488d5c668a9f4ba8444357378d93500"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
