<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Solution for EXC-002</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #217573;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #FFFFFF;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }

            @media screen and (-webkit-min-device-pixel-ratio: 0) {
                .staticrypt-form input[type="password"],
                input[type="text"] {
                    font-size: 16px;
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Solution for EXC-002</p>
                        <p>You shall not pass! Well, unless you have the password. Then you pass .. or <a href="/courses/PFLS/#exc-002">go back to where you came from</a>.</p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="SHOW ME" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"2a434d6cecb92786e4c3e347da9731e28d136c551d9748738127b9e835cce19e5b9913866df294de25416120fc35d6eda3a912c84d7830208fa0dbeeeb20ff6a8e8aa00a29edf24a89565d76614169f37fd47b7891a6522ccabe08b33ad890d406a027f2d7d3b1017a05240f30c77d5a87c1b4dd690289802e715f4762bdc3c70ece4c18af629351e9bfd9606b5fb3a79b2260767bf25b3959cb9c5247352590158256ef846d3d1413654cd4886d38b5a31ad4fd4d614c29f9c00229ad3093b7bfbd193eff3f17cc51193c696ef473301587845aa5186e5f9046e1c78ce261ada9d66cd8933b16973fb36b891b62ff905e7c8566ecacceb8d4899bd067b8177854e2ef6994102db6271e78328cae7f6a5162a5751ae4f8aaa922e0827686e12a90549d9c98b9b556350f9c812780f84e1d5d286a4f57b2c8ae26b9345d01a980b88c39bebcc85036e3965a6c3ea49e8158ac67ad3c95f5be4d9984f08654460a9e172b10a44b89bc4b1aacbeff516127396030995ff9ef94ad08b69bf9a96b420457fffddcc366175c6e2ad2f64595d49d36884154a07f00e6f3bee4194ac9e1cc8db7ed31944ea7b4775e336bca62a3aba0f35a503e0a0824a2a95931e0a46e843a8b705e91ce7b9e655429fbe3438cd9a29d3d39511eebf2cfeb4e14d234a37cfd25ac5f3cee571ccdf6bd17b86c5e1c7eb8b289a084c09f640a1610dbd3e83892258c22fcfe37d53f7cb1e9fd4979bc7e6b0ac1dc360e26256bebd2984ed359ebbf2471e19587c98422888d5af117cbc9250db16a8a984ef795b7be34460706117f24f35c2c4d477fbd275db21baf1d468ab78a186195db6fe0447af170b32ab4668b6eb8761eef2b03131365843fde56da1623c097603841d4e36d65fce8987b64d42c3bf120724c13f3f01e46feee007b101d9b755e30caedf0ab56d08fbc2691602632d5095fb40381ed04f3c98dc4edb9a79d345da6cae929a7cb3d2676e9ce0cdd8838b70ad61ccc973f6cf70e72a31b39660cab20f4d2f303236b1c44a80b3ab4109c3581508338b3136b8573cb4468bc43bafd80c8534d91d94f26ddf1e40411eafbe9839f21a98490e5d1a9a3682779b8d9178c789957bd556afa053554fa5cb5f86795f8d609b2c8bdfe639c310a58f76a64136d467bd8c161afc2e6bcf287551fc05060f566ad28b6252f7eb26c9d48b655ea4c7c2ba8f1ccebc8d55a91a1bb6332ecd9c490b0fa04bd9b118a2fe0357a07045a26257756242a73b51833336498cad03f738acc1a1107b08ff25ae79957c2b36f486d3e353950fe048e7c94421a7f34f3236a2c614922530176fc642f8cdfb6953dcb632288411aae838eb0294f72610095ef732919c5f7bc3c99745d5c6aa86eb9e0ef9069eddf5efad2513536a5600b90c55f4e9f3c359bdf67c63eb995527b390c64aaaea205bc773614a49db4094e7bfbf4d8c2a5c416967f9aff0df6abd40fec263ef41cdcc6593d114e9abc5f16f9187fa2bb8b7856d1c389bf1708249a192586546c4f2d97b59c5c120857a86b13aa8f758bf344f1721c0b8ef5d94d26e12aeed08c6d6561a17d77b5098a9e2568d4ea6f8fe86367961f72e6a245a9042debfe0b90ed96679a8ccc0e169a83a5a867e5297337955785606c269f9eac60d1da1f44894d33092429c6e204d1fa6c2bbeb004e16496fb2ddc572a78d46b78e38f38ec53e3cbecb66b214e6a4650693b92033c18333d6d90e92834ee1faf667a23e18b85510bca09aa6b713e23a897a80a34aea8ee9af15ffd4270d0c418aae2b246d0ce3e7d905691c6f6cf395de2baa10c493e2dfa0063687379de8a55fd938d36a6424bf2a7ffa940b8415419eb0743bcbac2773fb47a2e68dc7dbd43ad0358a1fe8855614d1cb381e52f841dc544d5c195d3a16ceee62c4863e773586509083da28eece5b3b54ac7ae09448c14f470dd494a5bf5b9e2104378b25430740ea7791a86f425dc1fe1511c31b058b9a6746de98f15f4f117dea26b53bb326d39f7f48f684441b7bad67dae4c50092301d26561f69d979a6f2568fc4b6ab65edfbc3b0aa0a84c677d274676f9a04ac468f173630d48e0da825f78fd391f95b1037c769b0c667e4384e7fb075c3247bed167942a44d29cde6aaf54494f68624fe915e16fa502fc12ba1140838cf5a480e18ae08f65f3c79900fe6b050977a367f130143634ece5142d7295d78c817c34656ca876ea568b8ce2e6d833c18216ef341db00bba1b0cd1a1cd206f7b08f391508b700f146913cf42dde75993dc193880e18832c81d7d782c6c1f55609f61a93bdcc246363c760a7f38e54f30ce41e53f301aa034f842e64ca5768236027dcbf3fa53820a663ed4196bb4e23c6d54f039d0450adbbc18b91ac7c8b040fb46b2586b2c23033a9d2ee4d90875fd661abec329f780a7c4a8feb1f51e27a47e302533ecf1ae5578e04bd8fdeb4f5c0bb7d1c15873c36d96501cc1ceecd97cd7c35f685e9d7d9a2ae18d6819ce104f6152e3dfe88fd9e3440b1294ac18d5675a82fb912a900e38c89e6bbf9c03feae172243749653c4d38cc0b8c3ff0071d8a68c569a5203a41dde908e634a70141c1e8383aabf0997a3f361d46aa7b38a15630d716b49bde1e550a522f8fb8278ec6aa463e41728a73febb185259357579a568bc361e618272b7c8a03356625ac51f6b1f922a17f190215022fac5a45825926e260a03a31ee916d4c2416db877545e0ef063c1932245265e17901a0dc753f7ff2ce180631d8e7e9103e9c4cb3279fdab30b217f41b53152f18af365f5a873bedbcae33ed313bd6aa9274e61b651f8146f09ce0cb045db9adaf540742e89851f3458b7ae0e0e87ef31d3e7ea4d1e9636a99a4b26c48b5fa0e42ac2dcee3bfe7e29fce7148b3e052957872adcf3d40fcafb2169c84b1c3c16cb63c93900dff9f6eb82af99a59a47bc843c804e964191313d4d0dd099b33e49fe5cafae9a470c7c09ab62adb89e32144ed77ebedc57eed5e85e98ab3529293048748d0e63a8269a944160d8da6ee63292b18ef715dd8d5056d8db129c76d04a94cbbfc26e0d98dc9b6c02b73a6deb78d41348f0498d419afb6e8ad5707bd8fc6f4f2ea61e1e1c2c10ee564fb05cdc731f3ccba5458fce11e1731f193e980256d33f9b0964d48ac07c836f8b0c73a20608e928e6fc03020ae3d568416c00b9693e9c74b0d9acd979fe3992bd0f9e64164b98a0f003f92eec29067781e8d0e1e49a02da3ad92e80eb10a53307ec56a89388dccdb8e3d75c5d9bcf77bf9d11d9ec1dbbe7042ab2528122912d4b99473357e123b96a825d825747cf5c3fc8834f0c1a0c9544fa3437d3c571afb76ffc22eebee35d3702e5b189cf21c6b8eac16e7a6d7f8a3e4a8f9d0c156f17cc9866a2e2d6d9409a52fbe159ef5e9e4291a6da85231d3cc60459ef9c70070205d3c85d5e1b4d62138d10504467c564cc3f947d029db25d500f5a796d4295bfbe5863f0bb01e238cd780eca8d73c9e9fdce33298508209438daeb733cec78fa4cc258fd2e336dcabe1f0c2c6dc57f6ffc7be626f59c284900c37c3765ccdb7a63ac91e66a1dc551c51934b478e4746fe408447f82f4dc6162e8c79ee2ac42e6129e9f05b4fb3fb70ccb2e0dc99ac1ff2cbbdf5c29533f86403bdca919799605388b76e948be3139e5ca139070506cee941e79f3b94989a9f94b7a6281cec96161ee8f1a8030a5233b80aebe4af6a7fd6f54ca5b3bc4197f1fb1e4731e7fe46f324e366fe2f291b931f341ae393d8db2e655777089c0b3a7cbbe451e03bad123928dd5aed127edcd5cb63eed43b93bde2ec774d5b5b8228990043d1757ec86d8323bd63115b2f6ec15f20f1b843abb920bf4a487fc3aaab47540606fcab4345dbdc4e80835969aca90fdf79f06ad89fefb422a278141e7250303990d069ab3ad01a84515341b5e4e1e6c6a89638af16da5b96283bbc53c79ffa7d6dde4fe44feee4583969fbca8ba9694109c2afdce79d6c74ecf3fa8dbce72865936f5cf083b42ee4bbb4c59f6d08f3692a9996059626f8854f6a43b6e690a7ddd35ab50985b557251d5fe5ca7d64d79dc19e9a23d6da20435c07a2106018c26097cd8b2b685ab677e33095f71d9398d128046a249c62c7283a9c34018c4f5d0b8fad50210046edd8af8222a7e83bfc0c0ad9cc3b7ccdfd4301cf3e2d1d0efd7f01cd06979a0025d89c721fbab98abe97e8ea14ace501bee0ba4475f1febf7d93d03835fa1d954678187d278b58e973c3b6f95277e28eaece23d2b81c76e3a948e5ede4785af86f3a74bd39df15bd50fade026c299a02623767bcceac5ba922720302a51c54dca986d6ef5aa190ff879af4dc1bda50c284f741190e7f6e013c4ace4dc6651a34aee1575b0c5b26008c1cc354fa5fc706fe0957e1eb09f9a9edd23833d2f5a70c6ed77b1af83bacca2cf91d57cf75fe3901583a330799b1f19f104d66e7c7ac6c2ea1f856012b2a04c446b3510c35a399d0554f4517d0cc981124e3783a4c5f101f540a1963366615dc0bb7212d5682830b90cbfc461eaaf2a1dbbd88acfca49b62b3c995d1cacbaa9d1408a832f02a16bdf602a92d8c3f3916a0d1f92d03efdf8855d3f87524044d38b42593fd9864a7fee41de0e838b395802125a1b33c8552ede10dc214b4663244cfb2217794139af6fcc4c222a8f374e54da1a7602f723420ddede9841661a2559ae26880408542d6574cdecb398cb765206dbc8692cc2741dce022efb76d42a19502ac1287e4fe9be3b2d708defa0773e5d3e89d4759b9a9e3e0fdd7dfb78b01aa1a47faa693c2d903f132e1ecb5515d8a2223d1399a415d5b89e751bfc035ac85056c2eab0e69df8569e069189896060b2eef50eaecadf1fe5d9d2dd14c30344eee71f12632f42398258cadf87e316d701cdf1e736ed2485502568930214e2157ee42ce256e1661f448766eb0d0838fb8d283bba0c1dba823dfd349f0d93339534fd5f80a2e28d5075e6e9fb15c716661aaef0e095a3de5259a97818403117eb2b8b4b39dbe68e369f2de490af183571306eaa99b70e5ad40003f3315a9286c5d5f0fdf490b3f532873e087500fa992f13f1f345058e1edf47ef2ce857910462d3838651cb465150357900e1c34a5e7b16bf1d6e160b192e0ab03ab6e1c7674d07cc41ae1cdda43594cfbded9e665ea8c88566c1628932b20ed8314ea8f5034f95662c9f865baf54f58389fe19309fed2ea1579aa7a183c52b337b36666374255a25ffb282692a73ef4f5e607abcb8ba176147772e86630feef72e77eb0fae72af6ffacc0a7526cd02a2c572b6f32b7f760a3527c55e5f01cd6f19c07aa6196c2b27adfad6326858fa4b0aa9c57fea3fa0197d96486e629f94ff4891dce519a69471d1d598b17bf76573e6e68866cb8d04dfee9018fba482fe3392ea91c46271135c892b9264c3570464238f64d6c20d0cbeca6cf2e80d56897ca2c2379231357269f277c139c8ccf1654e78f8b8fd3432d7cf10593a91e08c056ae531ece2f898cdc68a7e25ccb79b198f2106f64d2370a78b7e7837dbe707e809a9bdb1d5383e8d71ddf65837240e6b16c82b6874b5058b61998834754c51714930f9f57f7631b619247eb0e47c0294013732b6c7343b935c53372b0f1e4d5f1d6e75f3009c6e6ffbd123c725e267932db66f88c63d4bb4799b563f4e19b6c70d106d2a79897017e89226b453b8cf2eebec19711d1a61f4a73a11c5798609996507867e8442891fee587f7e4b47f8b8fbdc3109a62a5965a5a662533fbc51064dba5190ef5c2eddd75cbdb8ec9d633d6399f586df3ee60757551ab6f8e2f380ce5908ef7dd801a2025765fabf7cded7ea73b06837f1317e489d963fe60e0988cb487ec69a2170e90025db64b7f0bc68d3e17ff2f64aedff631a856fc4b6e1d30f12f9e94a326bfabeb6213dbf725d51676b658bbf85a367532b12babc9f28cf8d760ea7183e4bc196602d9494e1eabea70e42e0d5852e40f902203e4c1962d7d3fcd1ac37d5a2a138fac4b58b74f292ced11e9c518b93b76ed27279eb226e2ab8479d06ff6425efc133ba497ae637806821178f20c57e5240e44fbf38a4ff95b004d504a0f03b2b217b372fd4f162923b8121064a5fcbe9e9ba7b5a47ae3ab744c8833f8e0c3ca4179729f3f514600b514342e739015d3e1f1f3f3d0c8da3560861000691220fde8c38bc825dfe1ced72699bfb42297b67628e59726b8f462cdcabfa77907047528920634182e28673e5d12086d82e438cde40b8307fe94cf30df3b0cb14f6e1a7b8330a2ef11e9a3637edcc566f2182d97a7ac4c4c609098e3b4a276e20b0c0f96b278b9167310b00f92a6882dd3867cfd2618562652212a34f51b45000bd377521d2af1cb21f82684edb741540959fac168b93168e2eda709f9d60a4f35d17514e05a3823286439a36255e62baad81fe4a21c9659ba0ae2acbb5390bfc3367941a2163aed2b2f4b2710606d0d59f01b084e3dab86f3e03fecd4ca7fe3d2341473b4fe957d322c04f7917b6f4228349758885daeb8865de845f783ef103914a5c3f66052e6939ef42b861fad15eb10f3e774f30dd4012b6c26889af3d6798b467c8e75c51cd5e936b50337c53215d9e3ca7d67744b8c592aca43a5e10fe0c24442c4e332a08b467448b424584826e3b534eb8ac6f9cc2b98016e033296f2fbc8bbc5101499fbe3e0ea55cdc06c594bc9df07a9e2d3385042f7b08341eec2618df2f61146d42168b9b95e6bb0bf0fdf256ea9268862c849907a2edff784da40d0ff8c11a8f956c7913cb91c4e1734bd2401944047eaf50189c81410ac960c256322d1b8db9e738a9493684a5e85ae8af2b28125b4d66388aec8604a5e9322b21fd42898f256766b283000e122405753de02c2294097c201bf017f32353a3bd599fe20b3f6d315551be9cd19ee51a2fc4a35d91fd12844a880c790b9a50fce7313ce35d76972774407693062f8528e2097c44d336b994d98724c14b2f864a91b661d108079624e84cfb1e3e1647ed590b57b4ba5594a5c7811595b90282cb99e2299e8533ccc7a8aacad84085f12fe9a9db7b02c8b6f66a8d0ca1e407cd9102b614e6b5fe37dd0cb8e8c56e4dbae651ac102b0ea782168a1c0a29af7471dfb7ccaa9a95736d87b375156e32deb4f4070547492c2d33e7e3f1e5cb7302d8f22cf5ab9fd85defcffc05f6393af8eab56cd51974ad15bbd3f531efea701f3f2914d5e080402ebce79a62c6a8b3bc373d69c50f1903e9fabff536f7a41da2e934aa3ad285fdd73d0f00b111c5f55977d04ad0f736c92443632707d61bf0431db1644071751e864c27967ae167811b703015d0560cf60822ac07e9f600e218c9808303326cc140e47bd333bc46d081fb347eff908f5d416f0af14258fe977af930d06ab859ba9f8f4239143a992d2130180bc0a181c358290db2269230dc354de55f4b98f4e8bebf136103ecd3c63585cdb19f60963683002306e24e42394c17feefe681f70a9fc46721a4c99535798585ec3d78009256b886f22f2bbad7978d80932c6816bcaa7e35230acdd8d497c369f1756d72513b5816ed97bf966899d67d2f85d60f7681e5714adc6028a74faeb7b277f56d7e329cbba317b565f8deb10bffee0f4d4299f88347505c593424530fb75c488254d225961fd6cb99e2ea17b451b22a1d9a30290675e33c6f35d119afdfe7ef1c65fe1f3afb02bc0d3d56f85545543902506b9923ac177e68811fd8e0a251bc3fd30dbcab09e3b8585167ffb3213b1483b7c0cde3b6953de7f82210a8009a87c6c653de98d9311841901d4889e22e50d7ca254d8596f5ea78a4cef2a79192b01ac9626fe8745a20a88324e326a5a3054aec0455e0a78ede71194c374ba904a92fff4582cabdf9820d98ab155574eb1e62788e1d03e578a7ae406ccaa7e8f6ac0fb6c9ad9b3420b75a4d5b4112c21e4c51f4075798a74064c253da259868c377764e1eadf7de13e56dd16fe4144545ce78bd4bb297b5910c10d15e1bf02921b2ceec6ead72165e84faf8bd6ca89cd7936fda8b5955fa99c45511392100476b823830d1d2d7233502327d564619e75f9efbf0b9fea325f50a262b7fa3303d35517acb6ed0123c5207a62713c78a9ef87adaee48f2b9790b19148ae1a4a780ff59de86491bf65832c057f430ed23f3634dd8a07d29775d7fb79d5652a21fbd97e21eba2988fe9f679347799dc8d13a4a20d0735018dda536ab96680558fd80534f47c0078edeefdaade48913792721121e8516d4fb24a4c2464b698a97a9146ef4199e873cfd0ea8045889bdad718ed96395a45d9ae5be40de4013ae6a338aba5a639c78c86c9283508f86e2aa9d58b07ece9585b79685b5a791e103f278b9cd7b3c69cab2c8ec1db6d1d167f67c239bae18248f0eb85db18b6e64c10f14713c4f77906c3791c285dfc07674a0ce710fb5b651bd98bd8a0b9c49ef210ef7240304c3761d2117d7046d227b13e16adeb86cd03a47025d2c0a040e6effb6edde7a276d13f862c29fdbe13518f17f3868eeecfd90aea0a2b1e2dc5467477a9a6ac7d591c84a7bcdd9409bcea488b39dc0b4483c9f7625b15bf7d5bb77ac2ef2cad2edc0563c821e9a280c72be02cee8500cbfd7ca0bf273a696c99970fae847a26c57e44a17e29a7078c37c30623a9398dfaf84d00cb3f7a8d406fb287b707c655552b434579cc06966e5d8d92e01b89a6918b31d9d37f66092af1fd8fa2f4909b82b8130ddca73b6aeedc06916135884992a25fc2b05f3d1d4e36b41db3053d79ebb8d1e44502d7f312bacac93f549c39de9a2b1184b7c63cd0422b6544edb9abb0d05ff0cafeae92e8026d589d3faf99b8068d31c9ecaf33e6d6d6659254585d6fc849fed32b4fc82b1f6ab654ac5254f0368eaa8f397532b34ca6dbd3b3fcebf4048799dda4d20c13c462e280f379a5ba6b16b1a04392b93eac1e3f05a6e7127f58a9cfab8af4ab15ea7a177fcae7cc8f2659497cd29477e188ba5178705023ef86fd288ff95f5ecd5ae1e32a0cc08dea3c12b77a8d009ac93bc8eea46962d6eadf2d3b3774755aab780394cf4ce1dee181200a007ee4f535e0d1b9ad2987d26ef436fa860bd62ebd14f8c89d0a80b3486abebca731c5bfd732ba79619e6d82036ff1a5399ea7aae985001b50e5e7fdd7089f32e820954b0d92dfbd5c672daaa0c3c7e237f28a79611b3ae74809f0b0faf315653cfa41ddc6d950f9fd1b91b634cb52192ae510ce08bef1833cdadd87f8a5d367fa443439044c5361382a686893849a560ca7bf144d22f2e02fa1304ae4b17cd3bcd035b4fce3eaeaf9fc5668ec18ff8acabb3fc594f538014bed73cb3d332b54d589c01bd27506111309e7e6b4c320e0d3d3abebe4be372577248bfa89e38b97032322407313f474a319801fc9b870a79c798992299e1009a8dc3b32ec16bac647246e526031f95f70597d219e50f002d1bd85a84ef1e9b6c06abd7eb1c2fab4fa6876192ae895652f5b75bce6ce59061b4a958ff2bbff2c98056f0e64f27ae03ae049ea5efb0bf23ceaf775c9b3fbbf283b1d0ccb440c5fb4c5cb3d04c48f6cc3608afa0f6f0336a6d929f34ea8c4cd6b3074e13b54eb0234292cef5680fd44111c22df91fbcb76110f5567a73ee6ce12de968623a6108ecb465a336b0369a94de5ec3ed413c165dc1673f0280af4631f385638b12246fe9ccf6fcfda47be4b68761d61c4704b969cf4f0ab9b143e1065bdb256d11be542d65ce437f910520c89b35c7fee9dc2599b0c98078cc87e62a59d71c073317829994dbfc06a4ebb3d59e7d1e7f73d2094f50721663a3e78c6a1f99c1d799ff3d460cf0042a2c40f6ce02c99fe548032a123b7810be7c850bf73a28151018c3fbe2fcd1951b65e3cd70df7d29caaedc4ab0e5d52cef859ece55ed7e22f37d073cedb5214f801c437e65e4f2c7e9f687c98d3d2c0a41bba0c2a788bbbe8c0a022533c44a03482413d563cdb94e50e1c6d04a1293fdd1507ea716ccedbc78dde7c20409ee442913b11ccc2672c40ece6ab20553c59abfe3f37f22c84fb4758766d7703f8c0211f93c564211d9ddf9a1bf21916947c17d723796466433a24ce4372cf2aaac57a1d4c418094492db82806b3a4e06ff70414dce6dd3353a3e68bb2886a4fa499f437421475e3f9315514cedb599a12a12561685383e38e7e31cdf70f710b880046773ffc54796879cd61979a8ca521ec2b1120324338be610b2f84fb4fe5091efc7eca0cba61a175f3bbbfb117a7a19e46ae26ea20c5b026ff4e81b98c00ccc231c398357796f9ebeee52f7b63e9b96b5ffa4ce4e3f7e2cabdd0e400f68a0f31362968ded353a2f20d271c210100d3499ce58e7e0e84d00a7eb9ebc77eeff9b88f45f3e90849bd953ec731f13791826cf2674c096db87544fce8383e7016a1eb5a2ebff7124e07e956b9eb78f5a2aba37a9470b6c74e72a6b60deac74c014f3744009a8fcc3fb2fbc5042efd37339cfba4ec9d53fe45b9753cd7862cd138e07b7c5063a9e4463bc9aa2a39dc571256f9b1ccd003864e5414dd8cc1fba587d3e4936479295ee65047511d7358246219e8539b65cb966d7520f873b6590290f8657df1977340d38874b39bfe06a51204de54ac26ef5c4acdb05fddea0f972a5d456e650b1c7f29b1a1b4ff5097840d92201f5200055bae0f4d309ce0c4e4fbca821e6bde3385db567762d3fbfc2e0f44318b4334faafafd1ce0bfff62bcc9377e8fa45961dee87dafb0f3c602d4f6895b638784fd84bb0d886e3fd38ed6ce714c979777846ca001ba34038aad915a21afe7561c7dab821fcabb88b4748dd49cc96928f94b7a4a305241b8cd3e7cd42ff4c4c0be6bb4e2ac728813ae1f092637596d4e255e83e3cffecf0f05f566e6f7a7e0870d604d6bbbc19b7f410c78faca94c38c7036244f9e484d584c07f652bcc050d29a0f0d03c4dfdf25a760d454cddcf79794040bd4525d6c9663e38633cf0cd6814a4c84bddd0a04053127a53088d3a798713bc8ff473bb5b1e90cf707aa8adbc041a7eaee25dee4b3b914bfdef5af6068a1c939a3cc85ffda8e7420c1e17606be2cc3748f847f4f73f4129e7a0bd417aefb048a504b92c988a779c18bb1d351127c70dbc2c05e5919f34fdb0d66bc03d52e04a80e07e2381a73e7e7903291535433191722444dffd0d6cfb22e987fc49376a0c965250ec31dc2f4a42a47f7cba3d2074a19e0a24e92341ab5c0da00825e08d527ab6494e1077d49d6d54703c6ff537587bf8c9b9d53fd54980ec066e56064670c99801b76556fc8a473ca11fad52c4e1916a6812e8e9afbfe724fc5a38b788c6fcddd1b480529faf48558af9377910cd4dd9f86955253bb899e704d6f802f4928a6fd8a18f85528407cd5934adcada6fe2a2fdcd61fe3205171dcbf373513eba789c7ab310a776436644bb77c78eba5ae02b70920e1b1c532e462dd4b7425ebfa681287fb87a0d983583bac79aee73d13997f9b4c02bfd964306d6f7160f0fafed6b3a6fb43a28a231b1104c0fce46b087960bcaede793faf5dd06f97fe56d5fbfd7c31bef7e33a4c4731425b9db66d52541255eb6167643a5f3230464b45e1e00d3b27ae73be78ac1758bcf3ea4a83cc7d7d0d2b77fbb3d48c8a70d08671b65cf69ebac9eeed14c91c78f7faeacffb33eda0608188c8f36d393b75710d525f61373bb9e831a64e719956945c8a364b23c6c405bd7672bcc28d085ef3dd4c30bda6266b086fb8fd351498c37e790d4d54ef18fa766c1262d0af1a7d44ff0f1b15979ea5ab46ba2cdf1ef65d5d836b888e2fec611056f224ec3f7ba89c744802068700eaf3583e23a85594b3674c52319521124f1c5bb1f0cae3b928ecccff3c343a94702a984414c935ebe74d4399b74fc0d47ba2c2f26ff634424f3bc9a010d49dfe98d8ded5ee8eb7fa141094e38116cb1e87c5149f010980c46b794a7fb40cf30cb3553cdc23ed929c8e0e661b2be7c8bd1d24f0bf2fc0c3e148099b145ea864e669643e66b9e7b8c4eb23ba42320605c07896c0b5cfa968b763432a79fa35054fd5edc0c31da4d3639f6400f1ba725aedf0ab7db239bc175e602a40739df12e442cf8bc41994aa9c206612b6e53bf02835e2d4855a68c20691116d56c7609bb4b3d810c28ad6b7b065c203faf8fb168ce948784ed95610ec66a35e9b44ab909ad23b70dc7df6d5b975c8c34b7756f9c85e7c47a51ed7800f378550bd474745258ad0175c3815328ba5f5c04b0ebdb19a80278f6d986a7907ed6c4ecb3c540f870b984abdabed6c2e7830597677e2993f167dc4f1c8567d8eac656d282696bc7656c051ace05008f9b888778c6385eac23ffad19226c1dcf32e0e8bd0dcd202f3eddeee57980eea51aa8bcc1818d8e0dd4f6e00ea8ebfba402bbdaa512d1bd45521bbf92f699fca1a628507b30efd2039dac19ec4ba59ad32288c076254bfa0e4e29227645e770e5d2e1ac1e7612d34542379da51d1bda63b94cb46187d5d93ae7242754982caf00291d33e83356fe71d1b377b1e96500ddca6f96eb7ed808bf2e7297142da7b30ce1c882c6fbfece6e8094ddcb29078981ecdbd5db4662383ab95fa4a53b76254f32fceb1eda06882c14f3ad37543e98e854f6bbed32fbef0d9a3aece0c61354debf77734f9aa839f555ef26fd620d07b0941938a764a876cb50c85a3ddc10d8bd1c906b033b03253ae4b93e7d4a8b50f605f757b67ced629897b1496ee4aeabdbff06d3a70c7b78d9d0a5a3c19ebcae2fff6a601de64f11318ea4745d62113fb648d40dcc95a3fbae7999409cc0e3ca361e0adcca2688f30e7402042aacc97890efa10df2443b36995d79171a6ab6d80eace09c19d505b17d64520f1dfca213ceb106c1b7a3a6c91f058d65f0817353b06324eef9aa3388be3408e2c16af13332cbcfd583e8befe1406d4e6a584f9689f737bf2ac2c31774b07c3e79fea5766b0e0cf5ea28c69b1e92bc8629a81914a9f2fdbe2272855a7a69511f58b0062fd4fda6fc96adefb9370069be8a610df75a355325d680738e2145373e61fb3159211d1583f2c7c8eeae0f9106a6d07b82de89c90d7faa2034bd1e75b6c71e9046c652a2594824856b9f9c643424c39b90e517d5bd5cfdbc62e3044567a5bf0504234e11b76c369c5dfa9357f02b2b51fe09ad2aac035315dc0789b50457a01936ba74560a3d07f1d5d50536eae284935b2914b7ecfaae7f6fc2672528ee2048ec775b76f8e90811246fef3b16ef4d7d876f828776a7f48ab120aa4143500a474f8a3146f6a73810bf57e77b654b1f9f4353626c5137b8daa40ff0405b9cf9274a1b8d17e1f30de688d6cb853fa5d65ff4c9e55e039d894b59967301d8e76f4d40dabad5b3b7b19982377abc6a2c6628127e7a43136569060b755ee0b8fa88a087bae62d031c9d9889a4449f72dc7936b9adecfe4f1f9b2608d38bc99b9537fd95af83718e947ea0fd0e37e9274d1a922b146d2ab94eb412cbc4242d9fb9ca8e3bd450ba2f604a59b4ebb827b1a2e961b8c1bb5d021c1baf45409c0baae234b1794fafb2f5da3124580ce12d70af337274ee1c5a3451e6f78854daa5f163e9ec82ad5b078bca69aced852bf1aabc76e3005bb374af083ba12ace791c76a9ead4914e927b7f8f735d481576853cf2a21a070b163bca6a2e40fecad5fad601d7cd508c9931c82db068086905d34acdda41e24f64095c7b5e2a6b0423879338d8e857a373126b1db94a6bfd6fa6b742467f20a4bc5c60c0f4f154421bd63146987fb25b1f346c12bc38bd28705559c58250d4d622d0dbf500ba3e5b602812b994a49e80250fec00db16185b9788f6026e86df0bd14a04223c980e40a4e2275b99422661083e2cf716d9501274f3382c8f463adc3a07c334bc96744ccffce61d6ef8389a931d04ea4492578d957c47a98e15485109bc6702bf7abce35a53ccb31b2ddb0b6292513141892b3e78b30d473ea4d7c194ba2953c77fef86376f4555780831f04037b2f20cb9772c64d954089560a569ebb32b6f5c22ae6fb2c069e095f65eae1cdd15da7ddaf5c38c864ebf47750dc89be43c34321bced20c6b1fae3f9c0bb7e1b2a36c9d07bc33f977a16a50099d80dc4e109b9e3e48644e6d93b85e399a2183c41b404552d5aaaa3310dd16fada4b6e98b732a4a71544cde8daa07cf1648ba8114eac2fb614b83d1df37bca1720dff2609a2ef82313535d8fa0f1e7c8f7250eec7cbad178cda466e0297e23f07c959e76e1c0cab6e5b51f367082ea1d1","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"aab4785257cf56e56f71d58b84de21f3"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
